"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[327],{7327:function(e,t,n){n.d(t,{create:function(){return e$},insert:function(){return eF}});var r,o=n(6855),l=n(4479);async function i(e){return{raw:Number(e),formatted:await (0,l.Ed)(e)}}async function a(e){if(e.id){if("string"!=typeof e.id)throw(0,o.T)("DOCUMENT_ID_MUST_BE_STRING",typeof e.id);return e.id}return await (0,l.EL)()}async function s(e,t){for(let[n,r]of Object.entries(t)){let t=e[n];if(void 0!==t&&("geopoint"!==r||"object"!=typeof t||"number"!=typeof t.lon||"number"!=typeof t.lat)&&("enum"!==r||"string"!=typeof t&&"number"!=typeof t)){if("enum[]"===r&&Array.isArray(t)){let e=t.length;for(let r=0;r<e;r++)if("string"!=typeof t[r]&&"number"!=typeof t[r])return n+"."+r;continue}if(f(r)){let e=h(r);if(!Array.isArray(t)||t.length!==e)throw(0,o.T)("INVALID_INPUT_VECTOR",n,e,t.length);continue}if(d(r)){if(!Array.isArray(t))return n;let e=c[r],o=t.length;for(let r=0;r<o;r++)if(typeof t[r]!==e)return n+"."+r;continue}if("object"==typeof r){if(!t||"object"!=typeof t)return n;let e=await s(t,r);if(e)return n+"."+e;continue}if(typeof t!==r)return n}}}let u={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},c={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function f(e){return"string"==typeof e&&/^vector\[\d+\]$/.test(e)}function d(e){return"string"==typeof e&&u[e]}function h(e){let t=Number(e.slice(7,-1));switch(!0){case isNaN(t):throw(0,o.T)("INVALID_VECTOR_VALUE",e);case t<=0:throw(0,o.T)("INVALID_VECTOR_SIZE",e);default:return t}}var p=n(7406);async function g(e,t){return{sharedInternalDocumentStore:t,docs:{},count:0}}async function b(e,t){let n=(0,p.HM)(e.sharedInternalDocumentStore,t);return e.docs[n]}async function m(e,t){let n=t.length,r=Array.from({length:n});for(let o=0;o<n;o++){let n=(0,p.HM)(e.sharedInternalDocumentStore,t[o]);r[o]=e.docs[n]}return r}async function y(e){return e.docs}async function v(e,t,n){let r=(0,p.HM)(e.sharedInternalDocumentStore,t);return void 0===e.docs[r]&&(e.docs[r]=n,e.count++,!0)}async function T(e,t){let n=(0,p.HM)(e.sharedInternalDocumentStore,t);return void 0!==e.docs[n]&&(delete e.docs[n],e.count--,!0)}async function w(e){return e.count}async function I(e,t){return{docs:t.docs,count:t.count,sharedInternalDocumentStore:e}}async function k(e){return{docs:e.docs,count:e.count}}async function S(){return{create:g,get:b,getMultiple:m,getAll:y,store:v,remove:T,count:w,load:I,save:k}}let D=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeLoad","afterLoad","afterCreate"];async function M(e,t){var n;let r=[],l=null===(n=e.plugins)||void 0===n?void 0:n.length;if(!l)return r;for(let n=0;n<l;n++)try{let o=await e.plugins[n];"function"==typeof o[t]&&r.push(o[t])}catch(e){throw console.error("Caught error in getAllPluginsByHook:",e),(0,o.T)("PLUGIN_CRASHED")}return r}var O=n(8287);function A(e){let t=e.r;return e.r=t.l,t.l=e,e.h=Math.max(x(e.l),x(e.r))+1,t.h=Math.max(x(t.l),x(t.r))+1,t}function R(e){let t=e.l;return e.l=t.r,t.r=e,e.h=Math.max(x(e.l),x(e.r))+1,t.h=Math.max(x(t.l),x(t.r))+1,t}function _(e,t,n=!1){let r=[];if(null===e)return r;let o=[e.root];for(;o.length>0;){let e=o.pop();e&&(n&&e.k>=t&&(0,l.hT)(r,e.v),!n&&e.k>t&&(0,l.hT)(r,e.v),o.push(e.r),o.push(e.l))}return r}function E(e,t,n=!1){let r=[];if(null===e)return r;let o=[e.root];for(;o.length>0;){let e=o.pop();e&&(n&&e.k<=t&&(0,l.hT)(r,e.v),!n&&e.k<t&&(0,l.hT)(r,e.v),o.push(e.r),o.push(e.l))}return r}function P(e,t){for(;null!==e;)if(t<e.k)e=e.l;else{if(!(t>e.k))return e;e=e.r}return null}function x(e){return null!==e?e.h:-1}function N(e,t){let n=Object.keys(t);if(1!==n.length)throw Error("Invalid operation");let r=n[0];switch(r){case"eq":{let n=t[r];return e.numberToDocumentId.get(n)??[]}case"in":{let n=t[r],o=[];for(let t of n){let n=e.numberToDocumentId.get(t);null!=n&&(0,l.hT)(o,n)}return o}case"nin":{let n=t[r],o=[];for(let t of e.numberToDocumentId.keys()){if(n.includes(t))continue;let r=e.numberToDocumentId.get(t);null!=r&&(0,l.hT)(o,r)}return o}}throw Error("Invalid operation")}function L(e,t){let n=Object.keys(t);if(1!==n.length)throw Error("Invalid operation");let r=n[0];if("containsAll"===r){let n=t[r].map(t=>e.numberToDocumentId.get(t)??[]);return(0,l.wf)(n)}throw Error("Invalid operation")}var C=n(5204);class z{constructor(e,t,n){this.k=e,this.s=t,this.e=n}c={};d=[];w="";toJSON(){return{w:this.w,s:this.s,c:this.c,d:this.d,e:this.e}}}function U(e,t){e.w=t.w+e.s}function $(e,t){e.d.push(t)}function W(e,t,n,r,o){if(e.e){let{w:i,d:a}=e;if(r&&i!==n)return{};if(null==(0,l.eg)(t,i)&&(o?Math.abs(n.length-i.length)<=o&&(0,C.j9)(n,i,o).isBounded&&(t[i]=[]):t[i]=[]),null!=(0,l.eg)(t,i)&&a.length>0){let e=new Set(t[i]),n=a.length;for(let t=0;t<n;t++)e.add(a[t]);t[i]=Array.from(e)}}for(let l of Object.keys(e.c))W(e.c[l],t,n,r,o);return t}function j(e,t){let n="",r=Math.min(e.length,t.length);for(let o=0;o<r&&e[o]===t[o];o++)n+=e[o];return n}function F(e=!1,t="",n=""){return new z(n,t,e)}function H(e,{term:t,exact:n,tolerance:r}){if(r&&!n){let n={};return!function e(t,n,r,o,i,a){if(!(o<0)){if(t.w.startsWith(n)){W(t,a,n,!1,0);return}if(t.e){let{w:e,d:r}=t;if(e&&((0,C.j9)(n,e,i).isBounded&&(a[e]=[]),null!=(0,l.eg)(a,e)&&r.length>0)){let t=new Set(a[e]),n=r.length;for(let e=0;e<n;e++)t.add(r[e]);a[e]=Array.from(t)}}if(!(r>=n.length)){for(let l in n[r]in t.c&&e(t.c[n[r]],n,r+1,o,i,a),e(t,n,r+1,o-1,i,a),t.c)e(t.c[l],n,r,o-1,i,a);for(let l in t.c)l!==n[r]&&e(t.c[l],n,r+1,o-1,i,a)}}}(e,t,0,(r=r||0)||0,r,n),n}{let o=t.length;for(let n=0;n<o;n++){let o=t[n];if(!(o in e.c))return{};{let l=e.c[o],i=l.s,a=t.substring(n),s=j(i,a).length;if(s!==i.length&&s!==a.length){if(r)break;return{}}n+=l.s.length-1,e=l}}let l={};return W(e,l,t,n,r),l}}function B(e,t){let n=Math.PI/180,r=e.lat*n,o=t.lat*n,l=(t.lat-e.lat)*n,i=(t.lon-e.lon)*n,a=Math.sin(l/2)*Math.sin(l/2)+Math.cos(r)*Math.cos(o)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371e3}function V(e,t){let n,r,o,l,i,a;let s=1/298.257223563,u=(1-1/298.257223563)*6378137,c=Math.PI/180,f=e.lat*c,d=t.lat*c,h=(t.lon-e.lon)*c,p=Math.atan((1-s)*Math.tan(f)),g=Math.atan((1-s)*Math.tan(d)),b=Math.sin(p),m=Math.cos(p),y=Math.sin(g),v=Math.cos(g),T=h,w=1e3;do{let e=Math.sin(T),t=Math.cos(T);a=Math.atan2(l=Math.sqrt(v*e*(v*e)+(m*y-b*v*t)*(m*y-b*v*t)),i=b*y+m*v*t);let u=i-2*b*y/(o=1-(r=m*v*e/l)*r),c=s/16*o*(4+s*(4-3*o));n=T,T=h+(1-c)*s*r*(a+c*l*(u+c*i*(-1+2*u*u)))}while(Math.abs(T-n)>1e-12&&--w>0);let I=o*(40680631590769-u*u)/(u*u),k=I/1024*(256+I*(-128+I*(74-47*I))),S=k*l*(i-2*b*y/o+k/4*(i*(-1+2*l*l)-k/6*a*(-3+4*l*l)*(-3+4*a*a)));return u*(1+I/16384*(4096+I*(-768+I*(320-175*I))))*(a-S)}var q=n(4891),G=n(2574);async function Y(e,t,n,r,o){let l=(0,p.HM)(e.sharedInternalDocumentStore,n);e.avgFieldLength[t]=((e.avgFieldLength[t]??0)*(o-1)+r.length)/o,e.fieldLengths[t][l]=r.length,e.frequencies[t][l]={}}async function K(e,t,n,r,o){let l=0;for(let e of r)e===o&&l++;let i=(0,p.HM)(e.sharedInternalDocumentStore,n),a=l/r.length;e.frequencies[t][i][o]=a,o in e.tokenOccurrences[t]||(e.tokenOccurrences[t][o]=0),e.tokenOccurrences[t][o]=(e.tokenOccurrences[t][o]??0)+1}async function X(e,t,n,r){let o=(0,p.HM)(e.sharedInternalDocumentStore,n);e.avgFieldLength[t]=(e.avgFieldLength[t]*r-e.fieldLengths[t][o])/(r-1),e.fieldLengths[t][o]=void 0,e.frequencies[t][o]=void 0}async function Z(e,t,n){e.tokenOccurrences[t][n]--}async function J(e,t,n,r,o){let l=Array.from(o),i=t.avgFieldLength[n],a=t.fieldLengths[n],s=t.tokenOccurrences[n],u=t.frequencies[n],c="number"==typeof s[r]?s[r]??0:0,f=[],d=l.length;for(let n=0;n<d;n++){var h;let o=(0,p.HM)(t.sharedInternalDocumentStore,l[n]),s=(null==u?void 0:null===(h=u[o])||void 0===h?void 0:h[r])??0,d=(0,q.D)(s,c,e.docsCount,a[o],i,e.params.relevance);f.push([o,d])}return f}async function Q(e,t,n,r,l=""){for(let[i,a]of(r||(r={sharedInternalDocumentStore:t,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}}),Object.entries(n))){let n=`${l}${l?".":""}${i}`;if("object"==typeof a&&!Array.isArray(a)){Q(e,t,a,r,n);continue}if(f(a))r.searchableProperties.push(n),r.searchablePropertiesWithTypes[n]=a,r.vectorIndexes[n]={size:h(a),vectors:{}};else{let e=/\[/.test(a);switch(a){case"boolean":case"boolean[]":r.indexes[n]={type:"Bool",node:{true:[],false:[]},isArray:e};break;case"number":case"number[]":r.indexes[n]={type:"AVL",node:{root:{k:0,v:[],l:null,r:null,h:0}},isArray:e};break;case"string":case"string[]":r.indexes[n]={type:"Radix",node:F(),isArray:e},r.avgFieldLength[n]=0,r.frequencies[n]={},r.tokenOccurrences[n]={},r.fieldLengths[n]={};break;case"enum":case"enum[]":r.indexes[n]={type:"Flat",node:{numberToDocumentId:new Map},isArray:e};break;case"geopoint":r.indexes[n]={type:"BKD",node:{root:null},isArray:e};break;default:throw(0,o.T)("INVALID_SCHEMA_TYPE",Array.isArray(a)?"array":a,n)}r.searchableProperties.push(n),r.searchablePropertiesWithTypes[n]=a}}return r}async function ee(e,t,n,r,o,l,i,a,s){if(f(l))return function(e,t,n,r){n instanceof Float32Array||(n=new Float32Array(n));let o=e.vectorIndexes[t].size,l=(0,G.T)(n,o);e.vectorIndexes[t].vectors[r]=[l,n]}(t,n,o,r);let u=async o=>{var l;let u=(0,p.HM)(t.sharedInternalDocumentStore,r),{type:c,node:f}=t.indexes[n];switch(c){case"Bool":f[o?"true":"false"].push(u);break;case"AVL":l=[u],f.root=function e(t,n,r){if(null===t)return{k:n,v:r,l:null,r:null,h:0};if(n<t.k)t.l=e(t.l,n,r);else if(n>t.k)t.r=e(t.r,n,r);else{for(let e of r)t.v.push(e);return t}t.h=1+Math.max(x(t.l),x(t.r));let o=x(t.l)-x(t.r);return o>1&&n<t.l.k?R(t):o<-1&&n>t.r.k?A(t):o>1&&n>t.l.k?(t.l=A(t.l),R(t)):o<-1&&n<t.r.k?(t.r=R(t.r),A(t)):t}(f.root,o,l);break;case"Radix":{let r=await a.tokenize(o,i,n);for(let o of(await e.insertDocumentScoreParameters(t,n,u,r,s),r))await e.insertTokenScoreParameters(t,n,u,r,o),function(e,t,n){let r=t.length;for(let o=0;o<r;o++){let r=t[o],l=t.substring(o),i=e.c[r];if(i){let a=i.s,s=a.length,u=j(a,l),c=u.length;if(a===l){$(i,n),i.e=!0;return}let f=a[c];if(c<s&&c===l.length){let t=F(!0,l,r);t.c[f]=i;let o=t.c[f];o.s=a.substring(c),o.k=f,e.c[r]=t,U(t,e),U(o,t),$(t,n);return}if(c<s&&c<l.length){let s=F(!1,u,r);s.c[f]=i,e.c[r]=s;let d=s.c[f];d.s=a.substring(c),d.k=f;let h=l[c],p=F(!0,t.substring(o+c),h);$(p,n),s.c[h]=p,U(s,e),U(p,s),U(d,s);return}o+=s-1,e=i}else{let t=F(!0,l,r);$(t,n),e.c[r]=t,U(t,e);return}}}(f,o,u);break}case"Flat":f.numberToDocumentId.has(o)?f.numberToDocumentId.get(o).push(u):f.numberToDocumentId.set(o,[u]);break;case"BKD":!function(e,t,n){let r={point:t,docIDs:n};if(null==e.root){e.root=r;return}let o=e.root,l=0;for(;null!==o;){if(o.point.lon===t.lon&&o.point.lat===t.lat){let e=o.docIDs??[];o.docIDs=Array.from(new Set([...e,...n||[]]));return}if(0==l%2){if(t.lon<o.point.lon){if(null==o.left){o.left=r;return}o=o.left}else{if(null==o.right){o.right=r;return}o=o.right}}else if(t.lat<o.point.lat){if(null==o.left){o.left=r;return}o=o.left}else{if(null==o.right){o.right=r;return}o=o.right}l++}}(f,o,[u])}};if(!d(l))return u(o);let c=o.length;for(let e=0;e<c;e++)await u(o[e])}async function et(e,t,n,r,o,l,i,a,s){let u=(0,p.HM)(t.sharedInternalDocumentStore,r);if(f(l))return delete t.vectorIndexes[n].vectors[r],!0;let{type:c,node:d}=t.indexes[n];switch(c){case"AVL":return!function(e,t,n){let r=P(e.root,n);if(r){if(1===r.v.length){!function(e,t){if(null===e||null===e.root)return;let n=e.root,r=null;for(;null!=n&&n.k!==t;)r=n,n=t<n.k?n.l:n.r;null!==n&&(()=>{if(null===n.l&&null===n.r)null===r?e.root=null:r.l===n?r.l=null:r.r=null;else if(null!=n.l&&null!=n.r){let e=n.r,t=n;for(;null!=e.l;)t=e,e=e.l;n.k=e.k,t===n?t.r=e.r:t.l=e.r}else{let t=null!=n.l?n.l:n.r;null===r?e.root=t:r.l===n?r.l=t:r.r=t}})()}(e,n);return}r.v.splice(r.v.indexOf(t),1)}}(d,u,o),!0;case"Bool":{let e=d[o?"true":"false"].indexOf(u);return d[o?"true":"false"].splice(e,1),!0}case"Radix":{let l=await a.tokenize(o,i,n);for(let o of(await e.removeDocumentScoreParameters(t,n,r,s),l))await e.removeTokenScoreParameters(t,n,o),function(e,t,n,r=!0){if(!t)return;let o=t.length;for(let l=0;l<o;l++){let o=t[l];if(!(o in e.c))return!1;{let i=e.c[o];l+=i.s.length-1,e=i,r&&e.w!==t||function(e,t){let n=e.d.indexOf(t);-1!==n&&e.d.splice(n,1)}(e,n)}}}(d,o,u);return!0}case"Flat":var h,g;return null==d||d.numberToDocumentId.set(o,(null===(h=null==d?void 0:d.numberToDocumentId.get(o))||void 0===h?void 0:h.filter(e=>e!==u))??[]),(null===(g=null==d?void 0:d.numberToDocumentId.get(o))||void 0===g?void 0:g.length)===0&&(null==d||d.numberToDocumentId.delete(o)),!0;case"BKD":return!function(e,t,n){let r=e.root,o=0,l=null,i=null;for(;null!==r;){if((null==r?void 0:r.point.lon)===t.lon&&r.point.lat===t.lat){var a,s;let t=null===(a=r.docIDs)||void 0===a?void 0:a.indexOf(n);if(void 0!==t&&t>-1){null===(s=r.docIDs)||void 0===s||s.splice(t,1),(null==r.docIDs||0===r.docIDs.length)&&(null!=l?"left"===i?l.left=null!==r.left?r.left:r.right:"right"===i&&(l.right=null!==r.right?r.right:r.left):e.root=null!==r.left?r.left:r.right);return}}let u=o%2;l=r,0===u?t.lon<r.point.lon?(r=null==r?void 0:r.left,i="left"):(r=null==r?void 0:r.right,i="right"):t.lat<r.point.lat?(r=null==r?void 0:r.left,i="left"):(r=null==r?void 0:r.right,i="right"),o++}}(d,o,u),!1}}async function en(e,t,n,r,o,l,i,a,s){if(!d(l))return et(e,t,n,r,o,l,i,a,s);let u=c[l],f=o.length;for(let l=0;l<f;l++)await et(e,t,n,r,o[l],u,i,a,s);return!0}async function er(e,t,n,r){if(!(n in t.tokenOccurrences))return[];let{node:i,type:a}=t.indexes[n];if("Radix"!==a)throw(0,o.T)("WRONG_SEARCH_PROPERTY_TYPE",n);let{exact:s,tolerance:u}=e.params,c=H(i,{term:r,exact:s,tolerance:u}),f=new Set;for(let e in c)if((0,l.eg)(c,e))for(let t of c[e])f.add(t);return e.index.calculateResultScores(e,t,n,r,Array.from(f))}async function eo(e,t,n){let r=Object.keys(n),i=r.reduce((e,t)=>({[t]:[],...e}),{});for(let a of r){let r=n[a];if(void 0===t.indexes[a])throw(0,o.T)("UNKNOWN_FILTER_PROPERTY",a);let{node:s,type:u,isArray:c}=t.indexes[a];if("Bool"===u){let e=s[r.toString()];(0,l.hT)(i[a],e);continue}if("BKD"===u){let e;if("radius"in r)e="radius";else if("polygon"in r)e="polygon";else throw Error(`Invalid operation ${r}`);if("radius"===e){let{value:t,coordinates:n,unit:o="m",inside:u=!0,highPrecision:c=!1}=r[e],f=(0,l.Mo)(t,o),d=function(e,t,n,r=!0,o="asc",l=!1){let i=l?V:B,a=[{node:e,depth:0}],s=[];for(;a.length>0;){let{node:e,depth:o}=a.pop();if(null===e)continue;let l=i(t,e.point);(r?l<=n:l>n)&&s.push({point:e.point,docIDs:e.docIDs??[]}),null!=e.left&&a.push({node:e.left,depth:o+1}),null!=e.right&&a.push({node:e.right,depth:o+1})}return o&&s.sort((e,n)=>{let r=i(t,e.point),l=i(t,n.point);return"asc"===o.toLowerCase()?r-l:l-r}),s}(s.root,n,f,u,void 0,c);(0,l.hT)(i[a],d.flatMap(({docIDs:e})=>e))}else{let{coordinates:t,inside:n=!0,highPrecision:o=!1}=r[e],u=function(e,t,n=!0,r=null,o=!1){let l=[{node:e,depth:0}],i=[];for(;l.length>0;){let e=l.pop();if(null==e||null==e.node)continue;let{node:r,depth:o}=e,a=o+1;null!=r.left&&l.push({node:r.left,depth:a}),null!=r.right&&l.push({node:r.right,depth:a});let s=function(e,t){let n=!1,r=t.lon,o=t.lat,l=e.length;for(let t=0,i=l-1;t<l;i=t++){let l=e[t].lon,a=e[t].lat,s=e[i].lon,u=e[i].lat;a>o!=u>o&&r<(s-l)*(o-a)/(u-a)+l&&(n=!n)}return n}(t,r.point);s&&n?i.push({point:r.point,docIDs:r.docIDs??[]}):s||n||i.push({point:r.point,docIDs:r.docIDs??[]})}let a=function(e){let t=0,n=0,r=0,o=e.length;for(let l=0,i=o-1;l<o;i=l++){let o=e[l].lon,a=e[l].lat,s=e[i].lon,u=e[i].lat,c=o*u-s*a;t+=c,n+=(o+s)*c,r+=(a+u)*c}let l=6*(t/=2);return{lon:n/=l,lat:r/=l}}(t);if(r){let e=o?V:B;i.sort((t,n)=>{let o=e(a,t.point),l=e(a,n.point);return"asc"===r.toLowerCase()?o-l:l-o})}return i}(s.root,t,n,void 0,o);(0,l.hT)(i[a],u.flatMap(({docIDs:e})=>e))}continue}if("Radix"===u&&("string"==typeof r||Array.isArray(r))){for(let t of[r].flat())for(let n of(await e.tokenizer.tokenize(t,e.language,a))){let e=H(s,{term:n,exact:!0});(0,l.hT)(i[a],Object.values(e).flat())}continue}let f=Object.keys(r);if(f.length>1)throw(0,o.T)("INVALID_FILTER_OPERATION",f.length);if("Flat"===u){let e=c?L:N;(0,l.hT)(i[a],e(s,r));continue}if("AVL"===u){let e=f[0],t=r[e],n=[];switch(e){case"gt":n=_(s,t,!1);break;case"gte":n=_(s,t,!0);break;case"lt":n=E(s,t,!1);break;case"lte":n=E(s,t,!0);break;case"eq":n=function(e,t){let n=P(e.root,t);return null===n?null:n.v}(s,t)??[];break;case"between":{let[e,r]=t;n=function(e,t,n){let r=[];return!function e(o){null!==o&&(t<o.k&&e(o.l),o.k>=t&&o.k<=n&&(0,l.hT)(r,o.v),n>o.k&&e(o.r))}(e.root),r}(s,e,r)}}(0,l.hT)(i[a],n)}}return(0,l.wf)(Object.values(i))}async function el(e){return e.searchableProperties}async function ei(e){return e.searchablePropertiesWithTypes}async function ea(e,t){let{indexes:n,vectorIndexes:r,searchableProperties:o,searchablePropertiesWithTypes:l,frequencies:i,tokenOccurrences:a,avgFieldLength:s,fieldLengths:u}=t,c={},f={};for(let e of Object.keys(n)){let{node:t,type:r,isArray:o}=n[e];switch(r){case"Radix":c[e]={type:"Radix",node:function e(t){let n=F(t.e,t.s,t.k);for(let r of(n.d=t.d,n.w=t.w,Object.keys(t.c)))n.c[r]=e(t.c[r]);return n}(t),isArray:o};break;case"Flat":c[e]={type:"Flat",node:{numberToDocumentId:new Map(t)},isArray:o};break;default:c[e]=n[e]}}for(let e of Object.keys(r)){let t=r[e].vectors;for(let e in t)t[e]=[t[e][0],new Float32Array(t[e][1])];f[e]={size:r[e].size,vectors:t}}return{sharedInternalDocumentStore:e,indexes:c,vectorIndexes:f,searchableProperties:o,searchablePropertiesWithTypes:l,frequencies:i,tokenOccurrences:a,avgFieldLength:s,fieldLengths:u}}async function es(e){let{indexes:t,vectorIndexes:n,searchableProperties:r,searchablePropertiesWithTypes:o,frequencies:l,tokenOccurrences:i,avgFieldLength:a,fieldLengths:s}=e,u={};for(let e of Object.keys(n)){let t=n[e].vectors;for(let e in t)t[e]=[t[e][0],Array.from(t[e][1])];u[e]={size:n[e].size,vectors:t}}let c={};for(let e of Object.keys(t)){let{type:n,node:r,isArray:o}=t[e];if("Flat"!==n){c[e]=t[e];continue}c[e]={type:"Flat",node:Array.from(r.numberToDocumentId.entries()),isArray:o}}return{indexes:c,vectorIndexes:u,searchableProperties:r,searchablePropertiesWithTypes:o,frequencies:l,tokenOccurrences:i,avgFieldLength:a,fieldLengths:s}}async function eu(){return{create:Q,insert:ee,remove:en,insertDocumentScoreParameters:Y,insertTokenScoreParameters:K,removeDocumentScoreParameters:X,removeTokenScoreParameters:Z,calculateResultScores:J,search:er,searchByWhereClause:eo,getSearchableProperties:el,getSearchablePropertiesWithTypes:ei,load:ea,save:es}}var ec=n(2012);async function ef(e,t,n,r){return(null==r?void 0:r.enabled)!==!1?function e(t,n,r,i,a){let s={language:t.tokenizer.language,sharedInternalDocumentStore:n,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(let[u,c]of Object.entries(r)){let r=`${a}${a?".":""}${u}`;if(!i.includes(r)){if("object"==typeof c&&!Array.isArray(c)){let o=e(t,n,c,i,r);(0,l.hT)(s.sortableProperties,o.sortableProperties),s.sorts={...s.sorts,...o.sorts},s.sortablePropertiesWithTypes={...s.sortablePropertiesWithTypes,...o.sortablePropertiesWithTypes};continue}if(!f(c))switch(c){case"boolean":case"number":case"string":s.sortableProperties.push(r),s.sortablePropertiesWithTypes[r]=c,s.sorts[r]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:c};break;case"geopoint":case"enum":case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw(0,o.T)("INVALID_SORT_SCHEMA_TYPE",Array.isArray(c)?"array":c,r)}}}return s}(e,t,n,(r||{}).unsortableProperties||[],""):{disabled:!0}}async function ed(e,t,n,r){if(!e.enabled)return;e.isSorted=!1;let o=(0,p.HM)(e.sharedInternalDocumentStore,n),l=e.sorts[t];l.orderedDocsToRemove.has(o)&&em(e,t),l.docs.set(o,l.orderedDocs.length),l.orderedDocs.push([o,r])}function eh(e){if(!e.isSorted&&e.enabled){for(let t of Object.keys(e.sorts))!function(e,t){let n;let r=e.sorts[t];switch(r.type){case"string":n=ep.bind(null,e.language);break;case"number":n=eg.bind(null);break;case"boolean":n=eb.bind(null)}r.orderedDocs.sort(n);let o=r.orderedDocs.length;for(let e=0;e<o;e++){let t=r.orderedDocs[e][0];r.docs.set(t,e)}}(e,t);e.isSorted=!0}}function ep(e,t,n){return t[1].localeCompare(n[1],(0,ec.Kd)(e))}function eg(e,t){return e[1]-t[1]}function eb(e,t){return t[1]?-1:1}function em(e,t){let n=e.sorts[t];n.orderedDocsToRemove.size&&(n.orderedDocs=n.orderedDocs.filter(e=>!n.orderedDocsToRemove.has(e[0])),n.orderedDocsToRemove.clear())}async function ey(e,t,n){if(!e.enabled)return;let r=e.sorts[t],o=(0,p.HM)(e.sharedInternalDocumentStore,n);r.docs.get(o)&&(r.docs.delete(o),r.orderedDocsToRemove.set(o,!0))}async function ev(e,t,n){if(!e.enabled)throw(0,o.T)("SORT_DISABLED");let r=n.property,l="DESC"===n.order,i=e.sorts[r];if(!i)throw(0,o.T)("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",r,e.sortableProperties.join(", "));return em(e,r),eh(e),t.sort((t,n)=>{let r=i.docs.get((0,p.HM)(e.sharedInternalDocumentStore,t[0])),o=i.docs.get((0,p.HM)(e.sharedInternalDocumentStore,n[0])),a=void 0!==r,s=void 0!==o;return a||s?a?s?l?o-r:r-o:-1:1:0}),t}async function eT(e){return e.enabled?e.sortableProperties:[]}async function ew(e){return e.enabled?e.sortablePropertiesWithTypes:{}}async function eI(e,t){if(!t.enabled)return{enabled:!1};let n=Object.keys(t.sorts).reduce((e,n)=>{let{docs:r,orderedDocs:o,type:l}=t.sorts[n];return e[n]={docs:new Map(Object.entries(r).map(([e,t])=>[+e,t])),orderedDocsToRemove:new Map,orderedDocs:o,type:l},e},{});return{sharedInternalDocumentStore:e,language:t.language,sortableProperties:t.sortableProperties,sortablePropertiesWithTypes:t.sortablePropertiesWithTypes,sorts:n,enabled:!0,isSorted:t.isSorted}}async function ek(e){if(!e.enabled)return{enabled:!1};!function(e){for(let t of Object.keys(e.sorts))em(e,t)}(e),eh(e);let t=Object.keys(e.sorts).reduce((t,n)=>{let{docs:r,orderedDocs:o,type:l}=e.sorts[n];return t[n]={docs:Object.fromEntries(r.entries()),orderedDocs:o,type:l},t},{});return{language:e.language,sortableProperties:e.sortableProperties,sortablePropertiesWithTypes:e.sortablePropertiesWithTypes,sorts:t,enabled:e.enabled,isSorted:e.isSorted}}async function eS(){return{create:ef,insert:ed,remove:ey,save:ek,load:eI,sortBy:ev,getSortableProperties:eT,getSortablePropertiesWithTypes:ew}}let eD=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115],eM={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},eO={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},eA="[aeiouy]",eR="[^aeiou][^aeiouy]*",e_=eA+"[aeiou]*",eE="^("+eR+")?"+e_+eR,eP="^("+eR+")?"+e_+eR+"("+e_+")?$",ex="^("+eR+")?"+e_+eR+e_+eR,eN="^("+eR+")?"+eA;function eL(e){let t,n,r,o,l,i;if(e.length<3)return e;let a=e.substring(0,1);if("y"==a&&(e=a.toUpperCase()+e.substring(1)),o=/^(.+?)([^s])s$/,(r=/^(.+?)(ss|i)es$/).test(e)?e=e.replace(r,"$1$2"):o.test(e)&&(e=e.replace(o,"$1$2")),o=/^(.+?)(ed|ing)$/,(r=/^(.+?)eed$/).test(e)){let t=r.exec(e);(r=new RegExp(eE)).test(t[1])&&(r=/.$/,e=e.replace(r,""))}else o.test(e)&&(t=o.exec(e)[1],(o=new RegExp(eN)).test(t)&&(e=t,o=/(at|bl|iz)$/,l=RegExp("([^aeiouylsz])\\1$"),i=RegExp("^"+eR+eA+"[^aeiouwxy]$"),o.test(e)?e+="e":l.test(e)?(r=/.$/,e=e.replace(r,"")):i.test(e)&&(e+="e")));if((r=/^(.+?)y$/).test(e)){let n=r.exec(e);t=null==n?void 0:n[1],r=new RegExp(eN),t&&r.test(t)&&(e=t+"i")}if((r=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/).test(e)){let o=r.exec(e);t=null==o?void 0:o[1],n=null==o?void 0:o[2],r=new RegExp(eE),t&&r.test(t)&&(e=t+eM[n])}if((r=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/).test(e)){let o=r.exec(e);t=null==o?void 0:o[1],n=null==o?void 0:o[2],r=new RegExp(eE),t&&r.test(t)&&(e=t+eO[n])}if(o=/^(.+?)(s|t)(ion)$/,(r=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/).test(e)){let n=r.exec(e);t=null==n?void 0:n[1],r=new RegExp(ex),t&&r.test(t)&&(e=t)}else if(o.test(e)){let n=o.exec(e);t=(null==n?void 0:n[1])??""+(null==n?void 0:n[2])??"",(o=new RegExp(ex)).test(t)&&(e=t)}if((r=/^(.+?)e$/).test(e)){let n=r.exec(e);t=null==n?void 0:n[1],r=new RegExp(ex),o=new RegExp(eP),l=RegExp("^"+eR+eA+"[^aeiouwxy]$"),t&&(r.test(t)||o.test(t)&&!l.test(t))&&(e=t)}return r=/ll$/,o=new RegExp(ex),r.test(e)&&o.test(e)&&(r=/.$/,e=e.replace(r,"")),"y"==a&&(e=a.toLowerCase()+e.substring(1)),e}function eC(e,t){var n;let r=`${this.language}:${e}:${t}`;return this.normalizationCache.has(r)?this.normalizationCache.get(r):(null===(n=this.stopWords)||void 0===n?void 0:n.includes(t))?(this.normalizationCache.set(r,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(e)&&(t=this.stemmer(t)),t=function(e){let t=[];for(let r=0;r<e.length;r++){var n;t[r]=(n=e.charCodeAt(r))<192||n>383?n:eD[n-192]||n}return String.fromCharCode(...t)}(t),this.normalizationCache.set(r,t),t)}function ez(e,t,n){let r;if(t&&t!==this.language)throw(0,o.T)("LANGUAGE_NOT_SUPPORTED",t);if("string"!=typeof e)return[e];if(n&&this.tokenizeSkipProperties.has(n))r=[this.normalizeToken.bind(this,n??"")(e)];else{let t=ec.zr[this.language];r=e.toLowerCase().split(t).map(this.normalizeToken.bind(this,n??"")).filter(Boolean)}let l=function(e){for(;""===e[e.length-1];)e.pop();for(;""===e[0];)e.shift();return e}(r);return this.allowDuplicates?l:Array.from(new Set(l))}async function eU(e={}){let t,n;if(e.language){if(!ec.E7.includes(e.language))throw(0,o.T)("LANGUAGE_NOT_SUPPORTED",e.language)}else e.language="english";if(e.stemming||e.stemmer&&!("stemming"in e)){if(e.stemmer){if("function"!=typeof e.stemmer)throw(0,o.T)("INVALID_STEMMER_FUNCTION_TYPE");t=e.stemmer}else if("english"===e.language)t=eL;else throw(0,o.T)("MISSING_STEMMER",e.language)}if(!1!==e.stopWords){if(n=[],Array.isArray(e.stopWords))n=e.stopWords;else if("function"==typeof e.stopWords)n=await e.stopWords(n);else if(e.stopWords)throw(0,o.T)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(n))throw(0,o.T)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(let e of n)if("string"!=typeof e)throw(0,o.T)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}let r={tokenize:ez,language:e.language,stemmer:t,stemmerSkipProperties:new Set(e.stemmerSkipProperties?[e.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(e.tokenizeSkipProperties?[e.tokenizeSkipProperties].flat():[]),stopWords:n,allowDuplicates:!!e.allowDuplicates,normalizeToken:eC,normalizationCache:new Map};return r.tokenize=ez.bind(r),r.normalizeToken=eC,r}async function e$({schema:e,sort:t,language:n,components:r,id:u,plugins:c}){r||(r={}),u||(u=await (0,l.EL)());let f=r.tokenizer,d=r.index,h=r.documentsStore,g=r.sorter;if(f=f?f.tokenize?f:await eU(f):await eU({language:n??"english"}),r.tokenizer&&n)throw(0,o.T)("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");let b=(0,p.Lo)();d||=await eu(),g||=await eS(),h||=await S(),function(e){let t={formatElapsedTime:i,getDocumentIndexId:a,getDocumentProperties:l.OX,validateSchema:s};for(let n of O.RI)if(e[n]){if("function"!=typeof e[n])throw(0,o.T)("COMPONENT_MUST_BE_FUNCTION",n)}else e[n]=t[n];for(let t of Object.keys(e))if(!O.me.includes(t)&&!O.RI.includes(t))throw(0,o.T)("UNSUPPORTED_COMPONENT",t)}(r);let{getDocumentProperties:m,getDocumentIndexId:y,validateSchema:v,formatElapsedTime:T}=r,w={data:{},caches:{},schema:e,tokenizer:f,index:d,sorter:g,documentsStore:h,internalDocumentIDStore:b,getDocumentProperties:m,getDocumentIndexId:y,validateSchema:v,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],afterUpdateMultiple:[],beforeUpdateMultiple:[],afterCreate:[],formatElapsedTime:T,id:u,plugins:c,version:"2.0.21"};for(let n of(w.data={index:await w.index.create(w,b,e),docs:await w.documentsStore.create(w,b),sorting:await w.sorter.create(w,b,e,t)},D))w[n]=(w[n]??[]).concat(await M(w,n));let I=w.afterCreate;return I&&await (0,O.ok)(I,w),w}let eW=Symbol("orama.insertions");Symbol("orama.removals");let ej=(null===(r=globalThis.process)||void 0===r?void 0:r.emitWarning)??function(e,t){console.warn(`[WARNING] [${t.code}] ${e}`)};async function eF(e,t,n,r){let l=await e.validateSchema(t,e.schema);if(l)throw(0,o.T)("SCHEMA_VALIDATION_FAILURE",l);return eV(e,t,n,r)}let eH=new Set(["enum","enum[]"]),eB=new Set(["string","number"]);async function eV(e,t,n,r){var l,i,a,s;let{index:u,docs:c}=e.data,h=await e.getDocumentIndexId(t);if("string"!=typeof h)throw(0,o.T)("DOCUMENT_ID_MUST_BE_STRING",typeof h);if(!await e.documentsStore.store(c,h,t))throw(0,o.T)("DOCUMENT_ALREADY_EXISTS",h);let p=await e.documentsStore.count(c);r||await (0,O.rf)(e.beforeInsert,e,h,t);let g=await e.index.getSearchableProperties(u),b=await e.index.getSearchablePropertiesWithTypes(u),m=await e.getDocumentProperties(t,g);for(let[e,t]of Object.entries(m)){if(void 0===t)continue;let n=typeof t,r=b[e];if(!("geopoint"===r&&"object"==typeof t&&"number"==typeof t.lon&&"number"==typeof t.lat||f(r)&&Array.isArray(t)||d(r)&&Array.isArray(t)||eH.has(r)&&eB.has(n))&&n!==r)throw(0,o.T)("INVALID_DOCUMENT_PROPERTY",e,r,n)}for(let t of g){let r=m[t];if(void 0===r)continue;let o=b[t];await (null===(i=(l=e.index).beforeInsert)||void 0===i?void 0:i.call(l,e.data.index,t,h,r,o,n,e.tokenizer,p)),await e.index.insert(e.index,e.data.index,t,h,r,o,n,e.tokenizer,p),await (null===(s=(a=e.index).afterInsert)||void 0===s?void 0:s.call(a,e.data.index,t,h,r,o,n,e.tokenizer,p))}let y=await e.sorter.getSortableProperties(e.data.sorting),v=await e.sorter.getSortablePropertiesWithTypes(e.data.sorting),T=await e.getDocumentProperties(t,y);for(let t of y){let r=T[t];if(void 0===r)continue;let o=v[t];await e.sorter.insert(e.data.sorting,t,h,r,o,n)}return r||await (0,O.rf)(e.afterInsert,e,h,t),"number"!=typeof e[eW]&&(queueMicrotask(()=>{e[eW]=void 0}),e[eW]=0),e[eW]>1e3?(ej("Orama's insert operation is synchronous. Please avoid inserting a large number of document in a single operation in order not to block the main thread or, in alternative, please use insertMultiple.",{code:"ORAMA0001"}),e[eW]=-1):e[eW]>=0&&e[eW]++,h}}}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[630],{6648:function(e,t,n){"use strict";n.d(t,{default:function(){return o.a}});var r=n(5601),o=n.n(r)},7138:function(e,t,n){"use strict";n.d(t,{default:function(){return o.a}});var r=n(231),o=n.n(r)},6463:function(e,t,n){"use strict";var r=n(1169);n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useServerInsertedHTML")&&n.d(t,{useServerInsertedHTML:function(){return r.useServerInsertedHTML}})},5601:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{default:function(){return s},getImageProps:function(){return l}});let r=n(9920),o=n(497),i=n(8173),a=r._(n(1241));function l(e){let{props:t}=(0,o.getImgProps)(e,{defaultLoader:a.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,n]of Object.entries(t))void 0===n&&delete t[e];return{props:t}}let s=i.Image},5322:function(e){e.exports={style:{fontFamily:"'__Arvo_7c3f16', '__Arvo_Fallback_7c3f16'",fontWeight:400,fontStyle:"normal"},className:"__className_7c3f16",variable:"__variable_7c3f16"}},7443:function(e){e.exports={style:{fontFamily:"'__Fira_Code_988d07', '__Fira_Code_Fallback_988d07'",fontWeight:400,fontStyle:"normal"},className:"__className_988d07",variable:"__variable_988d07"}},6475:function(e){e.exports={style:{fontFamily:"'__Lato_6c6f2f', '__Lato_Fallback_6c6f2f'",fontStyle:"normal"},className:"__className_6c6f2f",variable:"__variable_6c6f2f"}},4891:function(e,t,n){"use strict";n.d(t,{D:function(){return i},U:function(){return o}});var r=n(6855);function o(e,t,n=1,o){let i;if(0===t)throw(0,r.T)("INVALID_BOOST_VALUE");let a=new Map,l=e.length;for(let n=0;n<l;n++){let r=e[n],o=r.length;for(let e=0;e<o;e++){var s,u;let[n,o]=r[e],i=o*t,l=null===(s=a.get(n))||void 0===s?void 0:s[0];void 0!==l?a.set(n,[1.5*l+i,((null===(u=null==a?void 0:a.get(n))||void 0===u?void 0:u[1])||0)+1]):a.set(n,[i,1])}}let c=[];for(let e of a.entries())c.push([e[0],e[1][0]]);let f=c.sort((e,t)=>t[1]-e[1]);if(1===n)return f;let d=f.length,h=[];for(let e of a.entries())h.push([e[0],e[1][0],e[1][1]]);let p=h.sort((e,t)=>e[2]>t[2]?-1:e[2]<t[2]?1:e[1]>t[1]?-1:e[1]<t[1]?1:0);for(let e=0;e<d;e++)if(p[e][2]===o)i=e;else break;if(void 0===i){if(0===n)return[];i=0}let g=p.length,m=Array(g);for(let e=0;e<g;e++)m[e]=[p[e][0],p[e][1]];if(0===n)return m.slice(0,i+1);let b=i+Math.ceil(100*n*(d-i)/100);return m.slice(0,d+b)}function i(e,t,n,r,o,{k:i,b:a,d:l}){return Math.log(1+(n-t+.5)/(t+.5))*(l+e*(i+1))/(e+i*(1-a+a*r/o))}},2574:function(e,t,n){"use strict";function r(e,t){let n=0;for(let r=0;r<t;r++)n+=e[r]*e[r];return Math.sqrt(n)}function o(e,t,n,o=.8){let i=r(e,n),a=[];for(let[r,[l,s]]of Object.entries(t)){let t=0;for(let r=0;r<n;r++)t+=e[r]*s[r];let u=t/(i*l);u>=o&&a.push([r,u])}return a.sort((e,t)=>t[1]-e[1])}n.d(t,{M:function(){return o},T:function(){return r}})},3875:function(e,t,n){"use strict";n.d(t,{C1:function(){return f},Fv:function(){return l},L4:function(){return h},MM:function(){return p},fv:function(){return i},h0:function(){return d},k6:function(){return c},nX:function(){return a}});var r=n(6855),o=n(4479);async function i(e){return{raw:Number(e),formatted:await (0,o.Ed)(e)}}async function a(e){if(e.id){if("string"!=typeof e.id)throw(0,r.T)("DOCUMENT_ID_MUST_BE_STRING",typeof e.id);return e.id}return await (0,o.EL)()}async function l(e,t){for(let[n,o]of Object.entries(t)){let t=e[n];if(void 0!==t&&("geopoint"!==o||"object"!=typeof t||"number"!=typeof t.lon||"number"!=typeof t.lat)&&("enum"!==o||"string"!=typeof t&&"number"!=typeof t)){if("enum[]"===o&&Array.isArray(t)){let e=t.length;for(let r=0;r<e;r++)if("string"!=typeof t[r]&&"number"!=typeof t[r])return n+"."+r;continue}if(f(o)){let e=p(o);if(!Array.isArray(t)||t.length!==e)throw(0,r.T)("INVALID_INPUT_VECTOR",n,e,t.length);continue}if(d(o)){if(!Array.isArray(t))return n;let e=u[o],r=t.length;for(let o=0;o<r;o++)if(typeof t[o]!==e)return n+"."+o;continue}if("object"==typeof o){if(!t||"object"!=typeof t)return n;let e=await l(t,o);if(e)return n+"."+e;continue}if(typeof t!==o)return n}}}let s={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},u={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function c(e){return"geopoint"===e}function f(e){return"string"==typeof e&&/^vector\[\d+\]$/.test(e)}function d(e){return"string"==typeof e&&s[e]}function h(e){return u[e]}function p(e){let t=Number(e.slice(7,-1));switch(!0){case isNaN(t):throw(0,r.T)("INVALID_VECTOR_VALUE",e);case t<=0:throw(0,r.T)("INVALID_VECTOR_SIZE",e);default:return t}}},8287:function(e,t,n){"use strict";n.d(t,{RI:function(){return o},et:function(){return l},mX:function(){return a},me:function(){return r},ok:function(){return s},rf:function(){return i}});let r=["tokenizer","index","documentsStore","sorter"],o=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];async function i(e,t,n,r){let o=e.length;for(let i=0;i<o;i++)await e[i](t,n,r)}async function a(e,t,n,r,o){let i=e.length;for(let a=0;a<i;a++)await e[a](t,n,r,o)}async function l(e,t,n,r){let o=e.length;for(let i=0;i<o;i++)await e[i](t,n,r)}async function s(e,t){let n=e.length;for(let r=0;r<n;r++)await e[r](t)}},7406:function(e,t,n){"use strict";function r(){return{idToInternalId:new Map,internalIdToId:[],save:o,load:i}}function o(e){return{internalIdToId:e.internalIdToId}}function i(e,t){let{internalIdToId:n}=t;e.internalDocumentIDStore.idToInternalId.clear(),e.internalDocumentIDStore.internalIdToId=[];let r=n.length;for(let t=0;t<r;t++){let r=n[t];e.internalDocumentIDStore.idToInternalId.set(r,t+1),e.internalDocumentIDStore.internalIdToId.push(r)}}function a(e,t){if(e.internalIdToId.length<t)throw Error(`Invalid internalId ${t}`);return e.internalIdToId[t-1]}n.d(t,{HM:function(){return function e(t,n){if("string"==typeof n){let e=t.idToInternalId.get(n);if(e)return e;let r=t.idToInternalId.size+1;return t.idToInternalId.set(n,r),t.internalIdToId.push(n),r}return n>t.internalIdToId.length?e(t,n.toString()):n}},K7:function(){return a},Lo:function(){return r}})},5204:function(e,t,n){"use strict";function r(e,t,n){if(e===t)return 0;let r=e;e.length>t.length&&(e=t,t=r);let o=e.length,i=t.length,a=0;for(;a<o&&e.charCodeAt(a)===t.charCodeAt(a);)a++;if(a===o)return 0;for(;o>0&&e.charCodeAt(~-o)===t.charCodeAt(~-i);)o--,i--;if(!o)return i>n?-1:i;if(o-=a,i-=a,o<=n&&i<=n)return o>i?o:i;let l=i-o;if(n>i)n=i;else if(l>n)return -1;let s=0,u=[],c=[];for(;s<n;)c[s]=t.charCodeAt(a+s),u[s]=++s;for(;s<i;)c[s]=t.charCodeAt(a+s),u[s++]=n+1;let f=n-l,d=n<i,h=0,p=n,g=0,m=0,b=0,y=0,I=0;for(s=0;s<o;s++){for(m=s,g=s+1,y=e.charCodeAt(a+s),h+=s>f?1:0,p+=p<i?1:0,I=h;I<p;I++)b=g,g=m,m=u[I],y!==c[I]&&(m<g&&(g=m),b<g&&(g=b),g++),u[I]=g;if(d&&u[s+l]>n)return -1}return g<=n?g:-1}async function o(e,t,n){let o=r(e,t,n);return{distance:o,isBounded:o>=0}}function i(e,t,n){let o=r(e,t,n);return{distance:o,isBounded:o>=0}}n.d(t,{XQ:function(){return o},j9:function(){return i}})},2012:function(e,t,n){"use strict";n.d(t,{E7:function(){return i},Kd:function(){return a},zr:function(){return o}});let r={arabic:"ar",armenian:"am",bulgarian:"bg",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},o={dutch:/[^A-Za-zàèéìòóù0-9_'-]+/gim,english:/[^A-Za-zàèéìòóù0-9_'-]+/gim,french:/[^a-z0-9äâàéèëêïîöôùüûœç-]+/gim,italian:/[^A-Za-zàèéìòóù0-9_'-]+/gim,norwegian:/[^a-z0-9_æøåÆØÅäÄöÖüÜ]+/gim,portuguese:/[^a-z0-9à-úÀ-Ú]/gim,russian:/[^a-z0-9а-яА-ЯёЁ]+/gim,spanish:/[^a-z0-9A-Zá-úÁ-ÚñÑüÜ]+/gim,swedish:/[^a-z0-9_åÅäÄöÖüÜ-]+/gim,german:/[^a-z0-9A-ZäöüÄÖÜß]+/gim,finnish:/[^a-z0-9äöÄÖ]+/gim,danish:/[^a-z0-9æøåÆØÅ]+/gim,hungarian:/[^a-z0-9áéíóöőúüűÁÉÍÓÖŐÚÜŰ]+/gim,romanian:/[^a-z0-9ăâîșțĂÂÎȘȚ]+/gim,serbian:/[^a-z0-9čćžšđČĆŽŠĐ]+/gim,turkish:/[^a-z0-9çÇğĞıİöÖşŞüÜ]+/gim,lithuanian:/[^a-z0-9ąčęėįšųūžĄČĘĖĮŠŲŪŽ]+/gim,arabic:/[^a-z0-9أ-ي]+/gim,nepali:/[^a-z0-9अ-ह]+/gim,irish:/[^a-z0-9áéíóúÁÉÍÓÚ]+/gim,indian:/[^a-z0-9अ-ह]+/gim,armenian:/[^a-z0-9ա-ֆ]+/gim,greek:/[^a-z0-9α-ωά-ώ]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9а-яА-ЯіїєІЇЄ]+/gim,slovenian:/[^a-z0-9čžšČŽŠ]+/gim,bulgarian:/[^a-z0-9а-яА-Я]+/gim,tamil:/[^a-z0-9அ-ஹ]+/gim,sanskrit:/[^a-z0-9A-Zāīūṛḷṃṁḥśṣṭḍṇṅñḻḹṝ]+/gim},i=Object.keys(r);function a(e){return void 0!==e&&i.includes(e)?r[e]:void 0}},6855:function(e,t,n){"use strict";n.d(t,{T:function(){return l}});var r=n(2012),o=n(4479);let i=r.E7.join("\n - "),a={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:`Language "%s" is not supported.
Supported languages are:
 - ${i}`,INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.oramasearch.com/open-source/text-analysis/stemming for more information.',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:'Unsupported component "%s".',COMPONENT_MUST_BE_FUNCTION:'The component "%s" must be a function.',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:'The component "%s" must be a function or an array of functions.',INVALID_SCHEMA_TYPE:'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.',DOCUMENT_ID_MUST_BE_STRING:'Document id must be of type "string". Got "%s" instead.',DOCUMENT_ALREADY_EXISTS:'A document with id "%s" already exists.',DOCUMENT_DOES_NOT_EXIST:'A document with id "%s" does not exists.',MISSING_DOCUMENT_PROPERTY:'Missing searchable property "%s".',INVALID_DOCUMENT_PROPERTY:'Invalid document property "%s": expected "%s", got "%s"',UNKNOWN_INDEX:'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:'Cannot insert document due schema validation failure on "%s" property.',INVALID_SORT_SCHEMA_TYPE:'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".',CANNOT_SORT_BY_ARRAY:'Cannot configure sort for "%s" because it is an array (%s).',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:'Unable to sort on unknown field "%s". Allowed fields: %s',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.oramasearch for more information.",UNKNOWN_GROUP_BY_PROPERTY:'Unknown groupBy property "%s".',INVALID_GROUP_BY_PROPERTY:'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".',UNKNOWN_FILTER_PROPERTY:'Unknown filter property "%s".',INVALID_VECTOR_SIZE:'Vector size must be a number greater than 0. Got "%s" instead.',INVALID_VECTOR_VALUE:'Vector value must be a number greater than 0. Got "%s" instead.',INVALID_INPUT_VECTOR:`Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.
Input vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.`,WRONG_SEARCH_PROPERTY_TYPE:'Property "%s" is not searchable. Only "string" properties are searchable.',FACET_NOT_SUPPORTED:'Facet doens\'t support the type "%s".',INVALID_DISTANCE_SUFFIX:'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.',INVALID_SEARCH_MODE:'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:'"term" is a required parameter when performing hybrid search. Please provide a search term.',INVALID_VECTOR_INPUT:'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:"};function l(e,...t){let n=Error((0,o.gB)(a[e]??`Unsupported Orama Error code: ${e}`,...t));return n.code=e,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(n),n}},7949:function(e,t,n){"use strict";n.d(t,{U:function(){return eM}});var r=n(3875),o=n(4479),i=n(7406);async function a(e,t){return{sharedInternalDocumentStore:t,docs:{},count:0}}async function l(e,t){let n=(0,i.HM)(e.sharedInternalDocumentStore,t);return e.docs[n]}async function s(e,t){let n=t.length,r=Array.from({length:n});for(let o=0;o<n;o++){let n=(0,i.HM)(e.sharedInternalDocumentStore,t[o]);r[o]=e.docs[n]}return r}async function u(e){return e.docs}async function c(e,t,n){let r=(0,i.HM)(e.sharedInternalDocumentStore,t);return void 0===e.docs[r]&&(e.docs[r]=n,e.count++,!0)}async function f(e,t){let n=(0,i.HM)(e.sharedInternalDocumentStore,t);return void 0!==e.docs[n]&&(delete e.docs[n],e.count--,!0)}async function d(e){return e.count}async function h(e,t){return{docs:t.docs,count:t.count,sharedInternalDocumentStore:e}}async function p(e){return{docs:e.docs,count:e.count}}async function g(){return{create:a,get:l,getMultiple:s,getAll:u,store:c,remove:f,count:d,load:h,save:p}}var m=n(6855);let b=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeLoad","afterLoad","afterCreate"];async function y(e,t){var n;let r=[],o=null===(n=e.plugins)||void 0===n?void 0:n.length;if(!o)return r;for(let n=0;n<o;n++)try{let o=await e.plugins[n];"function"==typeof o[t]&&r.push(o[t])}catch(e){throw console.error("Caught error in getAllPluginsByHook:",e),(0,m.T)("PLUGIN_CRASHED")}return r}var I=n(8287);function v(e){let t=e.r;return e.r=t.l,t.l=e,e.h=Math.max(O(e.l),O(e.r))+1,t.h=Math.max(O(t.l),O(t.r))+1,t}function w(e){let t=e.l;return e.l=t.r,t.r=e,e.h=Math.max(O(e.l),O(e.r))+1,t.h=Math.max(O(t.l),O(t.r))+1,t}function T(e,t,n=!1){let r=[];if(null===e)return r;let i=[e.root];for(;i.length>0;){let e=i.pop();e&&(n&&e.k>=t&&(0,o.hT)(r,e.v),!n&&e.k>t&&(0,o.hT)(r,e.v),i.push(e.r),i.push(e.l))}return r}function S(e,t,n=!1){let r=[];if(null===e)return r;let i=[e.root];for(;i.length>0;){let e=i.pop();e&&(n&&e.k<=t&&(0,o.hT)(r,e.v),!n&&e.k<t&&(0,o.hT)(r,e.v),i.push(e.r),i.push(e.l))}return r}function _(e,t){for(;null!==e;)if(t<e.k)e=e.l;else{if(!(t>e.k))return e;e=e.r}return null}function O(e){return null!==e?e.h:-1}function D(e,t){let n=Object.keys(t);if(1!==n.length)throw Error("Invalid operation");let r=n[0];switch(r){case"eq":{let n=t[r];return e.numberToDocumentId.get(n)??[]}case"in":{let n=t[r],i=[];for(let t of n){let n=e.numberToDocumentId.get(t);null!=n&&(0,o.hT)(i,n)}return i}case"nin":{let n=t[r],i=[];for(let t of e.numberToDocumentId.keys()){if(n.includes(t))continue;let r=e.numberToDocumentId.get(t);null!=r&&(0,o.hT)(i,r)}return i}}throw Error("Invalid operation")}function k(e,t){let n=Object.keys(t);if(1!==n.length)throw Error("Invalid operation");let r=n[0];if("containsAll"===r){let n=t[r].map(t=>e.numberToDocumentId.get(t)??[]);return(0,o.wf)(n)}throw Error("Invalid operation")}var E=n(5204);class N{constructor(e,t,n){this.k=e,this.s=t,this.e=n}c={};d=[];w="";toJSON(){return{w:this.w,s:this.s,c:this.c,d:this.d,e:this.e}}}function A(e,t){e.w=t.w+e.s}function M(e,t){e.d.push(t)}function x(e,t,n,r,i){if(e.e){let{w:a,d:l}=e;if(r&&a!==n)return{};if(null==(0,o.eg)(t,a)&&(i?Math.abs(n.length-a.length)<=i&&(0,E.j9)(n,a,i).isBounded&&(t[a]=[]):t[a]=[]),null!=(0,o.eg)(t,a)&&l.length>0){let e=new Set(t[a]),n=l.length;for(let t=0;t<n;t++)e.add(l[t]);t[a]=Array.from(e)}}for(let o of Object.keys(e.c))x(e.c[o],t,n,r,i);return t}function P(e,t){let n="",r=Math.min(e.length,t.length);for(let o=0;o<r&&e[o]===t[o];o++)n+=e[o];return n}function R(e=!1,t="",n=""){return new N(n,t,e)}function C(e,{term:t,exact:n,tolerance:r}){if(r&&!n){let n={};return!function e(t,n,r,i,a,l){if(!(i<0)){if(t.w.startsWith(n)){x(t,l,n,!1,0);return}if(t.e){let{w:e,d:r}=t;if(e&&((0,E.j9)(n,e,a).isBounded&&(l[e]=[]),null!=(0,o.eg)(l,e)&&r.length>0)){let t=new Set(l[e]),n=r.length;for(let e=0;e<n;e++)t.add(r[e]);l[e]=Array.from(t)}}if(!(r>=n.length)){for(let o in n[r]in t.c&&e(t.c[n[r]],n,r+1,i,a,l),e(t,n,r+1,i-1,a,l),t.c)e(t.c[o],n,r,i-1,a,l);for(let o in t.c)o!==n[r]&&e(t.c[o],n,r+1,i-1,a,l)}}}(e,t,0,(r=r||0)||0,r,n),n}{let o=t.length;for(let n=0;n<o;n++){let o=t[n];if(!(o in e.c))return{};{let i=e.c[o],a=i.s,l=t.substring(n),s=P(a,l).length;if(s!==a.length&&s!==l.length){if(r)break;return{}}n+=i.s.length-1,e=i}}let i={};return x(e,i,t,n,r),i}}function z(e,t){let n=Math.PI/180,r=e.lat*n,o=t.lat*n,i=(t.lat-e.lat)*n,a=(t.lon-e.lon)*n,l=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r)*Math.cos(o)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}function U(e,t){let n,r,o,i,a,l;let s=1/298.257223563,u=(1-1/298.257223563)*6378137,c=Math.PI/180,f=e.lat*c,d=t.lat*c,h=(t.lon-e.lon)*c,p=Math.atan((1-s)*Math.tan(f)),g=Math.atan((1-s)*Math.tan(d)),m=Math.sin(p),b=Math.cos(p),y=Math.sin(g),I=Math.cos(g),v=h,w=1e3;do{let e=Math.sin(v),t=Math.cos(v);l=Math.atan2(i=Math.sqrt(I*e*(I*e)+(b*y-m*I*t)*(b*y-m*I*t)),a=m*y+b*I*t);let u=a-2*m*y/(o=1-(r=b*I*e/i)*r),c=s/16*o*(4+s*(4-3*o));n=v,v=h+(1-c)*s*r*(l+c*i*(u+c*a*(-1+2*u*u)))}while(Math.abs(v-n)>1e-12&&--w>0);let T=o*(40680631590769-u*u)/(u*u),S=T/1024*(256+T*(-128+T*(74-47*T))),_=S*i*(a-2*m*y/o+S/4*(a*(-1+2*i*i)-S/6*l*(-3+4*i*i)*(-3+4*l*l)));return u*(1+T/16384*(4096+T*(-768+T*(320-175*T))))*(l-_)}var L=n(4891),j=n(2574);async function B(e,t,n,r,o){let a=(0,i.HM)(e.sharedInternalDocumentStore,n);e.avgFieldLength[t]=((e.avgFieldLength[t]??0)*(o-1)+r.length)/o,e.fieldLengths[t][a]=r.length,e.frequencies[t][a]={}}async function W(e,t,n,r,o){let a=0;for(let e of r)e===o&&a++;let l=(0,i.HM)(e.sharedInternalDocumentStore,n),s=a/r.length;e.frequencies[t][l][o]=s,o in e.tokenOccurrences[t]||(e.tokenOccurrences[t][o]=0),e.tokenOccurrences[t][o]=(e.tokenOccurrences[t][o]??0)+1}async function V(e,t,n,r){let o=(0,i.HM)(e.sharedInternalDocumentStore,n);e.avgFieldLength[t]=(e.avgFieldLength[t]*r-e.fieldLengths[t][o])/(r-1),e.fieldLengths[t][o]=void 0,e.frequencies[t][o]=void 0}async function F(e,t,n){e.tokenOccurrences[t][n]--}async function $(e,t,n,r,o){let a=Array.from(o),l=t.avgFieldLength[n],s=t.fieldLengths[n],u=t.tokenOccurrences[n],c=t.frequencies[n],f="number"==typeof u[r]?u[r]??0:0,d=[],h=a.length;for(let n=0;n<h;n++){var p;let o=(0,i.HM)(t.sharedInternalDocumentStore,a[n]),u=(null==c?void 0:null===(p=c[o])||void 0===p?void 0:p[r])??0,h=(0,L.D)(u,f,e.docsCount,s[o],l,e.params.relevance);d.push([o,h])}return d}async function H(e,t,n,o,i=""){for(let[a,l]of(o||(o={sharedInternalDocumentStore:t,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}}),Object.entries(n))){let n=`${i}${i?".":""}${a}`;if("object"==typeof l&&!Array.isArray(l)){H(e,t,l,o,n);continue}if((0,r.C1)(l))o.searchableProperties.push(n),o.searchablePropertiesWithTypes[n]=l,o.vectorIndexes[n]={size:(0,r.MM)(l),vectors:{}};else{let e=/\[/.test(l);switch(l){case"boolean":case"boolean[]":o.indexes[n]={type:"Bool",node:{true:[],false:[]},isArray:e};break;case"number":case"number[]":o.indexes[n]={type:"AVL",node:{root:{k:0,v:[],l:null,r:null,h:0}},isArray:e};break;case"string":case"string[]":o.indexes[n]={type:"Radix",node:R(),isArray:e},o.avgFieldLength[n]=0,o.frequencies[n]={},o.tokenOccurrences[n]={},o.fieldLengths[n]={};break;case"enum":case"enum[]":o.indexes[n]={type:"Flat",node:{numberToDocumentId:new Map},isArray:e};break;case"geopoint":o.indexes[n]={type:"BKD",node:{root:null},isArray:e};break;default:throw(0,m.T)("INVALID_SCHEMA_TYPE",Array.isArray(l)?"array":l,n)}o.searchableProperties.push(n),o.searchablePropertiesWithTypes[n]=l}}return o}async function G(e,t,n,o,a,l,s,u,c){if((0,r.C1)(l))return function(e,t,n,r){n instanceof Float32Array||(n=new Float32Array(n));let o=e.vectorIndexes[t].size,i=(0,j.T)(n,o);e.vectorIndexes[t].vectors[r]=[i,n]}(t,n,a,o);let f=async r=>{var a;let l=(0,i.HM)(t.sharedInternalDocumentStore,o),{type:f,node:d}=t.indexes[n];switch(f){case"Bool":d[r?"true":"false"].push(l);break;case"AVL":a=[l],d.root=function e(t,n,r){if(null===t)return{k:n,v:r,l:null,r:null,h:0};if(n<t.k)t.l=e(t.l,n,r);else if(n>t.k)t.r=e(t.r,n,r);else{for(let e of r)t.v.push(e);return t}t.h=1+Math.max(O(t.l),O(t.r));let o=O(t.l)-O(t.r);return o>1&&n<t.l.k?w(t):o<-1&&n>t.r.k?v(t):o>1&&n>t.l.k?(t.l=v(t.l),w(t)):o<-1&&n<t.r.k?(t.r=w(t.r),v(t)):t}(d.root,r,a);break;case"Radix":{let o=await u.tokenize(r,s,n);for(let r of(await e.insertDocumentScoreParameters(t,n,l,o,c),o))await e.insertTokenScoreParameters(t,n,l,o,r),function(e,t,n){let r=t.length;for(let o=0;o<r;o++){let r=t[o],i=t.substring(o),a=e.c[r];if(a){let l=a.s,s=l.length,u=P(l,i),c=u.length;if(l===i){M(a,n),a.e=!0;return}let f=l[c];if(c<s&&c===i.length){let t=R(!0,i,r);t.c[f]=a;let o=t.c[f];o.s=l.substring(c),o.k=f,e.c[r]=t,A(t,e),A(o,t),M(t,n);return}if(c<s&&c<i.length){let s=R(!1,u,r);s.c[f]=a,e.c[r]=s;let d=s.c[f];d.s=l.substring(c),d.k=f;let h=i[c],p=R(!0,t.substring(o+c),h);M(p,n),s.c[h]=p,A(s,e),A(p,s),A(d,s);return}o+=s-1,e=a}else{let t=R(!0,i,r);M(t,n),e.c[r]=t,A(t,e);return}}}(d,r,l);break}case"Flat":d.numberToDocumentId.has(r)?d.numberToDocumentId.get(r).push(l):d.numberToDocumentId.set(r,[l]);break;case"BKD":!function(e,t,n){let r={point:t,docIDs:n};if(null==e.root){e.root=r;return}let o=e.root,i=0;for(;null!==o;){if(o.point.lon===t.lon&&o.point.lat===t.lat){let e=o.docIDs??[];o.docIDs=Array.from(new Set([...e,...n||[]]));return}if(0==i%2){if(t.lon<o.point.lon){if(null==o.left){o.left=r;return}o=o.left}else{if(null==o.right){o.right=r;return}o=o.right}}else if(t.lat<o.point.lat){if(null==o.left){o.left=r;return}o=o.left}else{if(null==o.right){o.right=r;return}o=o.right}i++}}(d,r,[l])}};if(!(0,r.h0)(l))return f(a);let d=a.length;for(let e=0;e<d;e++)await f(a[e])}async function Y(e,t,n,o,a,l,s,u,c){let f=(0,i.HM)(t.sharedInternalDocumentStore,o);if((0,r.C1)(l))return delete t.vectorIndexes[n].vectors[o],!0;let{type:d,node:h}=t.indexes[n];switch(d){case"AVL":return!function(e,t,n){let r=_(e.root,n);if(r){if(1===r.v.length){!function(e,t){if(null===e||null===e.root)return;let n=e.root,r=null;for(;null!=n&&n.k!==t;)r=n,n=t<n.k?n.l:n.r;null!==n&&(()=>{if(null===n.l&&null===n.r)null===r?e.root=null:r.l===n?r.l=null:r.r=null;else if(null!=n.l&&null!=n.r){let e=n.r,t=n;for(;null!=e.l;)t=e,e=e.l;n.k=e.k,t===n?t.r=e.r:t.l=e.r}else{let t=null!=n.l?n.l:n.r;null===r?e.root=t:r.l===n?r.l=t:r.r=t}})()}(e,n);return}r.v.splice(r.v.indexOf(t),1)}}(h,f,a),!0;case"Bool":{let e=h[a?"true":"false"].indexOf(f);return h[a?"true":"false"].splice(e,1),!0}case"Radix":{let r=await u.tokenize(a,s,n);for(let i of(await e.removeDocumentScoreParameters(t,n,o,c),r))await e.removeTokenScoreParameters(t,n,i),function(e,t,n,r=!0){if(!t)return;let o=t.length;for(let i=0;i<o;i++){let o=t[i];if(!(o in e.c))return!1;{let a=e.c[o];i+=a.s.length-1,e=a,r&&e.w!==t||function(e,t){let n=e.d.indexOf(t);-1!==n&&e.d.splice(n,1)}(e,n)}}}(h,i,f);return!0}case"Flat":var p,g;return null==h||h.numberToDocumentId.set(a,(null===(p=null==h?void 0:h.numberToDocumentId.get(a))||void 0===p?void 0:p.filter(e=>e!==f))??[]),(null===(g=null==h?void 0:h.numberToDocumentId.get(a))||void 0===g?void 0:g.length)===0&&(null==h||h.numberToDocumentId.delete(a)),!0;case"BKD":return!function(e,t,n){let r=e.root,o=0,i=null,a=null;for(;null!==r;){if((null==r?void 0:r.point.lon)===t.lon&&r.point.lat===t.lat){var l,s;let t=null===(l=r.docIDs)||void 0===l?void 0:l.indexOf(n);if(void 0!==t&&t>-1){null===(s=r.docIDs)||void 0===s||s.splice(t,1),(null==r.docIDs||0===r.docIDs.length)&&(null!=i?"left"===a?i.left=null!==r.left?r.left:r.right:"right"===a&&(i.right=null!==r.right?r.right:r.left):e.root=null!==r.left?r.left:r.right);return}}let u=o%2;i=r,0===u?t.lon<r.point.lon?(r=null==r?void 0:r.left,a="left"):(r=null==r?void 0:r.right,a="right"):t.lat<r.point.lat?(r=null==r?void 0:r.left,a="left"):(r=null==r?void 0:r.right,a="right"),o++}}(h,a,f),!1}}async function X(e,t,n,o,i,a,l,s,u){if(!(0,r.h0)(a))return Y(e,t,n,o,i,a,l,s,u);let c=(0,r.L4)(a),f=i.length;for(let r=0;r<f;r++)await Y(e,t,n,o,i[r],c,l,s,u);return!0}async function q(e,t,n,r){if(!(n in t.tokenOccurrences))return[];let{node:i,type:a}=t.indexes[n];if("Radix"!==a)throw(0,m.T)("WRONG_SEARCH_PROPERTY_TYPE",n);let{exact:l,tolerance:s}=e.params,u=C(i,{term:r,exact:l,tolerance:s}),c=new Set;for(let e in u)if((0,o.eg)(u,e))for(let t of u[e])c.add(t);return e.index.calculateResultScores(e,t,n,r,Array.from(c))}async function K(e,t,n){let r=Object.keys(n),i=r.reduce((e,t)=>({[t]:[],...e}),{});for(let a of r){let r=n[a];if(void 0===t.indexes[a])throw(0,m.T)("UNKNOWN_FILTER_PROPERTY",a);let{node:l,type:s,isArray:u}=t.indexes[a];if("Bool"===s){let e=l[r.toString()];(0,o.hT)(i[a],e);continue}if("BKD"===s){let e;if("radius"in r)e="radius";else if("polygon"in r)e="polygon";else throw Error(`Invalid operation ${r}`);if("radius"===e){let{value:t,coordinates:n,unit:s="m",inside:u=!0,highPrecision:c=!1}=r[e],f=(0,o.Mo)(t,s),d=function(e,t,n,r=!0,o="asc",i=!1){let a=i?U:z,l=[{node:e,depth:0}],s=[];for(;l.length>0;){let{node:e,depth:o}=l.pop();if(null===e)continue;let i=a(t,e.point);(r?i<=n:i>n)&&s.push({point:e.point,docIDs:e.docIDs??[]}),null!=e.left&&l.push({node:e.left,depth:o+1}),null!=e.right&&l.push({node:e.right,depth:o+1})}return o&&s.sort((e,n)=>{let r=a(t,e.point),i=a(t,n.point);return"asc"===o.toLowerCase()?r-i:i-r}),s}(l.root,n,f,u,void 0,c);(0,o.hT)(i[a],d.flatMap(({docIDs:e})=>e))}else{let{coordinates:t,inside:n=!0,highPrecision:s=!1}=r[e],u=function(e,t,n=!0,r=null,o=!1){let i=[{node:e,depth:0}],a=[];for(;i.length>0;){let e=i.pop();if(null==e||null==e.node)continue;let{node:r,depth:o}=e,l=o+1;null!=r.left&&i.push({node:r.left,depth:l}),null!=r.right&&i.push({node:r.right,depth:l});let s=function(e,t){let n=!1,r=t.lon,o=t.lat,i=e.length;for(let t=0,a=i-1;t<i;a=t++){let i=e[t].lon,l=e[t].lat,s=e[a].lon,u=e[a].lat;l>o!=u>o&&r<(s-i)*(o-l)/(u-l)+i&&(n=!n)}return n}(t,r.point);s&&n?a.push({point:r.point,docIDs:r.docIDs??[]}):s||n||a.push({point:r.point,docIDs:r.docIDs??[]})}let l=function(e){let t=0,n=0,r=0,o=e.length;for(let i=0,a=o-1;i<o;a=i++){let o=e[i].lon,l=e[i].lat,s=e[a].lon,u=e[a].lat,c=o*u-s*l;t+=c,n+=(o+s)*c,r+=(l+u)*c}let i=6*(t/=2);return{lon:n/=i,lat:r/=i}}(t);if(r){let e=o?U:z;a.sort((t,n)=>{let o=e(l,t.point),i=e(l,n.point);return"asc"===r.toLowerCase()?o-i:i-o})}return a}(l.root,t,n,void 0,s);(0,o.hT)(i[a],u.flatMap(({docIDs:e})=>e))}continue}if("Radix"===s&&("string"==typeof r||Array.isArray(r))){for(let t of[r].flat())for(let n of(await e.tokenizer.tokenize(t,e.language,a))){let e=C(l,{term:n,exact:!0});(0,o.hT)(i[a],Object.values(e).flat())}continue}let c=Object.keys(r);if(c.length>1)throw(0,m.T)("INVALID_FILTER_OPERATION",c.length);if("Flat"===s){let e=u?k:D;(0,o.hT)(i[a],e(l,r));continue}if("AVL"===s){let e=c[0],t=r[e],n=[];switch(e){case"gt":n=T(l,t,!1);break;case"gte":n=T(l,t,!0);break;case"lt":n=S(l,t,!1);break;case"lte":n=S(l,t,!0);break;case"eq":n=function(e,t){let n=_(e.root,t);return null===n?null:n.v}(l,t)??[];break;case"between":{let[e,r]=t;n=function(e,t,n){let r=[];return!function e(i){null!==i&&(t<i.k&&e(i.l),i.k>=t&&i.k<=n&&(0,o.hT)(r,i.v),n>i.k&&e(i.r))}(e.root),r}(l,e,r)}}(0,o.hT)(i[a],n)}}return(0,o.wf)(Object.values(i))}async function Z(e){return e.searchableProperties}async function Q(e){return e.searchablePropertiesWithTypes}async function J(e,t){let{indexes:n,vectorIndexes:r,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:a,tokenOccurrences:l,avgFieldLength:s,fieldLengths:u}=t,c={},f={};for(let e of Object.keys(n)){let{node:t,type:r,isArray:o}=n[e];switch(r){case"Radix":c[e]={type:"Radix",node:function e(t){let n=R(t.e,t.s,t.k);for(let r of(n.d=t.d,n.w=t.w,Object.keys(t.c)))n.c[r]=e(t.c[r]);return n}(t),isArray:o};break;case"Flat":c[e]={type:"Flat",node:{numberToDocumentId:new Map(t)},isArray:o};break;default:c[e]=n[e]}}for(let e of Object.keys(r)){let t=r[e].vectors;for(let e in t)t[e]=[t[e][0],new Float32Array(t[e][1])];f[e]={size:r[e].size,vectors:t}}return{sharedInternalDocumentStore:e,indexes:c,vectorIndexes:f,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:a,tokenOccurrences:l,avgFieldLength:s,fieldLengths:u}}async function ee(e){let{indexes:t,vectorIndexes:n,searchableProperties:r,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:a,avgFieldLength:l,fieldLengths:s}=e,u={};for(let e of Object.keys(n)){let t=n[e].vectors;for(let e in t)t[e]=[t[e][0],Array.from(t[e][1])];u[e]={size:n[e].size,vectors:t}}let c={};for(let e of Object.keys(t)){let{type:n,node:r,isArray:o}=t[e];if("Flat"!==n){c[e]=t[e];continue}c[e]={type:"Flat",node:Array.from(r.numberToDocumentId.entries()),isArray:o}}return{indexes:c,vectorIndexes:u,searchableProperties:r,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:a,avgFieldLength:l,fieldLengths:s}}async function et(){return{create:H,insert:G,remove:X,insertDocumentScoreParameters:B,insertTokenScoreParameters:W,removeDocumentScoreParameters:V,removeTokenScoreParameters:F,calculateResultScores:$,search:q,searchByWhereClause:K,getSearchableProperties:Z,getSearchablePropertiesWithTypes:Q,load:J,save:ee}}var en=n(2012);async function er(e,t,n,i){return(null==i?void 0:i.enabled)!==!1?function e(t,n,i,a,l){let s={language:t.tokenizer.language,sharedInternalDocumentStore:n,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(let[u,c]of Object.entries(i)){let i=`${l}${l?".":""}${u}`;if(!a.includes(i)){if("object"==typeof c&&!Array.isArray(c)){let r=e(t,n,c,a,i);(0,o.hT)(s.sortableProperties,r.sortableProperties),s.sorts={...s.sorts,...r.sorts},s.sortablePropertiesWithTypes={...s.sortablePropertiesWithTypes,...r.sortablePropertiesWithTypes};continue}if(!(0,r.C1)(c))switch(c){case"boolean":case"number":case"string":s.sortableProperties.push(i),s.sortablePropertiesWithTypes[i]=c,s.sorts[i]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:c};break;case"geopoint":case"enum":case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw(0,m.T)("INVALID_SORT_SCHEMA_TYPE",Array.isArray(c)?"array":c,i)}}}return s}(e,t,n,(i||{}).unsortableProperties||[],""):{disabled:!0}}async function eo(e,t,n,r){if(!e.enabled)return;e.isSorted=!1;let o=(0,i.HM)(e.sharedInternalDocumentStore,n),a=e.sorts[t];a.orderedDocsToRemove.has(o)&&eu(e,t),a.docs.set(o,a.orderedDocs.length),a.orderedDocs.push([o,r])}function ei(e){if(!e.isSorted&&e.enabled){for(let t of Object.keys(e.sorts))!function(e,t){let n;let r=e.sorts[t];switch(r.type){case"string":n=ea.bind(null,e.language);break;case"number":n=el.bind(null);break;case"boolean":n=es.bind(null)}r.orderedDocs.sort(n);let o=r.orderedDocs.length;for(let e=0;e<o;e++){let t=r.orderedDocs[e][0];r.docs.set(t,e)}}(e,t);e.isSorted=!0}}function ea(e,t,n){return t[1].localeCompare(n[1],(0,en.Kd)(e))}function el(e,t){return e[1]-t[1]}function es(e,t){return t[1]?-1:1}function eu(e,t){let n=e.sorts[t];n.orderedDocsToRemove.size&&(n.orderedDocs=n.orderedDocs.filter(e=>!n.orderedDocsToRemove.has(e[0])),n.orderedDocsToRemove.clear())}async function ec(e,t,n){if(!e.enabled)return;let r=e.sorts[t],o=(0,i.HM)(e.sharedInternalDocumentStore,n);r.docs.get(o)&&(r.docs.delete(o),r.orderedDocsToRemove.set(o,!0))}async function ef(e,t,n){if(!e.enabled)throw(0,m.T)("SORT_DISABLED");let r=n.property,o="DESC"===n.order,a=e.sorts[r];if(!a)throw(0,m.T)("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",r,e.sortableProperties.join(", "));return eu(e,r),ei(e),t.sort((t,n)=>{let r=a.docs.get((0,i.HM)(e.sharedInternalDocumentStore,t[0])),l=a.docs.get((0,i.HM)(e.sharedInternalDocumentStore,n[0])),s=void 0!==r,u=void 0!==l;return s||u?s?u?o?l-r:r-l:-1:1:0}),t}async function ed(e){return e.enabled?e.sortableProperties:[]}async function eh(e){return e.enabled?e.sortablePropertiesWithTypes:{}}async function ep(e,t){if(!t.enabled)return{enabled:!1};let n=Object.keys(t.sorts).reduce((e,n)=>{let{docs:r,orderedDocs:o,type:i}=t.sorts[n];return e[n]={docs:new Map(Object.entries(r).map(([e,t])=>[+e,t])),orderedDocsToRemove:new Map,orderedDocs:o,type:i},e},{});return{sharedInternalDocumentStore:e,language:t.language,sortableProperties:t.sortableProperties,sortablePropertiesWithTypes:t.sortablePropertiesWithTypes,sorts:n,enabled:!0,isSorted:t.isSorted}}async function eg(e){if(!e.enabled)return{enabled:!1};!function(e){for(let t of Object.keys(e.sorts))eu(e,t)}(e),ei(e);let t=Object.keys(e.sorts).reduce((t,n)=>{let{docs:r,orderedDocs:o,type:i}=e.sorts[n];return t[n]={docs:Object.fromEntries(r.entries()),orderedDocs:o,type:i},t},{});return{language:e.language,sortableProperties:e.sortableProperties,sortablePropertiesWithTypes:e.sortablePropertiesWithTypes,sorts:t,enabled:e.enabled,isSorted:e.isSorted}}async function em(){return{create:er,insert:eo,remove:ec,save:eg,load:ep,sortBy:ef,getSortableProperties:ed,getSortablePropertiesWithTypes:eh}}let eb=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115],ey={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},eI={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},ev="[aeiouy]",ew="[^aeiou][^aeiouy]*",eT=ev+"[aeiou]*",eS="^("+ew+")?"+eT+ew,e_="^("+ew+")?"+eT+ew+"("+eT+")?$",eO="^("+ew+")?"+eT+ew+eT+ew,eD="^("+ew+")?"+ev;function ek(e){let t,n,r,o,i,a;if(e.length<3)return e;let l=e.substring(0,1);if("y"==l&&(e=l.toUpperCase()+e.substring(1)),o=/^(.+?)([^s])s$/,(r=/^(.+?)(ss|i)es$/).test(e)?e=e.replace(r,"$1$2"):o.test(e)&&(e=e.replace(o,"$1$2")),o=/^(.+?)(ed|ing)$/,(r=/^(.+?)eed$/).test(e)){let t=r.exec(e);(r=new RegExp(eS)).test(t[1])&&(r=/.$/,e=e.replace(r,""))}else o.test(e)&&(t=o.exec(e)[1],(o=new RegExp(eD)).test(t)&&(e=t,o=/(at|bl|iz)$/,i=RegExp("([^aeiouylsz])\\1$"),a=RegExp("^"+ew+ev+"[^aeiouwxy]$"),o.test(e)?e+="e":i.test(e)?(r=/.$/,e=e.replace(r,"")):a.test(e)&&(e+="e")));if((r=/^(.+?)y$/).test(e)){let n=r.exec(e);t=null==n?void 0:n[1],r=new RegExp(eD),t&&r.test(t)&&(e=t+"i")}if((r=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/).test(e)){let o=r.exec(e);t=null==o?void 0:o[1],n=null==o?void 0:o[2],r=new RegExp(eS),t&&r.test(t)&&(e=t+ey[n])}if((r=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/).test(e)){let o=r.exec(e);t=null==o?void 0:o[1],n=null==o?void 0:o[2],r=new RegExp(eS),t&&r.test(t)&&(e=t+eI[n])}if(o=/^(.+?)(s|t)(ion)$/,(r=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/).test(e)){let n=r.exec(e);t=null==n?void 0:n[1],r=new RegExp(eO),t&&r.test(t)&&(e=t)}else if(o.test(e)){let n=o.exec(e);t=(null==n?void 0:n[1])??""+(null==n?void 0:n[2])??"",(o=new RegExp(eO)).test(t)&&(e=t)}if((r=/^(.+?)e$/).test(e)){let n=r.exec(e);t=null==n?void 0:n[1],r=new RegExp(eO),o=new RegExp(e_),i=RegExp("^"+ew+ev+"[^aeiouwxy]$"),t&&(r.test(t)||o.test(t)&&!i.test(t))&&(e=t)}return r=/ll$/,o=new RegExp(eO),r.test(e)&&o.test(e)&&(r=/.$/,e=e.replace(r,"")),"y"==l&&(e=l.toLowerCase()+e.substring(1)),e}function eE(e,t){var n;let r=`${this.language}:${e}:${t}`;return this.normalizationCache.has(r)?this.normalizationCache.get(r):(null===(n=this.stopWords)||void 0===n?void 0:n.includes(t))?(this.normalizationCache.set(r,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(e)&&(t=this.stemmer(t)),t=function(e){let t=[];for(let r=0;r<e.length;r++){var n;t[r]=(n=e.charCodeAt(r))<192||n>383?n:eb[n-192]||n}return String.fromCharCode(...t)}(t),this.normalizationCache.set(r,t),t)}function eN(e,t,n){let r;if(t&&t!==this.language)throw(0,m.T)("LANGUAGE_NOT_SUPPORTED",t);if("string"!=typeof e)return[e];if(n&&this.tokenizeSkipProperties.has(n))r=[this.normalizeToken.bind(this,n??"")(e)];else{let t=en.zr[this.language];r=e.toLowerCase().split(t).map(this.normalizeToken.bind(this,n??"")).filter(Boolean)}let o=function(e){for(;""===e[e.length-1];)e.pop();for(;""===e[0];)e.shift();return e}(r);return this.allowDuplicates?o:Array.from(new Set(o))}async function eA(e={}){let t,n;if(e.language){if(!en.E7.includes(e.language))throw(0,m.T)("LANGUAGE_NOT_SUPPORTED",e.language)}else e.language="english";if(e.stemming||e.stemmer&&!("stemming"in e)){if(e.stemmer){if("function"!=typeof e.stemmer)throw(0,m.T)("INVALID_STEMMER_FUNCTION_TYPE");t=e.stemmer}else if("english"===e.language)t=ek;else throw(0,m.T)("MISSING_STEMMER",e.language)}if(!1!==e.stopWords){if(n=[],Array.isArray(e.stopWords))n=e.stopWords;else if("function"==typeof e.stopWords)n=await e.stopWords(n);else if(e.stopWords)throw(0,m.T)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(n))throw(0,m.T)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(let e of n)if("string"!=typeof e)throw(0,m.T)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}let r={tokenize:eN,language:e.language,stemmer:t,stemmerSkipProperties:new Set(e.stemmerSkipProperties?[e.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(e.tokenizeSkipProperties?[e.tokenizeSkipProperties].flat():[]),stopWords:n,allowDuplicates:!!e.allowDuplicates,normalizeToken:eE,normalizationCache:new Map};return r.tokenize=eN.bind(r),r.normalizeToken=eE,r}async function eM({schema:e,sort:t,language:n,components:a,id:l,plugins:s}){a||(a={}),l||(l=await (0,o.EL)());let u=a.tokenizer,c=a.index,f=a.documentsStore,d=a.sorter;if(u=u?u.tokenize?u:await eA(u):await eA({language:n??"english"}),a.tokenizer&&n)throw(0,m.T)("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");let h=(0,i.Lo)();c||=await et(),d||=await em(),f||=await g(),function(e){let t={formatElapsedTime:r.fv,getDocumentIndexId:r.nX,getDocumentProperties:o.OX,validateSchema:r.Fv};for(let n of I.RI)if(e[n]){if("function"!=typeof e[n])throw(0,m.T)("COMPONENT_MUST_BE_FUNCTION",n)}else e[n]=t[n];for(let t of Object.keys(e))if(!I.me.includes(t)&&!I.RI.includes(t))throw(0,m.T)("UNSUPPORTED_COMPONENT",t)}(a);let{getDocumentProperties:p,getDocumentIndexId:v,validateSchema:w,formatElapsedTime:T}=a,S={data:{},caches:{},schema:e,tokenizer:u,index:c,sorter:d,documentsStore:f,internalDocumentIDStore:h,getDocumentProperties:p,getDocumentIndexId:v,validateSchema:w,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],afterUpdateMultiple:[],beforeUpdateMultiple:[],afterCreate:[],formatElapsedTime:T,id:l,plugins:s,version:"2.0.21"};for(let n of(S.data={index:await S.index.create(S,h,e),docs:await S.documentsStore.create(S,h),sorting:await S.sorter.create(S,h,e,t)},b))S[n]=(S[n]??[]).concat(await y(S,n));let _=S.afterCreate;return _&&await (0,I.ok)(_,S),S}},7466:function(e,t,n){"use strict";n.d(t,{$T:function(){return u}});var r,o=n(3875),i=n(8287);let a=Symbol("orama.insertions");Symbol("orama.removals");let l=(null===(r=globalThis.process)||void 0===r?void 0:r.emitWarning)??function(e,t){console.warn(`[WARNING] [${t.code}] ${e}`)};var s=n(6855);async function u(e,t,n,r){let o=await e.validateSchema(t,e.schema);if(o)throw(0,s.T)("SCHEMA_VALIDATION_FAILURE",o);return d(e,t,n,r)}let c=new Set(["enum","enum[]"]),f=new Set(["string","number"]);async function d(e,t,n,r){var u,d,h,p;let{index:g,docs:m}=e.data,b=await e.getDocumentIndexId(t);if("string"!=typeof b)throw(0,s.T)("DOCUMENT_ID_MUST_BE_STRING",typeof b);if(!await e.documentsStore.store(m,b,t))throw(0,s.T)("DOCUMENT_ALREADY_EXISTS",b);let y=await e.documentsStore.count(m);r||await (0,i.rf)(e.beforeInsert,e,b,t);let I=await e.index.getSearchableProperties(g),v=await e.index.getSearchablePropertiesWithTypes(g),w=await e.getDocumentProperties(t,I);for(let[e,t]of Object.entries(w)){if(void 0===t)continue;let n=typeof t,r=v[e];if(!((0,o.k6)(r)&&"object"==typeof t&&"number"==typeof t.lon&&"number"==typeof t.lat||(0,o.C1)(r)&&Array.isArray(t)||(0,o.h0)(r)&&Array.isArray(t)||c.has(r)&&f.has(n))&&n!==r)throw(0,s.T)("INVALID_DOCUMENT_PROPERTY",e,r,n)}for(let t of I){let r=w[t];if(void 0===r)continue;let o=v[t];await (null===(d=(u=e.index).beforeInsert)||void 0===d?void 0:d.call(u,e.data.index,t,b,r,o,n,e.tokenizer,y)),await e.index.insert(e.index,e.data.index,t,b,r,o,n,e.tokenizer,y),await (null===(p=(h=e.index).afterInsert)||void 0===p?void 0:p.call(h,e.data.index,t,b,r,o,n,e.tokenizer,y))}let T=await e.sorter.getSortableProperties(e.data.sorting),S=await e.sorter.getSortablePropertiesWithTypes(e.data.sorting),_=await e.getDocumentProperties(t,T);for(let t of T){let r=_[t];if(void 0===r)continue;let o=S[t];await e.sorter.insert(e.data.sorting,t,b,r,o,n)}return r||await (0,i.rf)(e.afterInsert,e,b,t),"number"!=typeof e[a]&&(queueMicrotask(()=>{e[a]=void 0}),e[a]=0),e[a]>1e3?(l("Orama's insert operation is synchronous. Please avoid inserting a large number of document in a single operation in order not to block the main thread or, in alternative, please use insertMultiple.",{code:"ORAMA0001"}),e[a]=-1):e[a]>=0&&e[a]++,b}},4479:function(e,t,n){"use strict";n.d(t,{EL:function(){return g},Ed:function(){return h},Mo:function(){return T},OX:function(){return I},Sf:function(){return v},XN:function(){return p},XO:function(){return b},ZL:function(){return S},eg:function(){return m},gB:function(){return f},hT:function(){return c},wf:function(){return y}});var r=n(6855),o=n(357);let i=Date.now().toString().slice(5),a=0,l=BigInt(1e3),s=BigInt(1e6),u=BigInt(1e9);function c(e,t){if(t.length<65535)Array.prototype.push.apply(e,t);else{let n=t.length;for(let r=0;r<n;r+=65535)Array.prototype.push.apply(e,t.slice(r,r+65535))}}function f(e,...t){return e.replace(/%(?:(?<position>\d+)\$)?(?<width>-?\d*\.?\d*)(?<type>[dfs])/g,function(...e){let{width:n,type:r,position:o}=e[e.length-1],i=o?t[Number.parseInt(o)-1]:t.shift(),a=""===n?0:Number.parseInt(n);switch(r){case"d":return i.toString().padStart(a,"0");case"f":{let e=i,[t,r]=n.split(".").map(e=>Number.parseFloat(e));return"number"==typeof r&&r>=0&&(e=e.toFixed(r)),"number"==typeof t&&t>=0?e.toString().padStart(a,"0"):e.toString()}case"s":return a<0?i.toString().padEnd(-a," "):i.toString().padStart(a," ");default:return i}})}function d(){return BigInt(Math.floor(1e6*performance.now()))}async function h(e){return("number"==typeof e&&(e=BigInt(e)),e<l)?`${e}ns`:e<s?`${e/l}μs`:e<u?`${e/s}ms`:`${e/u}s`}async function p(){var e;return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?d():void 0!==o&&o.release&&"node"===o.release.name||void 0!==o&&"function"==typeof(null==o?void 0:null===(e=o.hrtime)||void 0===e?void 0:e.bigint)?o.hrtime.bigint():"undefined"!=typeof performance?d():BigInt(0)}async function g(){return`${i}-${a++}`}function m(e,t){return void 0===Object.hasOwn?Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0:Object.hasOwn(e,t)?e[t]:void 0}function b(e,t){return t[1]===e[1]?e[0]-t[0]:t[1]-e[1]}function y(e){if(0===e.length)return[];if(1===e.length)return e[0];for(let t=1;t<e.length;t++)if(e[t].length<e[0].length){let n=e[0];e[0]=e[t],e[t]=n}let t=new Map;for(let n of e[0])t.set(n,1);for(let n=1;n<e.length;n++){let r=0;for(let o of e[n]){let e=t.get(o);e===n&&(t.set(o,e+1),r++)}if(0===r)return[]}return e[0].filter(n=>{let r=t.get(n);return void 0!==r&&t.set(n,0),r===e.length})}async function I(e,t){let n={},r=t.length;for(let o=0;o<r;o++){let r=t[o],i=r.split("."),a=e,l=i.length;for(let e=0;e<l;e++)if("object"==typeof(a=a[i[e]])){if(null!==a&&"lat"in a&&"lon"in a&&"number"==typeof a.lat&&"number"==typeof a.lon){a=n[r]=a;break}if(!Array.isArray(a)&&null!==a&&e===l-1){a=void 0;break}}else if((null===a||"object"!=typeof a)&&e<l-1){a=void 0;break}void 0!==a&&(n[r]=a)}return n}async function v(e,t){return(await I(e,[t]))[t]}let w={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function T(e,t){let n=w[t];if(void 0===n)throw Error((0,r.T)("INVALID_DISTANCE_SUFFIX",e).message);return e*n}function S(e,t){e.hits=e.hits.map(e=>({...e,document:{...e.document,...t.reduce((e,t)=>{let n=t.split("."),r=n.pop(),o=e;for(let e of n)o[e]=o[e]??{},o=o[e];return o[r]=null,e},e.document)}}))}},1534:function(e,t,n){"use strict";n.d(t,{Ui:function(){return x},bv:function(){return C}});var r=n(7406),o=n(6855),i=n(4479);let a="fulltext";var l=n(4891);function s(e,t){return e[1]-t[1]}function u(e,t){return t[1]-e[1]}async function c(e,t,n){let r={},a=t.map(([e])=>e),l=await e.documentsStore.getMultiple(e.data.docs,a),c=Object.keys(n),h=await e.index.getSearchablePropertiesWithTypes(e.data.index);for(let e of c){let t;if("number"===h[e]){let{ranges:r}=n[e],o=r.length,i=Array.from({length:o});for(let e=0;e<o;e++){let t=r[e];i[e]=[`${t.from}-${t.to}`,0]}t=Object.fromEntries(i)}r[e]={count:0,values:t??{}}}let p=l.length;for(let e=0;e<p;e++){let t=l[e];for(let e of c){let a=e.includes(".")?await (0,i.Sf)(t,e):t[e],l=h[e],s=r[e].values;switch(l){case"number":f(n[e].ranges,s)(a);break;case"number[]":{let t=new Set,r=f(n[e].ranges,s,t);for(let e of a)r(e);break}case"boolean":case"enum":case"string":d(s,l)(a);break;case"boolean[]":case"enum[]":case"string[]":{let e=d(s,"boolean[]"===l?"boolean":"string",new Set);for(let t of a)e(t);break}default:throw(0,o.T)("FACET_NOT_SUPPORTED",l)}}}for(let e of c){let t=r[e];if(t.count=Object.keys(t.values).length,"string"===h[e]){let r=n[e],o=function(e="desc"){return"asc"===e.toLowerCase()?s:u}(r.sort);t.values=Object.fromEntries(Object.entries(t.values).sort(o).slice(r.offset??0,r.limit??10))}}return r}function f(e,t,n){return r=>{for(let o of e){let e=`${o.from}-${o.to}`;(null==n||!n.has(e))&&r>=o.from&&r<=o.to&&(void 0===t[e]?t[e]=1:(t[e]++,null==n||n.add(e)))}}}function d(e,t,n){let r="boolean"===t?"false":"";return t=>{let o=(null==t?void 0:t.toString())??r;null!=n&&n.has(o)||(e[o]=(e[o]??0)+1,null==n||n.add(o))}}function h(e,t){let n=new Map,r=[];for(let t of e)n.set(t,!0);for(let e of t){let[t]=e;n.has(t)&&(r.push(e),n.delete(t))}return r}let p={reducer:(e,t,n,r)=>(t[r]=n,t),getInitialValue:e=>Array.from({length:e})},g=["string","number","boolean"];async function m(e,t,n){let a=n.properties,l=a.length,s=await e.index.getSearchablePropertiesWithTypes(e.data.index);for(let e=0;e<l;e++){let t=a[e];if(void 0===s[t])throw(0,o.T)("UNKNOWN_GROUP_BY_PROPERTY",t);if(!g.includes(s[t]))throw(0,o.T)("INVALID_GROUP_BY_PROPERTY",t,g.join(", "),s[t])}let u=t.map(([t])=>(0,r.K7)(e.internalDocumentIDStore,t)),c=await e.documentsStore.getMultiple(e.data.docs,u),f=c.length,d=n.maxResult||Number.MAX_SAFE_INTEGER,h=[],m={};for(let e=0;e<l;e++){let t=a[e],n={property:t,perValue:{}},r=new Set;for(let e=0;e<f;e++){let o=c[e],a=await (0,i.Sf)(o,t);if(void 0===a)continue;let l="boolean"!=typeof a?a:""+a,s=n.perValue[l]??{indexes:[],count:0};s.count>=d||(s.indexes.push(e),s.count++,n.perValue[l]=s,r.add(a))}h.push(Array.from(r)),m[t]=n}let b=function e(t,n=0){if(n+1===t.length)return t[n].map(e=>[e]);let r=t[n],o=e(t,n+1),a=[];for(let e of r)for(let t of o){let n=[e];(0,i.hT)(n,t),a.push(n)}return a}(h),y=b.length,I=[];for(let e=0;e<y;e++){let t=b[e],n=t.length,r={values:[],indexes:[]},o=[];for(let e=0;e<n;e++){let n=t[e],i=a[e];o.push(m[i].perValue["boolean"!=typeof n?n:""+n].indexes),r.values.push(n)}r.indexes=(0,i.wf)(o).sort((e,t)=>e-t),0!==r.indexes.length&&I.push(r)}let v=I.length,w=Array.from({length:v});for(let e=0;e<v;e++){let r=I[e],o=n.reduce||p,i=r.indexes.map(e=>({id:u[e],score:t[e][1],document:c[e]})),a=o.reducer.bind(null,r.values),l=o.getInitialValue(r.indexes.length),s=i.reduce(a,l);w[e]={values:r.values,result:s}}return w}var b=n(8287);async function y(e,t,n){let a;let s=await (0,i.XN)();e.beforeSearch&&await (0,b.et)(e.beforeSearch,e,t,n),t.relevance=Object.assign(D,t.relevance??{});let u=Object.keys(e.data.index.vectorIndexes),f=t.facets&&Object.keys(t.facets).length>0,{limit:d=10,offset:p=0,term:g,properties:y,threshold:I=1,distinctOn:v,includeVectors:w=!1}=t,T=!0===t.preflight,{index:S,docs:_}=e.data,O=await e.tokenizer.tokenize(g??"",n),E=e.caches.propertiesToSearch;if(!E){let t=await e.index.getSearchablePropertiesWithTypes(S);E=(E=await e.index.getSearchableProperties(S)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=E}if(y&&"*"!==y){for(let e of y)if(!E.includes(e))throw(0,o.T)("UNKNOWN_INDEX",e,E.join(", "));E=E.filter(e=>y.includes(e))}let M=await k(e.tokenizer,e.index,e.documentsStore,n,t,E,O,await e.documentsStore.count(_),s),x=Object.keys(t.where??{}).length>0,P=[];x&&(P=await e.index.searchByWhereClause(M,S,t.where));let R=O.length;if(R||(null==y?void 0:y.length)){let n=E.length;for(let r=0;r<n;r++){var C;let n=E[r],o=M.indexMap[n];if(0!==R)for(let t=0;t<R;t++){let r=O[t],a=await e.index.search(M,S,n,r);(0,i.hT)(o[r],a)}else{o[""]=[];let t=await e.index.search(M,S,n,"");(0,i.hT)(o[""],t)}let a=Object.values(o);M.docsIntersection[n]=(0,l.U)(a,(null==t?void 0:null===(C=t.boost)||void 0===C?void 0:C[n])??1,I,R);let s=M.docsIntersection[n],u=s.length;for(let e=0;e<u;e++){let[t,n]=s[e],r=M.uniqueDocsIDs[t];r?M.uniqueDocsIDs[t]=r+n+.5:M.uniqueDocsIDs[t]=n}}}else 0===O.length&&g?M.uniqueDocsIDs={}:M.uniqueDocsIDs=Object.fromEntries(Object.keys(await e.documentsStore.getAll(e.data.docs)).map(e=>[e,0]));let z=Object.entries(M.uniqueDocsIDs).map(([e,t])=>[+e,t]);if(x&&(z=h(P,z)),t.sortBy){if("function"==typeof t.sortBy){let n=z.map(([e])=>e),r=(await e.documentsStore.getMultiple(e.data.docs,n)).map((e,t)=>[z[t][0],z[t][1],e]);r.sort(t.sortBy),z=r.map(([e,t])=>[e,t])}else z=await e.sorter.sortBy(e.data.sorting,z,t.sortBy).then(t=>t.map(([t,n])=>[(0,r.HM)(e.internalDocumentIDStore,t),n]))}else z=z.sort(i.XO);T||(a=await (v?N(e,z,p,d,v):A(e,z,p,d)));let U={elapsed:{formatted:"",raw:0},hits:[],count:z.length};if(void 0===a||(U.hits=a.filter(Boolean),w||(0,i.ZL)(U,u)),f){let n=await c(e,z,t.facets);U.facets=n}return t.groupBy&&(U.groups=await m(e,z,t.groupBy)),e.afterSearch&&await (0,b.mX)(e.afterSearch,e,t,n,U),U.elapsed=await e.formatElapsedTime(await (0,i.XN)()-M.timeStart),U}var I=n(2574);async function v(e,t,n="english"){let a=await (0,i.XN)();e.beforeSearch&&await (0,b.et)(e.beforeSearch,e,t,n);let{vector:l}=t;if(l&&(!("value"in l)||!("property"in l)))throw(0,o.T)("INVALID_VECTOR_INPUT",Object.keys(l).join(", "));let{limit:s=10,offset:u=0,includeVectors:f=!1}=t,d=e.data.index.vectorIndexes[l.property],p=d.size,g=d.vectors,y=t.facets&&Object.keys(t.facets).length>0,v=Object.keys(t.where??{}).length>0,{index:w,docs:T}=e.data;if((null==l?void 0:l.value.length)!==p)throw(0,o.T)("INVALID_INPUT_VECTOR",null==l?void 0:l.property,p,null==l?void 0:l.value.length);l instanceof Float32Array||(l.value=new Float32Array(l.value));let S=(0,I.M)(l.value,g,p,t.similarity).map(([t,n])=>[(0,r.HM)(e.internalDocumentIDStore,t),n]),_=e.caches.propertiesToSearch;if(!_){let t=await e.index.getSearchablePropertiesWithTypes(w);_=(_=await e.index.getSearchableProperties(w)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=_}let O=await k(e.tokenizer,e.index,e.documentsStore,n,t,_,[],await e.documentsStore.count(T),a);v&&(S=h(await e.index.searchByWhereClause(O,w,t.where),S));let D=[];y&&(D=await c(e,S,t.facets));let E=Array.from({length:s});for(let t=0;t<s;t++){let n=S[t+u];if(!n)break;let o=e.data.docs.docs[n[0]];if(o){f||(o[l.property]=null);let i={id:(0,r.K7)(e.internalDocumentIDStore,n[0]),score:n[1],document:o};E[t]=i}}let N=[];t.groupBy&&(N=await m(e,S,t.groupBy)),e.afterSearch&&await (0,b.mX)(e.afterSearch,e,t,n,S);let A=await (0,i.XN)()-a;return{count:S.length,hits:E.filter(Boolean),elapsed:{raw:Number(A),formatted:await (0,i.Ed)(A)},...D?{facets:D}:{},...N?{groups:N}:{}}}async function w(e,t,n){let r,a;let l=await (0,i.XN)();e.beforeSearch&&await (0,b.et)(e.beforeSearch,e,t,n);let{offset:s=0,limit:u=10,includeVectors:f=!1}=t,d=t.facets&&Object.keys(t.facets).length>0,[p,g]=await Promise.all([T(e,t,n),S(e,t)]),{index:y,docs:I}=e.data,v=t.hybridWeights,w=function(e,t,n,r){let o=Math.max.apply(Math,e.map(_)),i=Math.max.apply(Math,t.map(_)),{text:a,vector:l}=r&&r.text&&r.vector?r:{text:.5,vector:.5},s=new Map,u=e.length,c=(e,t)=>e*a+t*l;for(let t=0;t<u;t++){let[n,r]=e[t],i=c(r/o,0);s.set(n,i)}let f=t.length;for(let e=0;e<f;e++){let[n,r]=t[e],o=r/i,a=s.get(n)??0;s.set(n,a+c(0,o))}return[...s].sort((e,t)=>t[1]-e[1])}(p,g,t.term,v),O=await e.tokenizer.tokenize(t.term??"",n),D=e.caches.propertiesToSearch;if(!D){let t=await e.index.getSearchablePropertiesWithTypes(y);D=(D=await e.index.getSearchableProperties(y)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=D}if(t.properties&&"*"!==t.properties){for(let e of t.properties)if(!D.includes(e))throw(0,o.T)("UNKNOWN_INDEX",e,D.join(", "));D=D.filter(e=>t.properties.includes(e))}let E=await k(e.tokenizer,e.index,e.documentsStore,n,t,D,O,await e.documentsStore.count(I),l),N=Object.keys(t.where??{}).length>0;N&&(w=h(await e.index.searchByWhereClause(E,y,t.where),w)),d&&(r=await c(e,w,t.facets)),t.groupBy&&(a=await m(e,w,t.groupBy));let M=(await A(e,w,s,u)).filter(Boolean);e.afterSearch&&await (0,b.mX)(e.afterSearch,e,t,n,M);let x=await (0,i.XN)(),P={count:w.length,elapsed:{raw:Number(x-l),formatted:await (0,i.Ed)(x-l)},hits:M,...r?{facets:r}:{},...a?{groups:a}:{}};if(!f){let t=Object.keys(e.data.index.vectorIndexes);(0,i.ZL)(P,t)}return P}async function T(e,t,n){let r=await (0,i.XN)();t.relevance=Object.assign(D,t.relevance??{});let{term:a="",properties:s,threshold:u=1}=t,{index:c,docs:f}=e.data,d=await e.tokenizer.tokenize(a,n),h=e.caches.propertiesToSearch;if(!h){let t=await e.index.getSearchablePropertiesWithTypes(c);h=(h=await e.index.getSearchableProperties(c)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=h}if(s&&"*"!==s){let e=new Set(h),t=new Set(s);for(let t of s)if(!e.has(t))throw(0,o.T)("UNKNOWN_INDEX",t,h.join(", "));h=h.filter(e=>t.has(e))}let p=await k(e.tokenizer,e.index,e.documentsStore,n,t,h,d,await e.documentsStore.count(f),r),g=d.length;if(g||s&&s.length>0){let n=h.length;for(let r=0;r<n;r++){var m;let n=h[r];if(0!==g)for(let t=0;t<g;t++){let r=d[t],o=await e.index.search(p,c,n,r);(0,i.hT)(p.indexMap[n][r],o)}else{let t=[];p.indexMap[n][""]=t;let r=await e.index.search(p,c,n,"");(0,i.hT)(t,r)}let o=Object.values(p.indexMap[n]);p.docsIntersection[n]=(0,l.U)(o,(null==t?void 0:null===(m=t.boost)||void 0===m?void 0:m[n])??1,u,g);let a=p.docsIntersection[n],s=a.length;for(let e=0;e<s;e++){let[t,n]=a[e],r=p.uniqueDocsIDs[t];p.uniqueDocsIDs[t]=r?r+n+.5:n}}}else 0===d.length&&a?p.uniqueDocsIDs={}:p.uniqueDocsIDs=Object.fromEntries(Object.keys(await e.documentsStore.getAll(e.data.docs)).map(e=>[e,0]));return O(Object.entries(p.uniqueDocsIDs).map(([e,t])=>[+e,t]).sort((e,t)=>t[1]-e[1]))}async function S(e,t){let n=t.vector,i=e.data.index.vectorIndexes[null==n?void 0:n.property],a=i.size,l=i.vectors;if(n&&(!n.value||!n.property))throw(0,o.T)("INVALID_VECTOR_INPUT",Object.keys(n).join(", "));if(n.value.length!==a)throw(0,o.T)("INVALID_INPUT_VECTOR",n.property,a,n.value.length);return n instanceof Float32Array||(n.value=new Float32Array(n.value)),O((0,I.M)(n.value,l,a,t.similarity).map(([t,n])=>[(0,r.HM)(e.internalDocumentIDStore,t),n]))}function _([,e]){return e}function O(e){let t=Math.max.apply(Math,e.map(_));return e.map(([e,n])=>[e,n/t])}let D={k:1.2,b:.75,d:.5};async function k(e,t,n,r,o,i,a,l,s){let u={},c={};for(let e of i){let t={};for(let e of a)t[e]=[];u[e]=t,c[e]=[]}return{timeStart:s,tokenizer:e,index:t,documentsStore:n,language:r,params:o,docsCount:l,uniqueDocsIDs:{},indexMap:u,docsIntersection:c}}async function E(e,t,n){let r=t.mode??a;if(r===a)return y(e,t,n);if("vector"===r)return v(e,t);if("hybrid"===r)return w(e,t);throw(0,o.T)("INVALID_SEARCH_MODE",r)}async function N(e,t,n,o,a){let l=e.data.docs,s=new Map,u=[],c=new Set,f=t.length,d=0;for(let h=0;h<f;h++){let f=t[h];if(void 0===f)continue;let[p,g]=f;if(c.has(p))continue;let m=await e.documentsStore.get(l,p),b=await (0,i.Sf)(m,a);if(!(void 0===b||s.has(b))&&(s.set(b,!0),!(++d<=n)&&(u.push({id:(0,r.K7)(e.internalDocumentIDStore,p),score:g,document:m}),c.add(p),d>=n+o)))break}return u}async function A(e,t,n,o){let i=e.data.docs,a=Array.from({length:o}),l=new Set;for(let s=n;s<o+n;s++){let n=t[s];if(void 0===n)break;let[o,u]=n;if(!l.has(o)){let t=await e.documentsStore.get(i,o);a[s]={id:(0,r.K7)(e.internalDocumentIDStore,o),score:u,document:t},l.add(o)}}return a}var M=n(5204);async function x(e,t){"positions"in e.data||Object.assign(e.data,{positions:{}}),await R(e,await e.documentsStore.get(e.data.docs,t),t)}let P=/[\p{L}0-9_'-]+/gimu;async function R(e,t,n,r="",o=e.schema){for(let i of(e.data.positions[n]=Object.create(null),Object.keys(t))){let a;let l="object"==typeof t[i],s="object"==typeof o[i],u=`${r}${String(i)}`;if(l&&i in o&&s&&R(e,t[i],n,u+".",o[i]),!("string"==typeof t[i]&&i in o&&!s))continue;e.data.positions[n][u]=Object.create(null);let c=t[i];for(;null!==(a=P.exec(c));){let t;let r=a[0].toLowerCase(),o=`${e.tokenizer.language}:${r}`;e.tokenizer.normalizationCache.has(o)?t=e.tokenizer.normalizationCache.get(o):([t]=await e.tokenizer.tokenize(r),e.tokenizer.normalizationCache.set(o,t)),Array.isArray(e.data.positions[n][u][t])||(e.data.positions[n][u][t]=[]);let i=a.index,l=a[0].length;e.data.positions[n][u][t].push({start:i,length:l})}}}async function C(e,t,n){let r=await E(e,t,n),o=await e.tokenizer.tokenize(t.term??"",n),i=[];for(let n of r.hits){let r=Object.entries(e.data.positions[n.id]),a=[];for(let[e,n]of r){let r=[];for(let e of Object.entries(n)){let[n]=e;for(let i of o)if(t.tolerance){if((await (0,M.XQ)(n,i,t.tolerance)).isBounded){r.push(e);break}}else if(n.startsWith(i)){r.push(e);break}}a.push([e,Object.fromEntries(r)])}i.push(Object.assign(n,{positions:Object.fromEntries(a)}))}return r.hits=i,r}}}]);
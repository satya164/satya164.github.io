"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[402],{1402:(e,t,r)=>{r.d(t,{create:()=>eb,insert:()=>eS,$P:()=>ez});var n=r(9838),o=r(3514);function i(e){return{raw:Number(e),formatted:(0,o.j7)(e)}}function s(e){if(e.id){if("string"!=typeof e.id)throw(0,n.$)("DOCUMENT_ID_MUST_BE_STRING",typeof e.id);return e.id}return(0,o.NF)()}let a={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},l={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function u(e){return"string"==typeof e&&/^vector\[\d+\]$/.test(e)}function f(e){return"string"==typeof e&&a[e]}function c(e){let t=Number(e.slice(7,-1));switch(!0){case isNaN(t):throw(0,n.$)("INVALID_VECTOR_VALUE",e);case t<=0:throw(0,n.$)("INVALID_VECTOR_SIZE",e);default:return t}}function d(e){return{internalIdToId:e.internalIdToId}}function h(e,t){let{internalIdToId:r}=t;e.internalDocumentIDStore.idToInternalId.clear(),e.internalDocumentIDStore.internalIdToId=[];let n=r.length;for(let t=0;t<n;t++){let n=r[t];e.internalDocumentIDStore.idToInternalId.set(n,t+1),e.internalDocumentIDStore.internalIdToId.push(n)}}function p(e,t){if("string"==typeof t){let r=e.idToInternalId.get(t);if(r)return r;let n=e.idToInternalId.size+1;return e.idToInternalId.set(t,n),e.internalIdToId.push(t),n}return t>e.internalIdToId.length?p(e,t.toString()):t}function g(e,t){if(e.internalIdToId.length<t)throw Error(`Invalid internalId ${t}`);return e.internalIdToId[t-1]}function m(e,t){return{sharedInternalDocumentStore:t,docs:{},count:0}}function b(e,t){let r=p(e.sharedInternalDocumentStore,t);return e.docs[r]}function S(e,t){let r=t.length,n=Array.from({length:r});for(let o=0;o<r;o++){let r=p(e.sharedInternalDocumentStore,t[o]);n[o]=e.docs[r]}return n}function y(e){return e.docs}function I(e,t,r,n){return void 0===e.docs[r]&&(e.docs[r]=n,e.count++,!0)}function O(e,t){let r=p(e.sharedInternalDocumentStore,t);return void 0!==e.docs[r]&&(delete e.docs[r],e.count--,!0)}function N(e){return e.count}function w(e,t){return{docs:t.docs,count:t.count,sharedInternalDocumentStore:e}}function T(e){return{docs:e.docs,count:e.count}}let _=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeUpsert","afterUpsert","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeUpsertMultiple","afterUpsertMultiple","beforeLoad","afterLoad","afterCreate"],v=["tokenizer","index","documentsStore","sorter"],D=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];function A(e,t,r,n){if(e.some(o.$S))return(async()=>{for(let o of e)await o(t,r,n)})();for(let o of e)o(t,r,n)}function E(e,t,r,n,i){if(e.some(o.$S))return(async()=>{for(let o of e)await o(t,r,n,i)})();for(let o of e)o(t,r,n,i)}function k(e,t,r,n){if(e.some(o.$S))return(async()=>{for(let o of e)await o(t,r,n)})();for(let o of e)o(t,r,n)}class P{k;v;l=null;r=null;h=1;constructor(e,t){this.k=e,this.v=new Set(t)}updateHeight(){this.h=Math.max(P.getHeight(this.l),P.getHeight(this.r))+1}static getHeight(e){return e?e.h:0}getBalanceFactor(){return P.getHeight(this.l)-P.getHeight(this.r)}rotateLeft(){let e=this.r;return this.r=e.l,e.l=this,this.updateHeight(),e.updateHeight(),e}rotateRight(){let e=this.l;return this.l=e.r,e.r=this,this.updateHeight(),e.updateHeight(),e}toJSON(){return{k:this.k,v:Array.from(this.v),l:this.l?this.l.toJSON():null,r:this.r?this.r.toJSON():null,h:this.h}}static fromJSON(e){let t=new P(e.k,e.v);return t.l=e.l?P.fromJSON(e.l):null,t.r=e.r?P.fromJSON(e.r):null,t.h=e.h,t}}class R{root=null;insertCount=0;constructor(e,t){void 0!==e&&void 0!==t&&(this.root=new P(e,t))}insert(e,t,r=1e3){this.root=this.insertNode(this.root,e,t,r)}insertMultiple(e,t,r=1e3){for(let n of t)this.insert(e,n,r)}rebalance(){this.root&&(this.root=this.rebalanceNode(this.root))}toJSON(){return{root:this.root?this.root.toJSON():null,insertCount:this.insertCount}}static fromJSON(e){let t=new R;return t.root=e.root?P.fromJSON(e.root):null,t.insertCount=e.insertCount||0,t}insertNode(e,t,r,n){if(null===e)return new P(t,[r]);let o=[],i=e,s=null;for(;null!==i;)if(o.push({parent:s,node:i}),t<i.k)if(null===i.l){i.l=new P(t,[r]),o.push({parent:i,node:i.l});break}else s=i,i=i.l;else if(!(t>i.k))return i.v.add(r),e;else if(null===i.r){i.r=new P(t,[r]),o.push({parent:i,node:i.r});break}else s=i,i=i.r;let a=!1;this.insertCount++%n==0&&(a=!0);for(let t=o.length-1;t>=0;t--){let{parent:r,node:n}=o[t];if(n.updateHeight(),a){let t=this.rebalanceNode(n);r?r.l===n?r.l=t:r.r===n&&(r.r=t):e=t}}return e}rebalanceNode(e){let t=e.getBalanceFactor();if(t>1){if(e.l&&e.l.getBalanceFactor()>=0)return e.rotateRight();else if(e.l)return e.l=e.l.rotateLeft(),e.rotateRight()}if(t<-1){if(e.r&&0>=e.r.getBalanceFactor())return e.rotateLeft();else if(e.r)return e.r=e.r.rotateRight(),e.rotateLeft()}return e}find(e){let t=this.findNodeByKey(e);return t?t.v:null}contains(e){return null!==this.find(e)}getSize(){let e=0,t=[],r=this.root;for(;r||t.length>0;){for(;r;)t.push(r),r=r.l;r=t.pop(),e++,r=r.r}return e}isBalanced(){if(!this.root)return!0;let e=[this.root];for(;e.length>0;){let t=e.pop();if(Math.abs(t.getBalanceFactor())>1)return!1;t.l&&e.push(t.l),t.r&&e.push(t.r)}return!0}remove(e){this.root=this.removeNode(this.root,e)}removeDocument(e,t){let r=this.findNodeByKey(e);r&&(1===r.v.size?this.root=this.removeNode(this.root,e):r.v=new Set([...r.v.values()].filter(e=>e!==t)))}findNodeByKey(e){let t=this.root;for(;t;)if(e<t.k)t=t.l;else{if(!(e>t.k))return t;t=t.r}return null}removeNode(e,t){if(null===e)return null;let r=[],n=e;for(;null!==n&&n.k!==t;)r.push(n),n=t<n.k?n.l:n.r;if(null===n)return e;if(null===n.l||null===n.r){let t=n.l?n.l:n.r;if(0===r.length)e=t;else{let e=r[r.length-1];e.l===n?e.l=t:e.r=t}}else{let e=n,t=n.r;for(;null!==t.l;)e=t,t=t.l;n.k=t.k,n.v=t.v,e.l===t?e.l=t.r:e.r=t.r,n=e}r.push(n);for(let t=r.length-1;t>=0;t--){let n=r[t];n.updateHeight();let o=this.rebalanceNode(n);if(t>0){let e=r[t-1];e.l===n?e.l=o:e.r===n&&(e.r=o)}else e=o}return e}rangeSearch(e,t){let r=new Set,n=[],i=this.root;for(;i||n.length>0;){for(;i;)n.push(i),i=i.l;if((i=n.pop()).k>=e&&i.k<=t&&(r=(0,o.gG)(r,i.v)),i.k>t)break;i=i.r}return r}greaterThan(e,t=!1){let r=new Set,n=[],i=this.root;for(;i||n.length>0;){for(;i;)n.push(i),i=i.r;if(i=n.pop(),t&&i.k>=e||!t&&i.k>e)r=(0,o.gG)(r,i.v);else if(i.k<=e)break;i=i.l}return r}lessThan(e,t=!1){let r=new Set,n=[],i=this.root;for(;i||n.length>0;){for(;i;)n.push(i),i=i.l;if(i=n.pop(),t&&i.k<=e||!t&&i.k<e)r=(0,o.gG)(r,i.v);else if(i.k>e)break;i=i.r}return r}}class x{numberToDocumentId;constructor(){this.numberToDocumentId=new Map}insert(e,t){this.numberToDocumentId.has(e)?this.numberToDocumentId.get(e).add(t):this.numberToDocumentId.set(e,new Set([t]))}find(e){let t=this.numberToDocumentId.get(e);return t?Array.from(t):null}remove(e){this.numberToDocumentId.delete(e)}removeDocument(e,t){let r=this.numberToDocumentId.get(t);r&&(r.delete(e),0===r.size&&this.numberToDocumentId.delete(t))}contains(e){return this.numberToDocumentId.has(e)}getSize(){let e=0;for(let t of this.numberToDocumentId.values())e+=t.size;return e}filter(e){let t=Object.keys(e);if(1!==t.length)throw Error("Invalid operation");let r=t[0];switch(r){case"eq":{let t=e[r],n=this.numberToDocumentId.get(t);return n?Array.from(n):[]}case"in":{let t=e[r],n=new Set;for(let e of t){let t=this.numberToDocumentId.get(e);if(t)for(let e of t)n.add(e)}return Array.from(n)}case"nin":{let t=new Set(e[r]),n=new Set;for(let[e,r]of this.numberToDocumentId.entries())if(!t.has(e))for(let e of r)n.add(e);return Array.from(n)}default:throw Error("Invalid operation")}}filterArr(e){let t=Object.keys(e);if(1!==t.length)throw Error("Invalid operation");let r=t[0];switch(r){case"containsAll":{let t=e[r].map(e=>this.numberToDocumentId.get(e)??new Set);if(0===t.length)return[];return Array.from(t.reduce((e,t)=>new Set([...e].filter(e=>t.has(e)))))}case"containsAny":{let t=e[r].map(e=>this.numberToDocumentId.get(e)??new Set);if(0===t.length)return[];return Array.from(t.reduce((e,t)=>new Set([...e,...t])))}default:throw Error("Invalid operation")}}static fromJSON(e){if(!e.numberToDocumentId)throw Error("Invalid Flat Tree JSON");let t=new x;for(let[r,n]of e.numberToDocumentId)t.numberToDocumentId.set(r,new Set(n));return t}toJSON(){return{numberToDocumentId:Array.from(this.numberToDocumentId.entries()).map(([e,t])=>[e,Array.from(t)])}}}var M=r(1901);class C{k;s;c=new Map;d=new Set;e;w="";constructor(e,t,r){this.k=e,this.s=t,this.e=r}updateParent(e){this.w=e.w+this.s}addDocument(e){this.d.add(e)}removeDocument(e){return this.d.delete(e)}findAllWords(e,t,r,n){let i=[this];for(;i.length>0;){let s=i.pop();if(s.e){let{w:i,d:a}=s;if(r&&i!==t)continue;if(null!==(0,o.g5)(e,i))if(n){if(!(Math.abs(t.length-i.length)<=n)||!(0,M.Gd)(t,i,n).isBounded)continue;e[i]=[]}else e[i]=[];if(null!=(0,o.g5)(e,i)&&a.size>0){let t=e[i];for(let e of a)t.includes(e)||t.push(e)}}s.c.size>0&&i.push(...s.c.values())}return e}insert(e,t){let r=this,n=0,o=e.length;for(;n<o;){let i=e[n],s=r.c.get(i);if(s){let i=s.s,a=i.length,l=0;for(;l<a&&n+l<o&&i[l]===e[n+l];)l++;if(l===a){if(r=s,(n+=l)===o){s.e||(s.e=!0),s.addDocument(t);return}continue}let u=i.slice(0,l),f=i.slice(l),c=e.slice(n+l),d=new C(u[0],u,!1);if(r.c.set(u[0],d),d.updateParent(r),s.s=f,s.k=f[0],d.c.set(f[0],s),s.updateParent(d),c){let e=new C(c[0],c,!0);e.addDocument(t),d.c.set(c[0],e),e.updateParent(d)}else d.e=!0,d.addDocument(t);return}{let o=new C(i,e.slice(n),!0);o.addDocument(t),r.c.set(i,o),o.updateParent(r);return}}r.e||(r.e=!0),r.addDocument(t)}_findLevenshtein(e,t,r,n,i){let s=[{node:this,index:t,tolerance:r}];for(;s.length>0;){let{node:t,index:r,tolerance:a}=s.pop();if(t.w.startsWith(e)){t.findAllWords(i,e,!1,0);continue}if(a<0)continue;if(t.e){let{w:r,d:s}=t;if(r&&((0,M.Gd)(e,r,n).isBounded&&(i[r]=[]),void 0!==(0,o.g5)(i,r)&&s.size>0)){let e=new Set(i[r]);for(let t of s)e.add(t);i[r]=Array.from(e)}}if(r>=e.length)continue;let l=e[r];if(t.c.has(l)){let e=t.c.get(l);s.push({node:e,index:r+1,tolerance:a})}for(let[e,n]of(s.push({node:t,index:r+1,tolerance:a-1}),t.c))s.push({node:n,index:r,tolerance:a-1}),e!==l&&s.push({node:n,index:r+1,tolerance:a-1})}}find(e){let{term:t,exact:r,tolerance:n}=e;if(n&&!r){let e={};return this._findLevenshtein(t,0,n,n,e),e}{let e=this,o=0,i=t.length;for(;o<i;){let s=t[o],a=e.c.get(s);if(!a)return{};{let s=a.s,l=s.length,u=0;for(;u<l&&o+u<i&&s[u]===t[o+u];)u++;if(u===l)e=a,o+=u;else{if(o+u!==i||u!==i-o||r)return{};let e={};return a.findAllWords(e,t,r,n),e}}}let s={};return e.findAllWords(s,t,r,n),s}}contains(e){let t=this,r=0,n=e.length;for(;r<n;){let o=e[r],i=t.c.get(o);if(!i)return!1;{let o=i.s,s=o.length,a=0;for(;a<s&&r+a<n&&o[a]===e[r+a];)a++;if(a<s)return!1;r+=s,t=i}}return!0}removeWord(e){if(!e)return!1;let t=this,r=e.length,n=[];for(let o=0;o<r;o++){let r=e[o];if(!t.c.has(r))return!1;{let e=t.c.get(r);n.push({parent:t,character:r}),o+=e.s.length-1,t=e}}for(t.d.clear(),t.e=!1;n.length>0&&0===t.c.size&&!t.e&&0===t.d.size;){let{parent:e,character:r}=n.pop();e.c.delete(r),t=e}return!0}removeDocumentByWord(e,t,r=!0){if(!e)return!0;let n=this,o=e.length;for(let i=0;i<o;i++){let o=e[i];if(!n.c.has(o))return!1;{let s=n.c.get(o);i+=s.s.length-1,n=s,r&&n.w!==e||n.removeDocument(t)}}return!0}static getCommonPrefix(e,t){let r=Math.min(e.length,t.length),n=0;for(;n<r&&e.charCodeAt(n)===t.charCodeAt(n);)n++;return e.slice(0,n)}toJSON(){return{w:this.w,s:this.s,e:this.e,k:this.k,d:Array.from(this.d),c:Array.from(this.c?.entries())?.map(([e,t])=>[e,t.toJSON()])}}static fromJSON(e){let t=new C(e.k,e.s,e.e);return t.w=e.w,t.d=new Set(e.d),t.c=new Map(e?.c?.map(([e,t])=>[e,C.fromJSON(t)])),t}}class U extends C{constructor(){super("","",!1)}static fromJSON(e){let t=new U;return t.w=e.w,t.s=e.s,t.e=e.e,t.k=e.k,t.d=new Set(e.d),t.c=new Map(e.c?.map(([e,t])=>[e,C.fromJSON(t)])),t}toJSON(){return super.toJSON()}}class z{point;docIDs;left;right;parent;constructor(e,t){this.point=e,this.docIDs=new Set(t),this.left=null,this.right=null,this.parent=null}toJSON(){return{point:this.point,docIDs:Array.from(this.docIDs),left:this.left?this.left.toJSON():null,right:this.right?this.right.toJSON():null}}static fromJSON(e,t=null){let r=new z(e.point,e.docIDs);return r.parent=t,e.left&&(r.left=z.fromJSON(e.left,r)),e.right&&(r.right=z.fromJSON(e.right,r)),r}}class ${root;nodeMap;constructor(){this.root=null,this.nodeMap=new Map}getPointKey(e){return`${e.lon},${e.lat}`}insert(e,t){let r=this.getPointKey(e),n=this.nodeMap.get(r);if(n)return void t.forEach(e=>n.docIDs.add(e));let o=new z(e,t);if(this.nodeMap.set(r,o),null==this.root){this.root=o;return}let i=this.root,s=0;for(;;){if(0==s%2)if(e.lon<i.point.lon){if(null==i.left){i.left=o,o.parent=i;return}i=i.left}else{if(null==i.right){i.right=o,o.parent=i;return}i=i.right}else if(e.lat<i.point.lat){if(null==i.left){i.left=o,o.parent=i;return}i=i.left}else{if(null==i.right){i.right=o,o.parent=i;return}i=i.right}s++}}contains(e){let t=this.getPointKey(e);return this.nodeMap.has(t)}getDocIDsByCoordinates(e){let t=this.getPointKey(e),r=this.nodeMap.get(t);return r?Array.from(r.docIDs):null}removeDocByID(e,t){let r=this.getPointKey(e),n=this.nodeMap.get(r);n&&(n.docIDs.delete(t),0===n.docIDs.size&&(this.nodeMap.delete(r),this.deleteNode(n)))}deleteNode(e){let t=e.parent,r=e.left?e.left:e.right;r&&(r.parent=t),t?t.left===e?t.left=r:t.right===e&&(t.right=r):(this.root=r,this.root&&(this.root.parent=null))}searchByRadius(e,t,r=!0,n="asc",o=!1){let i=o?$.vincentyDistance:$.haversineDistance,s=[{node:this.root,depth:0}],a=[];for(;s.length>0;){let{node:n,depth:o}=s.pop();if(null==n)continue;let l=i(e,n.point);(r?l<=t:l>t)&&a.push({point:n.point,docIDs:Array.from(n.docIDs)}),null!=n.left&&s.push({node:n.left,depth:o+1}),null!=n.right&&s.push({node:n.right,depth:o+1})}return n&&a.sort((t,r)=>{let o=i(e,t.point),s=i(e,r.point);return"asc"===n.toLowerCase()?o-s:s-o}),a}searchByPolygon(e,t=!0,r=null,n=!1){let o=[{node:this.root,depth:0}],i=[];for(;o.length>0;){let{node:r,depth:n}=o.pop();if(null==r)continue;null!=r.left&&o.push({node:r.left,depth:n+1}),null!=r.right&&o.push({node:r.right,depth:n+1});let s=$.isPointInPolygon(e,r.point);(s&&t||!s&&!t)&&i.push({point:r.point,docIDs:Array.from(r.docIDs)})}let s=$.calculatePolygonCentroid(e);if(r){let e=n?$.vincentyDistance:$.haversineDistance;i.sort((t,n)=>{let o=e(s,t.point),i=e(s,n.point);return"asc"===r.toLowerCase()?o-i:i-o})}return i}toJSON(){return{root:this.root?this.root.toJSON():null}}static fromJSON(e){let t=new $;return e.root&&(t.root=z.fromJSON(e.root),t.buildNodeMap(t.root)),t}buildNodeMap(e){if(null==e)return;let t=this.getPointKey(e.point);this.nodeMap.set(t,e),e.left&&this.buildNodeMap(e.left),e.right&&this.buildNodeMap(e.right)}static calculatePolygonCentroid(e){let t=0,r=0,n=0,o=e.length;for(let i=0,s=o-1;i<o;s=i++){let o=e[i].lon,a=e[i].lat,l=e[s].lon,u=e[s].lat,f=o*u-l*a;t+=f,r+=(o+l)*f,n+=(a+u)*f}let i=6*(t/=2);return{lon:r/=i,lat:n/=i}}static isPointInPolygon(e,t){let r=!1,n=t.lon,o=t.lat,i=e.length;for(let t=0,s=i-1;t<i;s=t++){let i=e[t].lon,a=e[t].lat,l=e[s].lon,u=e[s].lat;a>o!=u>o&&n<(l-i)*(o-a)/(u-a)+i&&(r=!r)}return r}static haversineDistance(e,t){let r=Math.PI/180,n=e.lat*r,o=t.lat*r,i=(t.lat-e.lat)*r,s=(t.lon-e.lon)*r,a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n)*Math.cos(o)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371e3}static vincentyDistance(e,t){let r,n,o,i,s,a,l,u=1/298.257223563,f=(1-1/298.257223563)*6378137,c=Math.PI/180,d=e.lat*c,h=t.lat*c,p=(t.lon-e.lon)*c,g=Math.atan((1-u)*Math.tan(d)),m=Math.atan((1-u)*Math.tan(h)),b=Math.sin(g),S=Math.cos(g),y=Math.sin(m),I=Math.cos(m),O=p,N=1e3;do{let e=Math.sin(O),t=Math.cos(O);if(0===(n=Math.sqrt(I*e*(I*e)+(S*y-b*I*t)*(S*y-b*I*t))))return 0;i=Math.atan2(n,o=b*y+S*I*t),isNaN(l=o-2*b*y/(a=1-(s=S*I*e/n)*s))&&(l=0);let f=u/16*a*(4+u*(4-3*a));r=O,O=p+(1-f)*u*s*(i+f*n*(l+f*o*(-1+2*l*l)))}while(Math.abs(O-r)>1e-12&&--N>0);if(0===N)return NaN;let w=a*(0x24ffb2985f71-f*f)/(f*f),T=1+w/16384*(4096+w*(-768+w*(320-175*w))),_=w/1024*(256+w*(-128+w*(74-47*w)));return f*T*(i-_*n*(l+_/4*(o*(-1+2*l*l)-_/6*l*(-3+4*n*n)*(-3+4*l*l))))}}class L{true;false;constructor(){this.true=new Set,this.false=new Set}insert(e,t){t?this.true.add(e):this.false.add(e)}delete(e,t){t?this.true.delete(e):this.false.delete(e)}getSize(){return this.true.size+this.false.size}toJSON(){return{true:Array.from(this.true),false:Array.from(this.false)}}static fromJSON(e){let t=new L;return t.true=new Set(e.true),t.false=new Set(e.false),t}}class B{size;vectors=new Map;constructor(e){this.size=e}add(e,t){t instanceof Float32Array||(t=new Float32Array(t));let r=V(t,this.size);this.vectors.set(e,[r,t])}remove(e){this.vectors.delete(e)}find(e,t,r){return e instanceof Float32Array||(e=new Float32Array(e)),function(e,t,r,n,o){let i=V(e,n),s=[];for(let a of t||r.keys()){let t=r.get(a);if(!t)continue;let l=t[0],u=t[1],f=0;for(let t=0;t<n;t++)f+=e[t]*u[t];let c=f/(i*l);c>=o&&s.push([a,c])}return s}(e,r,this.vectors,this.size,t)}toJSON(){let e=[];for(let[t,[r,n]]of this.vectors)e.push([t,[r,Array.from(n)]]);return{size:this.size,vectors:e}}static fromJSON(e){let t=new B(e.size);for(let[r,[n,o]]of e.vectors)t.vectors.set(r,[n,new Float32Array(o)]);return t}}function V(e,t){let r=0;for(let n=0;n<t;n++)r+=e[n]*e[n];return Math.sqrt(r)}function W(e,t,r,n,o){let i=p(e.sharedInternalDocumentStore,r);e.avgFieldLength[t]=((e.avgFieldLength[t]??0)*(o-1)+n.length)/o,e.fieldLengths[t][i]=n.length,e.frequencies[t][i]={}}function F(e,t,r,n,o){let i=0;for(let e of n)e===o&&i++;let s=p(e.sharedInternalDocumentStore,r),a=i/n.length;e.frequencies[t][s][o]=a,o in e.tokenOccurrences[t]||(e.tokenOccurrences[t][o]=0),e.tokenOccurrences[t][o]=(e.tokenOccurrences[t][o]??0)+1}function j(e,t,r,n){let o=p(e.sharedInternalDocumentStore,r);n>1?e.avgFieldLength[t]=(e.avgFieldLength[t]*n-e.fieldLengths[t][o])/(n-1):e.avgFieldLength[t]=void 0,e.fieldLengths[t][o]=void 0,e.frequencies[t][o]=void 0}function J(e,t,r){e.tokenOccurrences[t][r]--}function G(e,t,r,n,o,i,s,a,l,c,d){if(u(s)){var h,p,g,m;return h=t,p=r,g=i,m=o,void h.vectorIndexes[p].node.add(m,g)}let b=n=>{let{type:i,node:s}=t.indexes[r];switch(i){case"Bool":s[n?"true":"false"].add(o);break;case"AVL":{let e=d?.avlRebalanceThreshold??1;s.insert(n,o,e);break}case"Radix":{let i=l.tokenize(n,a,r,!1);for(let n of(e.insertDocumentScoreParameters(t,r,o,i,c),i))e.insertTokenScoreParameters(t,r,o,i,n),s.insert(n,o);break}case"Flat":s.insert(n,o);break;case"BKD":s.insert(n,[o])}};if(!f(s))return b(i);let S=i.length;for(let e=0;e<S;e++)b(i[e])}function H(e,t,r,n,o,i,s,a,l,f){if(u(s))return t.vectorIndexes[r].node.remove(o),!0;let{type:c,node:d}=t.indexes[r];switch(c){case"AVL":return d.removeDocument(i,o),!0;case"Bool":return d[i?"true":"false"].delete(o),!0;case"Radix":{let s=l.tokenize(i,a,r);for(let i of(e.removeDocumentScoreParameters(t,r,n,f),s))e.removeTokenScoreParameters(t,r,i),d.removeDocumentByWord(i,o);return!0}case"Flat":return d.removeDocument(o,i),!0;case"BKD":return d.removeDocByID(i,o),!1}}function Y(e,t,r,n,o,i,s,a,u,c){if(!f(s))return H(e,t,r,n,o,i,s,a,u,c);let d=l[s],h=i.length;for(let s=0;s<h;s++)H(e,t,r,n,o,i[s],d,a,u,c);return!0}function K(e,t,r,n,o,i,s,a,l,u){let f=Array.from(n),c=e.avgFieldLength[t],d=e.fieldLengths[t],h=e.tokenOccurrences[t],p=e.frequencies[t],g="number"==typeof h[r]?h[r]??0:0,m=f.length;for(let e=0;e<m;e++){let n=f[e];if(l&&!l.has(n))continue;u.has(n)||u.set(n,new Map);let h=u.get(n);h.set(t,(h.get(t)||0)+1);let m=function(e,t,r,n,o,{k:i,b:s,d:a}){return Math.log(1+(r-t+.5)/(t+.5))*(a+e*(i+1))/(e+i*(1-s+s*n/o))}(p?.[n]?.[r]??0,g,o,d[n],c,i);s.has(n)?s.set(n,s.get(n)+m*a):s.set(n,m*a)}}function X(e,t,r,o,i,s,a,l,u,f,c,d=0){let h=r.tokenize(t,o),p=h.length||1,g=new Map,m=new Map,b=new Map;for(let r of i){if(!(r in e.indexes))continue;let o=e.indexes[r],{type:i}=o;if("Radix"!==i)throw(0,n.$)("WRONG_SEARCH_PROPERTY_TYPE",r);let d=l[r]??1;if(d<=0)throw(0,n.$)("INVALID_BOOST_VALUE",d);0!==h.length||t||h.push("");let p=h.length;for(let t=0;t<p;t++){let n=h[t],i=o.node.find({term:n,exact:s,tolerance:a}),l=Object.keys(i);l.length>0&&m.set(n,!0);let p=l.length;for(let t=0;t<p;t++){let n=l[t],o=i[n];K(e,r,n,o,f,u,b,d,c,g)}}}let S=Array.from(b.entries()).map(([e,t])=>[e,t]).sort((e,t)=>t[1]-e[1]);if(0===S.length)return[];if(1===d)return S;if(0===d){if(1===p)return S;for(let e of h)if(!m.get(e))return[];return S.filter(([e])=>{let t=g.get(e);return!!t&&Array.from(t.values()).some(e=>e===p)})}let y=S.filter(([e])=>{let t=g.get(e);return!!t&&Array.from(t.values()).some(e=>e===p)});if(y.length>0){let e=S.filter(([e])=>!y.some(([t])=>t===e)),t=Math.ceil(e.length*d);return[...y,...e.slice(0,t)]}return S}function q(e){return e.searchableProperties}function Z(e){return e.searchablePropertiesWithTypes}function Q(e,t){let{indexes:r,vectorIndexes:n,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:s,tokenOccurrences:a,avgFieldLength:l,fieldLengths:u}=t,f={},c={};for(let e of Object.keys(r)){let{node:t,type:n,isArray:o}=r[e];switch(n){case"Radix":f[e]={type:"Radix",node:U.fromJSON(t),isArray:o};break;case"Flat":f[e]={type:"Flat",node:x.fromJSON(t),isArray:o};break;case"AVL":f[e]={type:"AVL",node:R.fromJSON(t),isArray:o};break;case"BKD":f[e]={type:"BKD",node:$.fromJSON(t),isArray:o};break;case"Bool":f[e]={type:"Bool",node:L.fromJSON(t),isArray:o};break;default:f[e]=r[e]}}for(let e of Object.keys(n))c[e]={type:"Vector",isArray:!1,node:B.fromJSON(n[e])};return{sharedInternalDocumentStore:e,indexes:f,vectorIndexes:c,searchableProperties:o,searchablePropertiesWithTypes:i,frequencies:s,tokenOccurrences:a,avgFieldLength:l,fieldLengths:u}}function ee(e){let{indexes:t,vectorIndexes:r,searchableProperties:n,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:s,avgFieldLength:a,fieldLengths:l}=e,u={};for(let e of Object.keys(r))u[e]=r[e].node.toJSON();let f={};for(let e of Object.keys(t)){let{type:r,node:n,isArray:o}=t[e];"Flat"===r||"Radix"===r||"AVL"===r||"BKD"===r||"Bool"===r?f[e]={type:r,node:n.toJSON(),isArray:o}:(f[e]=t[e],f[e].node=f[e].node.toJSON())}return{indexes:f,vectorIndexes:u,searchableProperties:n,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:s,avgFieldLength:a,fieldLengths:l}}function et(e,t){e||(e=new Set);let r=t.length;for(let n=0;n<r;n++){let r=t[n].docIDs,o=r.length;for(let t=0;t<o;t++)e.add(r[t])}return e}var er=r(2359);function en(e,t,r,i){return i?.enabled===!1?{disabled:!0}:function e(t,r,i,s,a){let l={language:t.tokenizer.language,sharedInternalDocumentStore:r,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(let[f,c]of Object.entries(i)){let i=`${a}${a?".":""}${f}`;if(!s.includes(i)){if("object"==typeof c&&!Array.isArray(c)){let n=e(t,r,c,s,i);(0,o.h)(l.sortableProperties,n.sortableProperties),l.sorts={...l.sorts,...n.sorts},l.sortablePropertiesWithTypes={...l.sortablePropertiesWithTypes,...n.sortablePropertiesWithTypes};continue}if(!u(c))switch(c){case"boolean":case"number":case"string":l.sortableProperties.push(i),l.sortablePropertiesWithTypes[i]=c,l.sorts[i]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:c};break;case"geopoint":case"enum":case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw(0,n.$)("INVALID_SORT_SCHEMA_TYPE",Array.isArray(c)?"array":c,i)}}}return l}(e,t,r,(i||{}).unsortableProperties||[],"")}function eo(e,t,r,n){if(!e.enabled)return;e.isSorted=!1;let o=p(e.sharedInternalDocumentStore,r),i=e.sorts[t];i.orderedDocsToRemove.has(o)&&eu(e,t),i.docs.set(o,i.orderedDocs.length),i.orderedDocs.push([o,n])}function ei(e){if(!e.isSorted&&e.enabled){for(let t of Object.keys(e.sorts))!function(e,t){let r,n=e.sorts[t];switch(n.type){case"string":r=es.bind(null,e.language);break;case"number":r=ea.bind(null);break;case"boolean":r=el.bind(null)}n.orderedDocs.sort(r);let o=n.orderedDocs.length;for(let e=0;e<o;e++){let t=n.orderedDocs[e][0];n.docs.set(t,e)}}(e,t);e.isSorted=!0}}function es(e,t,r){return t[1].localeCompare(r[1],(0,er.JK)(e))}function ea(e,t){return e[1]-t[1]}function el(e,t){return t[1]?-1:1}function eu(e,t){let r=e.sorts[t];r.orderedDocsToRemove.size&&(r.orderedDocs=r.orderedDocs.filter(e=>!r.orderedDocsToRemove.has(e[0])),r.orderedDocsToRemove.clear())}function ef(e,t,r){if(!e.enabled)return;let n=e.sorts[t],o=p(e.sharedInternalDocumentStore,r);n.docs.get(o)&&(n.docs.delete(o),n.orderedDocsToRemove.set(o,!0))}function ec(e,t,r){if(!e.enabled)throw(0,n.$)("SORT_DISABLED");let o=r.property,i="DESC"===r.order,s=e.sorts[o];if(!s)throw(0,n.$)("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",o,e.sortableProperties.join(", "));return eu(e,o),ei(e),t.sort((t,r)=>{let n=s.docs.get(p(e.sharedInternalDocumentStore,t[0])),o=s.docs.get(p(e.sharedInternalDocumentStore,r[0])),a=void 0!==n,l=void 0!==o;return a||l?a?l?i?o-n:n-o:-1:1:0}),t}function ed(e){return e.enabled?e.sortableProperties:[]}function eh(e){return e.enabled?e.sortablePropertiesWithTypes:{}}function ep(e,t){if(!t.enabled)return{enabled:!1};let r=Object.keys(t.sorts).reduce((e,r)=>{let{docs:n,orderedDocs:o,type:i}=t.sorts[r];return e[r]={docs:new Map(Object.entries(n).map(([e,t])=>[+e,t])),orderedDocsToRemove:new Map,orderedDocs:o,type:i},e},{});return{sharedInternalDocumentStore:e,language:t.language,sortableProperties:t.sortableProperties,sortablePropertiesWithTypes:t.sortablePropertiesWithTypes,sorts:r,enabled:!0,isSorted:t.isSorted}}function eg(e){if(!e.enabled)return{enabled:!1};for(let t of Object.keys(e.sorts))eu(e,t);ei(e);let t=Object.keys(e.sorts).reduce((t,r)=>{let{docs:n,orderedDocs:o,type:i}=e.sorts[r];return t[r]={docs:Object.fromEntries(n.entries()),orderedDocs:o,type:i},t},{});return{language:e.language,sortableProperties:e.sortableProperties,sortablePropertiesWithTypes:e.sortablePropertiesWithTypes,sorts:t,enabled:e.enabled,isSorted:e.isSorted}}var em=r(3460);function eb({schema:e,sort:t,language:r,components:a,id:p,plugins:g}){for(let t of(a||(a={}),g??[])){if(!("getComponents"in t)||"function"!=typeof t.getComponents)continue;let r=t.getComponents(e);for(let e of Object.keys(r))if(a[e])throw(0,n.$)("PLUGIN_COMPONENT_CONFLICT",e,t.name);a={...a,...r}}p||(p=(0,o.NF)());let A=a.tokenizer,E=a.index,k=a.documentsStore,P=a.sorter;if(A=A?A.tokenize?A:(0,em.e)(A):(0,em.e)({language:r??"english"}),a.tokenizer&&r)throw(0,n.$)("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");let M={idToInternalId:new Map,internalIdToId:[],save:d,load:h};E||={create:function e(t,r,o,i,s=""){for(let[a,l]of(i||(i={sharedInternalDocumentStore:r,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}}),Object.entries(o))){let o=`${s}${s?".":""}${a}`;if("object"==typeof l&&!Array.isArray(l)){e(t,r,l,i,o);continue}if(u(l))i.searchableProperties.push(o),i.searchablePropertiesWithTypes[o]=l,i.vectorIndexes[o]={type:"Vector",node:new B(c(l)),isArray:!1};else{let e=/\[/.test(l);switch(l){case"boolean":case"boolean[]":i.indexes[o]={type:"Bool",node:new L,isArray:e};break;case"number":case"number[]":i.indexes[o]={type:"AVL",node:new R(0,[]),isArray:e};break;case"string":case"string[]":i.indexes[o]={type:"Radix",node:new U,isArray:e},i.avgFieldLength[o]=0,i.frequencies[o]={},i.tokenOccurrences[o]={},i.fieldLengths[o]={};break;case"enum":case"enum[]":i.indexes[o]={type:"Flat",node:new x,isArray:e};break;case"geopoint":i.indexes[o]={type:"BKD",node:new $,isArray:e};break;default:throw(0,n.$)("INVALID_SCHEMA_TYPE",Array.isArray(l)?"array":l,o)}i.searchableProperties.push(o),i.searchablePropertiesWithTypes[o]=l}}return i},insert:G,remove:Y,insertDocumentScoreParameters:W,insertTokenScoreParameters:F,removeDocumentScoreParameters:j,removeTokenScoreParameters:J,calculateResultScores:K,search:X,searchByWhereClause:function e(t,r,i,s){if("and"in i&&i.and&&Array.isArray(i.and)){let n=i.and;if(0===n.length)return new Set;let a=n.map(n=>e(t,r,n,s));return(0,o.iR)(...a)}if("or"in i&&i.or&&Array.isArray(i.or)){let n=i.or;return 0===n.length?new Set:n.map(n=>e(t,r,n,s)).reduce((e,t)=>(0,o.gG)(e,t),new Set)}if("not"in i&&i.not){let n=i.not,a=new Set,l=t.sharedInternalDocumentStore;for(let e=1;e<=l.internalIdToId.length;e++)a.add(e);let u=e(t,r,n,s);return(0,o._i)(a,u)}let a=Object.keys(i),l=a.reduce((e,t)=>({[t]:new Set,...e}),{});for(let e of a){let a=i[e];if(void 0===t.indexes[e])throw(0,n.$)("UNKNOWN_FILTER_PROPERTY",e);let{node:u,type:f,isArray:c}=t.indexes[e];if("Bool"===f){let t=a?u.true:u.false;l[e]=(0,o.gG)(l[e],t);continue}if("BKD"===f){let t;if("radius"in a)t="radius";else if("polygon"in a)t="polygon";else throw Error(`Invalid operation ${a}`);if("radius"===t){let{value:r,coordinates:n,unit:i="m",inside:s=!0,highPrecision:f=!1}=a[t],c=(0,o.O6)(r,i),d=u.searchByRadius(n,c,s,void 0,f);l[e]=et(l[e],d)}else{let{coordinates:r,inside:n=!0,highPrecision:o=!1}=a[t],i=u.searchByPolygon(r,n,void 0,o);l[e]=et(l[e],i)}continue}if("Radix"===f&&("string"==typeof a||Array.isArray(a))){for(let t of[a].flat())for(let n of r.tokenize(t,s,e)){let t=u.find({term:n,exact:!0});l[e]=function(e,t){e||(e=new Set);let r=Object.keys(t),n=r.length;for(let o=0;o<n;o++){let n=t[r[o]],i=n.length;for(let t=0;t<i;t++)e.add(n[t])}return e}(l[e],t)}continue}let d=Object.keys(a);if(d.length>1)throw(0,n.$)("INVALID_FILTER_OPERATION",d.length);if("Flat"===f){let t=new Set(c?u.filterArr(a):u.filter(a));l[e]=(0,o.gG)(l[e],t);continue}if("AVL"===f){let t,r=d[0],i=a[r];switch(r){case"gt":t=u.greaterThan(i,!1);break;case"gte":t=u.greaterThan(i,!0);break;case"lt":t=u.lessThan(i,!1);break;case"lte":t=u.lessThan(i,!0);break;case"eq":t=u.find(i)??new Set;break;case"between":{let[e,r]=i;t=u.rangeSearch(e,r);break}default:throw(0,n.$)("INVALID_FILTER_OPERATION",r)}l[e]=(0,o.gG)(l[e],t)}}return(0,o.iR)(...Object.values(l))},getSearchableProperties:q,getSearchablePropertiesWithTypes:Z,load:Q,save:ee},P||={create:en,insert:eo,remove:ef,save:eg,load:ep,sortBy:ec,getSortableProperties:ed,getSortablePropertiesWithTypes:eh},k||={create:m,get:b,getMultiple:S,getAll:y,store:I,remove:O,count:N,load:w,save:T};var C=a;let z={formatElapsedTime:i,getDocumentIndexId:s,getDocumentProperties:o.JN,validateSchema:function e(t,r){for(let[o,i]of Object.entries(r)){let r=t[o];if(void 0!==r&&("geopoint"!==i||"object"!=typeof r||"number"!=typeof r.lon||"number"!=typeof r.lat)&&("enum"!==i||"string"!=typeof r&&"number"!=typeof r)){if("enum[]"===i&&Array.isArray(r)){let e=r.length;for(let t=0;t<e;t++)if("string"!=typeof r[t]&&"number"!=typeof r[t])return o+"."+t;continue}if(u(i)){let e=c(i);if(!Array.isArray(r)||r.length!==e)throw(0,n.$)("INVALID_INPUT_VECTOR",o,e,r.length);continue}if(f(i)){if(!Array.isArray(r))return o;let e=l[i],t=r.length;for(let n=0;n<t;n++)if(typeof r[n]!==e)return o+"."+n;continue}if("object"==typeof i){if(!r||"object"!=typeof r)return o;let t=e(r,i);if(t)return o+"."+t;continue}if(typeof r!==i)return o}}}};for(let e of D)if(C[e]){if("function"!=typeof C[e])throw(0,n.$)("COMPONENT_MUST_BE_FUNCTION",e)}else C[e]=z[e];for(let e of Object.keys(C))if(!v.includes(e)&&!D.includes(e))throw(0,n.$)("UNSUPPORTED_COMPONENT",e);let{getDocumentProperties:V,getDocumentIndexId:H,validateSchema:er,formatElapsedTime:ei}=a,es={data:{},caches:{},schema:e,tokenizer:A,index:E,sorter:P,documentsStore:k,internalDocumentIDStore:M,getDocumentProperties:V,getDocumentIndexId:H,validateSchema:er,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeUpsert:[],afterUpsert:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],beforeUpdateMultiple:[],afterUpdateMultiple:[],beforeUpsertMultiple:[],afterUpsertMultiple:[],afterCreate:[],formatElapsedTime:ei,id:p,plugins:g,version:"{{VERSION}}"};for(let r of(es.data={index:es.index.create(es,M,e),docs:es.documentsStore.create(es,M),sorting:es.sorter.create(es,M,e,t)},_))es[r]=(es[r]??[]).concat(function(e,t){let r=[],o=e.plugins?.length;if(!o)return r;for(let i=0;i<o;i++)try{let n=e.plugins[i];"function"==typeof n[t]&&r.push(n[t])}catch(e){throw console.error("Caught error in getAllPluginsByHook:",e),(0,n.$)("PLUGIN_CRASHED")}return r}(es,r));let ea=es.afterCreate;return ea&&function(e,t){if(e.some(o.$S))return(async()=>{for(let r of e)await r(t)})();for(let r of e)r(t)}(ea,es),es}function eS(e,t,r,i,s){let a=e.validateSchema(t,e.schema);if(a)throw(0,n.$)("SCHEMA_VALIDATION_FAILURE",a);return(0,o.$S)(e.beforeInsert)||(0,o.$S)(e.afterInsert)||(0,o.$S)(e.index.beforeInsert)||(0,o.$S)(e.index.insert)||(0,o.$S)(e.index.afterInsert)?eO(e,t,r,i,s):function(e,t,r,o,i){let{index:s,docs:a}=e.data,l=e.getDocumentIndexId(t);if("string"!=typeof l)throw(0,n.$)("DOCUMENT_ID_MUST_BE_STRING",typeof l);let u=p(e.internalDocumentIDStore,l);if(!e.documentsStore.store(a,l,u,t))throw(0,n.$)("DOCUMENT_ALREADY_EXISTS",l);let f=e.documentsStore.count(a);o||A(e.beforeInsert,e,l,t);let c=e.index.getSearchableProperties(s),d=e.index.getSearchablePropertiesWithTypes(s),h=e.getDocumentProperties(t,c);for(let[e,t]of Object.entries(h))void 0!==t&&eN(typeof t,d[e],e,t);return function(e,t,r,n,o,i,s,a){for(let s of r){let r=n[s];if(void 0===r)continue;let l=e.index.getSearchablePropertiesWithTypes(e.data.index)[s],u=p(e.internalDocumentIDStore,t);e.index.beforeInsert?.(e.data.index,s,t,r,l,i,e.tokenizer,o),e.index.insert(e.index,e.data.index,s,t,u,r,l,i,e.tokenizer,o,a),e.index.afterInsert?.(e.data.index,s,t,r,l,i,e.tokenizer,o)}let l=e.sorter.getSortableProperties(e.data.sorting),u=e.getDocumentProperties(s,l);for(let r of l){let n=u[r];if(void 0===n)continue;let o=e.sorter.getSortablePropertiesWithTypes(e.data.sorting)[r];e.sorter.insert(e.data.sorting,r,t,n,o,i)}}(e,l,c,h,f,r,t,i),o||A(e.afterInsert,e,l,t),l}(e,t,r,i,s)}let ey=new Set(["enum","enum[]"]),eI=new Set(["string","number"]);async function eO(e,t,r,o,i){let{index:s,docs:a}=e.data,l=e.getDocumentIndexId(t);if("string"!=typeof l)throw(0,n.$)("DOCUMENT_ID_MUST_BE_STRING",typeof l);let u=p(e.internalDocumentIDStore,l);if(!e.documentsStore.store(a,l,u,t))throw(0,n.$)("DOCUMENT_ALREADY_EXISTS",l);let f=e.documentsStore.count(a);o||await A(e.beforeInsert,e,l,t);let c=e.index.getSearchableProperties(s),d=e.index.getSearchablePropertiesWithTypes(s),h=e.getDocumentProperties(t,c);for(let[e,t]of Object.entries(h))void 0!==t&&eN(typeof t,d[e],e,t);return await ew(e,l,c,h,f,r,t,i),o||await A(e.afterInsert,e,l,t),l}function eN(e,t,r,o){if(!("geopoint"===t&&"object"==typeof o&&"number"==typeof o.lon&&"number"==typeof o.lat||u(t)&&Array.isArray(o)||f(t)&&Array.isArray(o))&&!(ey.has(t)&&eI.has(e))&&e!==t)throw(0,n.$)("INVALID_DOCUMENT_PROPERTY",r,t,e)}async function ew(e,t,r,n,o,i,s,a){for(let s of r){let r=n[s];if(void 0===r)continue;let l=e.index.getSearchablePropertiesWithTypes(e.data.index)[s];await e.index.beforeInsert?.(e.data.index,s,t,r,l,i,e.tokenizer,o);let u=e.internalDocumentIDStore.idToInternalId.get(t);await e.index.insert(e.index,e.data.index,s,t,u,r,l,i,e.tokenizer,o,a),await e.index.afterInsert?.(e.data.index,s,t,r,l,i,e.tokenizer,o)}let l=e.sorter.getSortableProperties(e.data.sorting),u=e.getDocumentProperties(s,l);for(let r of l){let n=u[r];if(void 0===n)continue;let o=e.sorter.getSortablePropertiesWithTypes(e.data.sorting)[r];e.sorter.insert(e.data.sorting,r,t,n,o,i)}}let eT="fulltext";function e_(e,t){return e[1]-t[1]}function ev(e,t){return t[1]-e[1]}function eD(e,t,r){let i={},s=t.map(([e])=>e),a=e.documentsStore.getMultiple(e.data.docs,s),l=Object.keys(r),u=e.index.getSearchablePropertiesWithTypes(e.data.index);for(let e of l){let t;if("number"===u[e]){let{ranges:n}=r[e],o=n.length,i=Array.from({length:o});for(let e=0;e<o;e++){let t=n[e];i[e]=[`${t.from}-${t.to}`,0]}t=Object.fromEntries(i)}i[e]={count:0,values:t??{}}}let f=a.length;for(let e=0;e<f;e++){let t=a[e];for(let e of l){let s=e.includes(".")?(0,o.wH)(t,e):t[e],a=u[e],l=i[e].values;switch(a){case"number":eA(r[e].ranges,l)(s);break;case"number[]":{let t=new Set,n=eA(r[e].ranges,l,t);for(let e of s)n(e);break}case"boolean":case"enum":case"string":eE(l,a)(s);break;case"boolean[]":case"enum[]":case"string[]":{let e=eE(l,"boolean[]"===a?"boolean":"string",new Set);for(let t of s)e(t);break}default:throw(0,n.$)("FACET_NOT_SUPPORTED",a)}}}for(let e of l){let t=i[e];if(t.count=Object.keys(t.values).length,"string"===u[e]){let n=r[e],o=function(e="desc"){return"asc"===e.toLowerCase()?e_:ev}(n.sort);t.values=Object.fromEntries(Object.entries(t.values).sort(o).slice(n.offset??0,n.limit??10))}}return i}function eA(e,t,r){return n=>{for(let o of e){let e=`${o.from}-${o.to}`;!r?.has(e)&&n>=o.from&&n<=o.to&&(void 0===t[e]?t[e]=1:(t[e]++,r?.add(e)))}}}function eE(e,t,r){let n="boolean"===t?"false":"";return t=>{let o=t?.toString()??n;r?.has(o)||(e[o]=(e[o]??0)+1,r?.add(o))}}let ek={reducer:(e,t,r,n)=>(t[n]=r,t),getInitialValue:e=>Array.from({length:e})},eP=["string","number","boolean"];function eR(e,t,r){let i=r.properties,s=i.length,a=e.index.getSearchablePropertiesWithTypes(e.data.index);for(let e=0;e<s;e++){let t=i[e];if(void 0===a[t])throw(0,n.$)("UNKNOWN_GROUP_BY_PROPERTY",t);if(!eP.includes(a[t]))throw(0,n.$)("INVALID_GROUP_BY_PROPERTY",t,eP.join(", "),a[t])}let l=t.map(([t])=>g(e.internalDocumentIDStore,t)),u=e.documentsStore.getMultiple(e.data.docs,l),f=u.length,c=r.maxResult||Number.MAX_SAFE_INTEGER,d=[],h={};for(let e=0;e<s;e++){let t=i[e],r={property:t,perValue:{}},n=new Set;for(let e=0;e<f;e++){let i=u[e],s=(0,o.wH)(i,t);if(void 0===s)continue;let a="boolean"!=typeof s?s:""+s,l=r.perValue[a]??{indexes:[],count:0};l.count>=c||(l.indexes.push(e),l.count++,r.perValue[a]=l,n.add(s))}d.push(Array.from(n)),h[t]=r}let p=function e(t,r=0){if(r+1===t.length)return t[r].map(e=>[e]);let n=t[r],i=e(t,r+1),s=[];for(let e of n)for(let t of i){let r=[e];(0,o.h)(r,t),s.push(r)}return s}(d),m=p.length,b=[];for(let e=0;e<m;e++){let t=p[e],r=t.length,n={values:[],indexes:[]},s=[];for(let e=0;e<r;e++){let r=t[e],o=i[e];s.push(h[o].perValue["boolean"!=typeof r?r:""+r].indexes),n.values.push(r)}n.indexes=(0,o.y$)(s).sort((e,t)=>e-t),0!==n.indexes.length&&b.push(n)}let S=b.length,y=Array.from({length:S});for(let e=0;e<S;e++){let n=b[e],o=r.reduce||ek,i=n.indexes.map(e=>({id:l[e],score:t[e][1],document:u[e]})),s=o.reducer.bind(null,n.values),a=o.getInitialValue(n.indexes.length),f=i.reduce(s,a);y[e]={values:n.values,result:f}}return y}function ex(e,t,r){let o,i,{term:s,properties:a}=t,l=e.data.index,u=e.caches.propertiesToSearch;if(!u){let t=e.index.getSearchablePropertiesWithTypes(l);u=(u=e.index.getSearchableProperties(l)).filter(e=>t[e].startsWith("string")),e.caches.propertiesToSearch=u}if(a&&"*"!==a){for(let e of a)if(!u.includes(e))throw(0,n.$)("UNKNOWN_INDEX",e,u.join(", "));u=u.filter(e=>a.includes(e))}Object.keys(t.where??{}).length>0&&(o=e.index.searchByWhereClause(l,e.tokenizer,t.where,r));let f=void 0!==t.threshold&&null!==t.threshold?t.threshold:1;if(s||a){let n=e.documentsStore.count(e.data.docs);i=e.index.search(l,s||"",e.tokenizer,r,u,t.exact||!1,t.tolerance||0,t.boost||{},function(e){let t=e??{};return t.k=t.k??eM.k,t.b=t.b??eM.b,t.d=t.d??eM.d,t}(t.relevance),n,o,f)}else i=(o?Array.from(o):Object.keys(e.documentsStore.getAll(e.data.docs))).map(e=>[+e,0]);return i}let eM={k:1.2,b:.75,d:.5};function eC(e,t,r){let o,i=t.vector;if(i&&(!("value"in i)||!("property"in i)))throw(0,n.$)("INVALID_VECTOR_INPUT",Object.keys(i).join(", "));let s=e.data.index.vectorIndexes[i.property],a=s.node.size;if(i?.value.length!==a){if(i?.property===void 0||i?.value.length===void 0)throw(0,n.$)("INVALID_INPUT_VECTOR","undefined",a,"undefined");throw(0,n.$)("INVALID_INPUT_VECTOR",i.property,a,i.value.length)}let l=e.data.index;return Object.keys(t.where??{}).length>0&&(o=e.index.searchByWhereClause(l,e.tokenizer,t.where,r)),s.node.find(i.value,t.similarity??.8,o)}function eU(e){return e[1]}function ez(e,t,r){let i=t.mode??eT;if(i===eT){let n=(0,o.He)();function s(){let i,s=Object.keys(e.data.index.vectorIndexes),a=t.facets&&Object.keys(t.facets).length>0,{limit:l=10,offset:u=0,distinctOn:f,includeVectors:c=!1}=t,d=!0===t.preflight,h=ex(e,t,r);if(t.sortBy)if("function"==typeof t.sortBy){let r=h.map(([e])=>e),n=e.documentsStore.getMultiple(e.data.docs,r).map((e,t)=>[h[t][0],h[t][1],e]);n.sort(t.sortBy),h=n.map(([e,t])=>[e,t])}else h=e.sorter.sortBy(e.data.sorting,h,t.sortBy).map(([t,r])=>[p(e.internalDocumentIDStore,t),r]);else h=h.sort(o.$J);d||(i=f?function(e,t,r,n,i){let s=e.data.docs,a=new Map,l=[],u=new Set,f=t.length,c=0;for(let d=0;d<f;d++){let f=t[d];if(void 0===f)continue;let[h,p]=f;if(u.has(h))continue;let m=e.documentsStore.get(s,h),b=(0,o.wH)(m,i);if(!(void 0===b||a.has(b))&&(a.set(b,!0),!(++c<=r)&&(l.push({id:g(e.internalDocumentIDStore,h),score:p,document:m}),u.add(h),c>=r+n)))break}return l}(e,h,u,l,f):e$(e,h,u,l));let m={elapsed:{formatted:"",raw:0},hits:[],count:h.length};return void 0!==i&&(m.hits=i.filter(Boolean),c||(0,o.JW)(m,s)),a&&(m.facets=eD(e,h,t.facets)),t.groupBy&&(m.groups=eR(e,h,t.groupBy)),m.elapsed=e.formatElapsedTime((0,o.He)()-n),m}async function a(){e.beforeSearch&&await k(e.beforeSearch,e,t,r);let n=s();return e.afterSearch&&await E(e.afterSearch,e,t,r,n),n}return e.beforeSearch?.length||e.afterSearch?.length?a():s()}if("vector"===i)return function(e,t,r="english"){let n=(0,o.He)();function i(){let i=eC(e,t,r).sort(o.$J),s=[];t.facets&&Object.keys(t.facets).length>0&&(s=eD(e,i,t.facets));let a=t.vector.property,l=t.includeVectors??!1,u=t.limit??10,f=t.offset??0,c=Array.from({length:u});for(let t=0;t<u;t++){let r=i[t+f];if(!r)break;let n=e.data.docs.docs[r[0]];if(n){l||(n[a]=null);let o={id:g(e.internalDocumentIDStore,r[0]),score:r[1],document:n};c[t]=o}}let d=[];t.groupBy&&(d=eR(e,i,t.groupBy));let h=(0,o.He)()-n;return{count:i.length,hits:c.filter(Boolean),elapsed:{raw:Number(h),formatted:(0,o.j7)(h)},...s?{facets:s}:{},...d?{groups:d}:{}}}async function s(){e.beforeSearch&&await k(e.beforeSearch,e,t,r);let n=i();return e.afterSearch&&await E(e.afterSearch,e,t,r,n),n}return e.beforeSearch?.length||e.afterSearch?.length?s():i()}(e,t);if("hybrid"===i)return function(e,t,r){let n=(0,o.He)();function i(){let r,i,s=function(e,t,r){let n=function(e){let t=Math.max.apply(Math,e.map(eU));return e.map(([e,r])=>[e,r/t])}(ex(e,t,r)),o=eC(e,t,r),i=t.hybridWeights;return function(e,t,r,n){let o=Math.max.apply(Math,e.map(eU)),i=Math.max.apply(Math,t.map(eU)),{text:s,vector:a}=n&&n.text&&n.vector?n:{text:.5,vector:.5},l=new Map,u=e.length,f=(e,t)=>e*s+t*a;for(let t=0;t<u;t++){let[r,n]=e[t],i=f(n/o,0);l.set(r,i)}let c=t.length;for(let e=0;e<c;e++){let[r,n]=t[e],o=n/i,s=l.get(r)??0;l.set(r,s+f(0,o))}return[...l].sort((e,t)=>t[1]-e[1])}(n,o,t.term??"",i)}(e,t,void 0);t.facets&&Object.keys(t.facets).length>0&&(r=eD(e,s,t.facets)),t.groupBy&&(i=eR(e,s,t.groupBy));let a=e$(e,s,t.offset??0,t.limit??10).filter(Boolean),l=(0,o.He)(),u={count:s.length,elapsed:{raw:Number(l-n),formatted:(0,o.j7)(l-n)},hits:a,...r?{facets:r}:{},...i?{groups:i}:{}};if(!t.includeVectors){let t=Object.keys(e.data.index.vectorIndexes);(0,o.JW)(u,t)}return u}async function s(){e.beforeSearch&&await k(e.beforeSearch,e,t,void 0);let n=i();return e.afterSearch&&await E(e.afterSearch,e,t,r,n),n}return e.beforeSearch?.length||e.afterSearch?.length?s():i()}(e,t);throw(0,n.$)("INVALID_SEARCH_MODE",i)}function e$(e,t,r,n){let o=e.data.docs,i=Array.from({length:n}),s=new Set;for(let a=r;a<n+r;a++){let r=t[a];if(void 0===r)break;let[n,l]=r;if(!s.has(n)){let t=e.documentsStore.get(o,n);i[a]={id:g(e.internalDocumentIDStore,n),score:l,document:t},s.add(n)}}return i}Symbol("orama.insertions"),Symbol("orama.removals"),r(7377)},1901:(e,t,r)=>{function n(e,t,r){if(r<0)return -1;if(e===t)return 0;let n=e.length,o=t.length;if(0===n)return o<=r?o:-1;if(0===o)return n<=r?n:-1;let i=Math.abs(n-o);if(e.startsWith(t))return i<=r?i:-1;if(t.startsWith(e))return 0;if(i>r)return -1;let s=[];for(let e=0;e<=n;e++){s[e]=[e];for(let t=1;t<=o;t++)s[e][t]=0===e?t:0}for(let i=1;i<=n;i++){let n=1/0;for(let r=1;r<=o;r++)e[i-1]===t[r-1]?s[i][r]=s[i-1][r-1]:s[i][r]=Math.min(s[i-1][r]+1,s[i][r-1]+1,s[i-1][r-1]+1),n=Math.min(n,s[i][r]);if(n>r)return -1}return s[n][o]<=r?s[n][o]:-1}function o(e,t,r){let o=n(e,t,r);return{distance:o,isBounded:o>=0}}function i(e,t,r){let o=n(e,t,r);return{distance:o,isBounded:o>=0}}r.d(t,{Gd:()=>i,X1:()=>o})},2359:(e,t,r)=>{r.d(t,{DO:()=>o,Fc:()=>i,JK:()=>s});let n={arabic:"ar",armenian:"am",bulgarian:"bg",czech:"cz",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},o={dutch:/[^A-Za-zàèéìòóù0-9_'-]+/gim,english:/[^A-Za-zàèéìòóù0-9_'-]+/gim,french:/[^a-z0-9äâàéèëêïîöôùüûœç-]+/gim,italian:/[^A-Za-zàèéìòóù0-9_'-]+/gim,norwegian:/[^a-z0-9_æøåÆØÅäÄöÖüÜ]+/gim,portuguese:/[^a-z0-9à-úÀ-Ú]/gim,russian:/[^a-z0-9а-яА-ЯёЁ]+/gim,spanish:/[^a-z0-9A-Zá-úÁ-ÚñÑüÜ]+/gim,swedish:/[^a-z0-9_åÅäÄöÖüÜ-]+/gim,german:/[^a-z0-9A-ZäöüÄÖÜß]+/gim,finnish:/[^a-z0-9äöÄÖ]+/gim,danish:/[^a-z0-9æøåÆØÅ]+/gim,hungarian:/[^a-z0-9áéíóöőúüűÁÉÍÓÖŐÚÜŰ]+/gim,romanian:/[^a-z0-9ăâîșțĂÂÎȘȚ]+/gim,serbian:/[^a-z0-9čćžšđČĆŽŠĐ]+/gim,turkish:/[^a-z0-9çÇğĞıİöÖşŞüÜ]+/gim,lithuanian:/[^a-z0-9ąčęėįšųūžĄČĘĖĮŠŲŪŽ]+/gim,arabic:/[^a-z0-9أ-ي]+/gim,nepali:/[^a-z0-9अ-ह]+/gim,irish:/[^a-z0-9áéíóúÁÉÍÓÚ]+/gim,indian:/[^a-z0-9अ-ह]+/gim,armenian:/[^a-z0-9ա-ֆ]+/gim,greek:/[^a-z0-9α-ωά-ώ]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9а-яА-ЯіїєІЇЄ]+/gim,slovenian:/[^a-z0-9čžšČŽŠ]+/gim,bulgarian:/[^a-z0-9а-яА-Я]+/gim,tamil:/[^a-z0-9அ-ஹ]+/gim,sanskrit:/[^a-z0-9A-Zāīūṛḷṃṁḥśṣṭḍṇṅñḻḹṝ]+/gim,czech:/[^A-Z0-9a-zěščřžýáíéúůóťďĚŠČŘŽÝÁÍÉÓÚŮŤĎ-]+/gim},i=Object.keys(n);function s(e){return void 0!==e&&i.includes(e)?n[e]:void 0}},3460:(e,t,r)=>{r.d(t,{e:()=>S});var n=r(9838);let o=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115];var i=r(2359);let s={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},a={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},l="[aeiouy]",u="[^aeiou][^aeiouy]*",f=l+"[aeiou]*",c="^("+u+")?"+f+u,d="^("+u+")?"+f+u+"("+f+")?$",h="^("+u+")?"+f+u+f+u,p="^("+u+")?"+l;function g(e){let t,r,n,o,i,f;if(e.length<3)return e;let g=e.substring(0,1);if("y"==g&&(e=g.toUpperCase()+e.substring(1)),o=/^(.+?)([^s])s$/,(n=/^(.+?)(ss|i)es$/).test(e)?e=e.replace(n,"$1$2"):o.test(e)&&(e=e.replace(o,"$1$2")),o=/^(.+?)(ed|ing)$/,(n=/^(.+?)eed$/).test(e)){let t=n.exec(e);(n=new RegExp(c)).test(t[1])&&(n=/.$/,e=e.replace(n,""))}else o.test(e)&&(t=o.exec(e)[1],(o=new RegExp(p)).test(t)&&(e=t,o=/(at|bl|iz)$/,i=RegExp("([^aeiouylsz])\\1$"),f=RegExp("^"+u+l+"[^aeiouwxy]$"),o.test(e)?e+="e":i.test(e)?(n=/.$/,e=e.replace(n,"")):f.test(e)&&(e+="e")));if((n=/^(.+?)y$/).test(e)){let r=n.exec(e);t=r?.[1],n=new RegExp(p),t&&n.test(t)&&(e=t+"i")}if((n=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/).test(e)){let o=n.exec(e);t=o?.[1],r=o?.[2],n=new RegExp(c),t&&n.test(t)&&(e=t+s[r])}if((n=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/).test(e)){let o=n.exec(e);t=o?.[1],r=o?.[2],n=new RegExp(c),t&&n.test(t)&&(e=t+a[r])}if(o=/^(.+?)(s|t)(ion)$/,(n=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/).test(e)){let r=n.exec(e);t=r?.[1],n=new RegExp(h),t&&n.test(t)&&(e=t)}else if(o.test(e)){let r=o.exec(e);t=r?.[1]??""+r?.[2]??"",(o=new RegExp(h)).test(t)&&(e=t)}if((n=/^(.+?)e$/).test(e)){let r=n.exec(e);t=r?.[1],n=new RegExp(h),o=new RegExp(d),i=RegExp("^"+u+l+"[^aeiouwxy]$"),t&&(n.test(t)||o.test(t)&&!i.test(t))&&(e=t)}return n=/ll$/,o=new RegExp(h),n.test(e)&&o.test(e)&&(n=/.$/,e=e.replace(n,"")),"y"==g&&(e=g.toLowerCase()+e.substring(1)),e}function m(e,t,r=!0){let n=`${this.language}:${e}:${t}`;return r&&this.normalizationCache.has(n)?this.normalizationCache.get(n):this.stopWords?.includes(t)?(r&&this.normalizationCache.set(n,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(e)&&(t=this.stemmer(t)),t=function(e){let t=[];for(let n=0;n<e.length;n++){var r;t[n]=(r=e.charCodeAt(n))<192||r>383?r:o[r-192]||r}return String.fromCharCode(...t)}(t),r&&this.normalizationCache.set(n,t),t)}function b(e,t,r,o=!0){let s;if(t&&t!==this.language)throw(0,n.$)("LANGUAGE_NOT_SUPPORTED",t);if("string"!=typeof e)return[e];let a=this.normalizeToken.bind(this,r??"");if(r&&this.tokenizeSkipProperties.has(r))s=[a(e,o)];else{let t=i.DO[this.language];s=e.toLowerCase().split(t).map(e=>a(e,o)).filter(Boolean)}let l=function(e){for(;""===e[e.length-1];)e.pop();for(;""===e[0];)e.shift();return e}(s);return this.allowDuplicates?l:Array.from(new Set(l))}function S(e={}){let t,r;if(e.language){if(!i.Fc.includes(e.language))throw(0,n.$)("LANGUAGE_NOT_SUPPORTED",e.language)}else e.language="english";if(e.stemming||e.stemmer&&!("stemming"in e))if(e.stemmer){if("function"!=typeof e.stemmer)throw(0,n.$)("INVALID_STEMMER_FUNCTION_TYPE");t=e.stemmer}else if("english"===e.language)t=g;else throw(0,n.$)("MISSING_STEMMER",e.language);if(!1!==e.stopWords){if(r=[],Array.isArray(e.stopWords))r=e.stopWords;else if("function"==typeof e.stopWords)r=e.stopWords(r);else if(e.stopWords)throw(0,n.$)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(r))throw(0,n.$)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(let e of r)if("string"!=typeof e)throw(0,n.$)("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}let o={tokenize:b,language:e.language,stemmer:t,stemmerSkipProperties:new Set(e.stemmerSkipProperties?[e.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(e.tokenizeSkipProperties?[e.tokenizeSkipProperties].flat():[]),stopWords:r,allowDuplicates:!!e.allowDuplicates,normalizeToken:m,normalizationCache:new Map};return o.tokenize=b.bind(o),o.normalizeToken=m,o}},3514:(e,t,r)=>{r.d(t,{$J:()=>b,$S:()=>function e(t){return Array.isArray(t)?t.some(t=>e(t)):t?.constructor?.name==="AsyncFunction"},He:()=>p,JN:()=>y,JW:()=>w,NF:()=>g,O6:()=>N,_i:()=>A,g5:()=>m,gG:()=>D,h:()=>f,iR:()=>_,j7:()=>h,nv:()=>c,wH:()=>I,y$:()=>S});var n=r(9838),o=r(9509);let i=Date.now().toString().slice(5),s=0,a=BigInt(1e3),l=BigInt(1e6),u=BigInt(1e9);function f(e,t){if(t.length<65535)Array.prototype.push.apply(e,t);else{let r=t.length;for(let n=0;n<r;n+=65535)Array.prototype.push.apply(e,t.slice(n,n+65535))}}function c(e,...t){return e.replace(/%(?:(?<position>\d+)\$)?(?<width>-?\d*\.?\d*)(?<type>[dfs])/g,function(...e){let{width:r,type:n,position:o}=e[e.length-1],i=o?t[Number.parseInt(o)-1]:t.shift(),s=""===r?0:Number.parseInt(r);switch(n){case"d":return i.toString().padStart(s,"0");case"f":{let e=i,[t,n]=r.split(".").map(e=>Number.parseFloat(e));return"number"==typeof n&&n>=0&&(e=e.toFixed(n)),"number"==typeof t&&t>=0?e.toString().padStart(s,"0"):e.toString()}case"s":return s<0?i.toString().padEnd(-s," "):i.toString().padStart(s," ");default:return i}})}function d(){return BigInt(Math.floor(1e6*performance.now()))}function h(e){return("number"==typeof e&&(e=BigInt(e)),e<a)?`${e}ns`:e<l?`${e/a}μs`:e<u?`${e/l}ms`:`${e/u}s`}function p(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?d():void 0!==o&&o.release&&"node"===o.release.name||void 0!==o&&"function"==typeof o?.hrtime?.bigint?o.hrtime.bigint():"undefined"!=typeof performance?d():BigInt(0)}function g(){return`${i}-${s++}`}function m(e,t){return void 0===Object.hasOwn?Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0:Object.hasOwn(e,t)?e[t]:void 0}function b(e,t){return t[1]===e[1]?e[0]-t[0]:t[1]-e[1]}function S(e){if(0===e.length)return[];if(1===e.length)return e[0];for(let t=1;t<e.length;t++)if(e[t].length<e[0].length){let r=e[0];e[0]=e[t],e[t]=r}let t=new Map;for(let r of e[0])t.set(r,1);for(let r=1;r<e.length;r++){let n=0;for(let o of e[r]){let e=t.get(o);e===r&&(t.set(o,e+1),n++)}if(0===n)return[]}return e[0].filter(r=>{let n=t.get(r);return void 0!==n&&t.set(r,0),n===e.length})}function y(e,t){let r={},n=t.length;for(let o=0;o<n;o++){let n=t[o],i=n.split("."),s=e,a=i.length;for(let e=0;e<a;e++)if("object"==typeof(s=s[i[e]])){if(null!==s&&"lat"in s&&"lon"in s&&"number"==typeof s.lat&&"number"==typeof s.lon){s=r[n]=s;break}else if(!Array.isArray(s)&&null!==s&&e===a-1){s=void 0;break}}else if((null===s||"object"!=typeof s)&&e<a-1){s=void 0;break}void 0!==s&&(r[n]=s)}return r}function I(e,t){return y(e,[t])[t]}let O={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function N(e,t){let r=O[t];if(void 0===r)throw Error((0,n.$)("INVALID_DISTANCE_SUFFIX",e).message);return e*r}function w(e,t){e.hits=e.hits.map(e=>({...e,document:{...e.document,...t.reduce((e,t)=>{let r=t.split("."),n=r.pop(),o=e;for(let e of r)o[e]=o[e]??{},o=o[e];return o[n]=null,e},e.document)}}))}let T="intersection"in new Set;function _(...e){if(0===e.length)return new Set;if(1===e.length)return e[0];if(2===e.length){let t=e[0],r=e[1];if(T)return t.intersection(r);let n=new Set,o=t.size<r.size?t:r,i=o===t?r:t;for(let e of o)i.has(e)&&n.add(e);return n}let t={index:0,size:e[0].size};for(let r=1;r<e.length;r++)e[r].size<t.size&&(t.index=r,t.size=e[r].size);if(T){let r=e[t.index];for(let n=0;n<e.length;n++)n!==t.index&&(r=r.intersection(e[n]));return r}let r=e[t.index];for(let n=0;n<e.length;n++){if(n===t.index)continue;let o=e[n];for(let e of r)o.has(e)||r.delete(e)}return r}let v="union"in new Set;function D(e,t){return v?e?e.union(t):t:new Set(e?[...e,...t]:t)}function A(e,t){let r=new Set;for(let n of e)t.has(n)||r.add(n);return r}},7377:(e,t,r)=>{r.d(t,{X1:()=>n.X1});var n=r(1901);r(3514),r(3460)},9838:(e,t,r)=>{r.d(t,{$:()=>a});var n=r(2359),o=r(3514);let i=n.Fc.join("\n - "),s={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:`Language "%s" is not supported.
Supported languages are:
 - ${i}`,INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.orama.com/open-source/text-analysis/stemming for more information.',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:'Unsupported component "%s".',COMPONENT_MUST_BE_FUNCTION:'The component "%s" must be a function.',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:'The component "%s" must be a function or an array of functions.',INVALID_SCHEMA_TYPE:'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.',DOCUMENT_ID_MUST_BE_STRING:'Document id must be of type "string". Got "%s" instead.',DOCUMENT_ALREADY_EXISTS:'A document with id "%s" already exists.',DOCUMENT_DOES_NOT_EXIST:'A document with id "%s" does not exists.',MISSING_DOCUMENT_PROPERTY:'Missing searchable property "%s".',INVALID_DOCUMENT_PROPERTY:'Invalid document property "%s": expected "%s", got "%s"',UNKNOWN_INDEX:'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:'Cannot insert document due schema validation failure on "%s" property.',INVALID_SORT_SCHEMA_TYPE:'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".',CANNOT_SORT_BY_ARRAY:'Cannot configure sort for "%s" because it is an array (%s).',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:'Unable to sort on unknown field "%s". Allowed fields: %s',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.oramasearch for more information.",UNKNOWN_GROUP_BY_PROPERTY:'Unknown groupBy property "%s".',INVALID_GROUP_BY_PROPERTY:'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".',UNKNOWN_FILTER_PROPERTY:'Unknown filter property "%s".',INVALID_VECTOR_SIZE:'Vector size must be a number greater than 0. Got "%s" instead.',INVALID_VECTOR_VALUE:'Vector value must be a number greater than 0. Got "%s" instead.',INVALID_INPUT_VECTOR:`Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.
Input vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.`,WRONG_SEARCH_PROPERTY_TYPE:'Property "%s" is not searchable. Only "string" properties are searchable.',FACET_NOT_SUPPORTED:'Facet doens\'t support the type "%s".',INVALID_DISTANCE_SUFFIX:'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.',INVALID_SEARCH_MODE:'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:'"term" is a required parameter when performing hybrid search. Please provide a search term.',INVALID_VECTOR_INPUT:'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:",PLUGIN_SECURE_PROXY_NOT_FOUND:`Could not find '@orama/secure-proxy-plugin' installed in your Orama instance.
Please install it before proceeding with creating an answer session.
Read more at https://docs.orama.com/open-source/plugins/plugin-secure-proxy#plugin-secure-proxy
`,PLUGIN_SECURE_PROXY_MISSING_CHAT_MODEL:`Could not find a chat model defined in the secure proxy plugin configuration.
Please provide a chat model before proceeding with creating an answer session.
Read more at https://docs.orama.com/open-source/plugins/plugin-secure-proxy#plugin-secure-proxy
`,ANSWER_SESSION_LAST_MESSAGE_IS_NOT_ASSISTANT:"The last message in the session is not an assistant message. Cannot regenerate non-assistant messages.",PLUGIN_COMPONENT_CONFLICT:'The component "%s" is already defined. The plugin "%s" is trying to redefine it.'};function a(e,...t){let r=Error((0,o.nv)(s[e]??`Unsupported Orama Error code: ${e}`,...t));return r.code=e,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(r),r}}}]);
3:I[9275,[],""]
5:I[1343,[],""]
6:I[7786,["401","static/chunks/363642f4-9e72429e661e47fa.js","344","static/chunks/e58a7f8f-3e17ebe2d129a781.js","173","static/chunks/173-26eb077acb4f64fe.js","459","static/chunks/459-ba55fbbe75738db5.js","231","static/chunks/231-c1c00e13a9884adf.js","185","static/chunks/app/layout-f86ce6df05580f72.js"],"script"]
7:I[9645,["401","static/chunks/363642f4-9e72429e661e47fa.js","344","static/chunks/e58a7f8f-3e17ebe2d129a781.js","173","static/chunks/173-26eb077acb4f64fe.js","459","static/chunks/459-ba55fbbe75738db5.js","231","static/chunks/231-c1c00e13a9884adf.js","185","static/chunks/app/layout-f86ce6df05580f72.js"],"default"]
8:I[6747,["401","static/chunks/363642f4-9e72429e661e47fa.js","344","static/chunks/e58a7f8f-3e17ebe2d129a781.js","173","static/chunks/173-26eb077acb4f64fe.js","459","static/chunks/459-ba55fbbe75738db5.js","231","static/chunks/231-c1c00e13a9884adf.js","185","static/chunks/app/layout-f86ce6df05580f72.js"],"NavBar"]
9:I[231,["401","static/chunks/363642f4-9e72429e661e47fa.js","344","static/chunks/e58a7f8f-3e17ebe2d129a781.js","173","static/chunks/173-26eb077acb4f64fe.js","459","static/chunks/459-ba55fbbe75738db5.js","231","static/chunks/231-c1c00e13a9884adf.js","931","static/chunks/app/page-177dc2fadefdbd75.js"],""]
4:["id","publishing-dual-module-esm-libraries","d"]
0:["EAvlJV3vZIlPlY9WyMO8L",[[["",{"children":["posts",{"children":[["id","publishing-dual-module-esm-libraries","d"],{"children":["__PAGE__?{\"id\":\"publishing-dual-module-esm-libraries\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["posts",{"children":[["id","publishing-dual-module-esm-libraries","d"],{"children":["__PAGE__",{},[["$L1","$L2"],null],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/709e32fbdffc72bf.css","precedence":"next","crossOrigin":"$undefined"}]]}],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},[["$","html",null,{"lang":"en","className":"__variable_7c3f16 __variable_6c6f2f __variable_988d07","suppressHydrationWarning":true,"children":[["$","head",null,{"children":[["$","script",null,{"dangerouslySetInnerHTML":{"__html":"$6"}}],["$","$L7",null,{}]]}],["$","body",null,{"children":[["$","$L8",null,{}],["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":null}],["$","div",null,{"className":"styles_container__0CKa2","children":["$","footer",null,{"children":["Copyright Â© ",2024," ",["$","$L9",null,{"href":"/about","children":"Satyajit Sahoo"}],". All rights reserved."]}]}]]}]]}],null],null],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/5d38fd6d6ea22642.css","precedence":"next","crossOrigin":"$undefined"}]],"$La"]]]]
b:I[5969,["401","static/chunks/363642f4-9e72429e661e47fa.js","344","static/chunks/e58a7f8f-3e17ebe2d129a781.js","173","static/chunks/173-26eb077acb4f64fe.js","459","static/chunks/459-ba55fbbe75738db5.js","722","static/chunks/app/posts/%5Bid%5D/page-81ef5d2ca4a95540.js"],"TableOfContent"]
c:I[9936,["401","static/chunks/363642f4-9e72429e661e47fa.js","344","static/chunks/e58a7f8f-3e17ebe2d129a781.js","173","static/chunks/173-26eb077acb4f64fe.js","459","static/chunks/459-ba55fbbe75738db5.js","722","static/chunks/app/posts/%5Bid%5D/page-81ef5d2ca4a95540.js"],"Pre"]
d:I[420,["401","static/chunks/363642f4-9e72429e661e47fa.js","344","static/chunks/e58a7f8f-3e17ebe2d129a781.js","173","static/chunks/173-26eb077acb4f64fe.js","459","static/chunks/459-ba55fbbe75738db5.js","722","static/chunks/app/posts/%5Bid%5D/page-81ef5d2ca4a95540.js"],"SocialLinks"]
2:["$","main",null,{"children":[["$","article",null,{"children":[["$","$Lb",null,{"toc":[{"depth":2,"value":"ESM and CommonJS","attributes":{},"children":[],"slug":"esm-and-commonjs"},{"depth":2,"value":"Why dual module libraries?","attributes":{},"children":[],"slug":"why-dual-module-libraries"},{"depth":2,"value":"Entry points in package.json","attributes":{},"children":[],"slug":"entry-points-in-packagejson"},{"depth":2,"value":"The exports field in package.json","attributes":{},"children":[{"depth":3,"value":"Conditional exports","attributes":{},"children":[],"slug":"conditional-exports"},{"depth":3,"value":"Subpath exports","attributes":{},"children":[],"slug":"subpath-exports"}],"slug":"the-exports-field-in-packagejson"},{"depth":2,"value":"Ambiguity in ESM and CommonJS","attributes":{},"children":[{"depth":3,"value":"The type field in package.json","attributes":{},"children":[],"slug":"the-type-field-in-packagejson"},{"depth":3,"value":"File extension","attributes":{},"children":[],"slug":"file-extension"},{"depth":3,"value":"Script tag type attribute","attributes":{},"children":[],"slug":"script-tag-type-attribute"}],"slug":"ambiguity-in-esm-and-commonjs"},{"depth":2,"value":"Explicit file extensions","attributes":{},"children":[],"slug":"explicit-file-extensions"},{"depth":2,"value":"Approaches","attributes":{},"children":[{"depth":3,"value":"ES module wrapper with CommonJS code","attributes":{},"children":[],"slug":"es-module-wrapper-with-commonjs-code"},{"depth":3,"value":"Separate ESM and CommonJS builds","attributes":{},"children":[{"depth":4,"value":"Dual package hazard","attributes":{},"children":[],"slug":"dual-package-hazard"},{"depth":4,"value":"Mismatched module type","attributes":{},"children":[],"slug":"mismatched-module-type"},{"depth":4,"value":"Lack of support for .mjs or .cjs","attributes":{},"children":[],"slug":"lack-of-support-for-mjs-or-cjs"},{"depth":4,"value":"Lack of support for Platform-specific extension","attributes":{},"children":[],"slug":"lack-of-support-for-platform-specific-extension"}],"slug":"separate-esm-and-commonjs-builds"}],"slug":"approaches"},{"depth":2,"value":"TypeScript","attributes":{},"children":[{"depth":3,"value":"Configuration","attributes":{},"children":[],"slug":"configuration"},{"depth":3,"value":"File extensions in import statements","attributes":{},"children":[],"slug":"file-extensions-in-import-statements"},{"depth":3,"value":"Default exports","attributes":{},"children":[],"slug":"default-exports"},{"depth":3,"value":"Types in the exports field","attributes":{},"children":[],"slug":"types-in-the-exports-field"}],"slug":"typescript"},{"depth":2,"value":"Useful tools","attributes":{},"children":[],"slug":"useful-tools"},{"depth":2,"value":"Conclusion","attributes":{},"children":[],"slug":"conclusion"}]}],["$","h1",null,{"children":"Publishing dual module ESM libraries"}],["$","div",null,{"className":"styles_meta__208KK","children":[["$","span",null,{"children":"13 min read"}],["$","time",null,{"dateTime":"2024-07-12","children":"July 12, 2024"}]]}],[["$","p",null,{"children":"Recently I've been looking into moving to ES modules for my libraries and wanted to do it in a way that doesn't break existing users. But it's tricky - and took a lot of trial and error. In this post, I'll share my findings."}],"\n",["$","h2",null,{"id":"esm-and-commonjs","children":["$","a",null,{"href":"#esm-and-commonjs","children":"ESM and CommonJS"}]}],"\n",["$","p",null,{"children":[["$","a",null,{"href":"https://nodejs.org/api/esm.html","rel":"nofollow","target":"_blank","children":"ES modules"}]," (ESM) are the official standard module system in JavaScript. They are supported in modern browsers and ",["$","a",null,{"href":"https://nodejs.org","rel":"nofollow","target":"_blank","children":"Node.js"}],", as well as by most bundlers. They are defined by the ",["$","code",null,{"children":"import"}]," and ",["$","code",null,{"children":"export"}]," keywords:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":"// Importing an ES module"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" }"}],["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":" from"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" '"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":"// Exporting from an ES module"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"export"}],["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":" default"}],["$","span",null,{"style":{"color":"#C792EA"},"children":" function"}],["$","span",null,{"style":{"color":"#82AAFF"},"children":" bar"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"()"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"  return"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]}],"\n",["$","p",null,{"children":[["$","a",null,{"href":"https://nodejs.org/api/modules.html","rel":"nofollow","target":"_blank","children":"CommonJS modules"}]," (CJS) are the module system that has been traditionally used in Node.js, but also adopted by most tools and bundlers. They are defined by the ",["$","code",null,{"children":"require"}]," function and the ",["$","code",null,{"children":"module.exports"}]," object:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":"// Importing a CommonJS module"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#C792EA"},"children":"const"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo "}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" ="}],["$","span",null,{"style":{"color":"#82AAFF"},"children":" require"}],["$","span",null,{"style":{"color":"#BABED8"},"children":"("}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#BABED8"},"children":")"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":"// Exporting from a CommonJS module"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"module.exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" ="}],["$","span",null,{"style":{"color":"#C792EA"},"children":" function"}],["$","span",null,{"style":{"color":"#82AAFF"},"children":" bar"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"()"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"  return"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"};"}]}]]}]}]}],"\n",["$","p",null,{"children":"So depending on the environment, we'd need to use the appropriate module system."}],"\n",["$","h2",null,{"id":"why-dual-module-libraries","children":["$","a",null,{"href":"#why-dual-module-libraries","children":"Why dual module libraries?"}]}],"\n",["$","p",null,{"children":"When publishing a library written with ES modules, we may want to provide both ESM and CommonJS modules. This can be necessary for a couple of reasons:"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":"Some tools or environments may not support ES modules yet, so providing a CommonJS version can be useful."}],"\n",["$","li",null,{"children":["Node.js code written with CommonJS modules can only import ESM code asynchronously with dynamic ",["$","code",null,{"children":"import"}]," syntax (",["$","a",null,{"href":"https://nodejs.org/api/esm.html#interoperability-with-commonjs","rel":"nofollow","target":"_blank","children":["synchronous require is available for Node.js 22 behind a flag: ",["$","code",null,{"children":"--experimental-require-module"}]]}],"), so providing a CommonJS version is necessary for synchronous usage."]}],"\n"]}],"\n",["$","p",null,{"children":"Essentially, providing both ESM and CommonJS modules is a way to move to ESM without a breaking change."}],"\n",["$","p",null,{"children":"And of course, if you don't need to support CommonJS environments, you can publish your library as an ESM-only package which is much simpler."}],"\n",["$","h2",null,{"id":"entry-points-in-packagejson","children":["$","a",null,{"href":"#entry-points-in-packagejson","children":["Entry points in ",["$","code",null,{"children":"package.json"}]]}]}],"\n",["$","p",null,{"children":["The ",["$","code",null,{"children":"package.json"}]," can contain various fields that point to the file that should be loaded when the package is imported or required."]}],"\n",["$","p",null,{"children":"The most common fields are:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"main"}],": This field has been supported in Node.js for a long time and points to the CommonJS entry point. This is supported by the majority of tools and bundlers."]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"module"}],": This field is used by bundlers like ",["$","a",null,{"href":"https://webpack.js.org","rel":"nofollow","target":"_blank","children":"webpack"}]," or ",["$","a",null,{"href":"https://rollupjs.org/","rel":"nofollow","target":"_blank","children":"Rollup"}]," to load the ESM entry point. This field is not supported in Node.js."]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"exports"}],": This field is a newer addition to the ",["$","code",null,{"children":"package.json"}]," specification and allows specifying ",["$","a",null,{"href":"https://nodejs.org/api/packages.html#conditional-exports","rel":"nofollow","target":"_blank","children":"multiple entry points for different environments conditionally"}],"."]}],"\n"]}],"\n",["$","p",null,{"children":"In addition, if you're writing client-side code, you may have come across the following fields:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"browser"}],": This field is used to specify a different entry point for client-side code for the browser. This field is used by bundlers such as webpack and Rollup."]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"react-native"}],": This field is used to specify a different entry point for React Native environments. This field is supported by bundlers like ",["$","a",null,{"href":"https://metrobundler.dev","rel":"nofollow","target":"_blank","children":"Metro"}],"."]}],"\n"]}],"\n",["$","p",null,{"children":["When writing dual modules, we'd want to use the ",["$","code",null,{"children":"exports"}]," field to specify both ESM and CommonJS entry points, while also providing the ",["$","code",null,{"children":"main"}]," and ",["$","code",null,{"children":"module"}]," fields for backwards compatibility."]}],"\n",["$","h2",null,{"id":"the-exports-field-in-packagejson","children":["$","a",null,{"href":"#the-exports-field-in-packagejson","children":["The ",["$","code",null,{"children":"exports"}]," field in ",["$","code",null,{"children":"package.json"}]]}]}],"\n",["$","p",null,{"children":["The ",["$","code",null,{"children":"exports"}]," field in ",["$","code",null,{"children":"package.json"}]," allows specifying multiple entry points for different environments conditionally. It can be used to specify ESM and CommonJS entry points for dual module libraries."]}],"\n",["$","p",null,{"children":["Here we'll cover the 2 most common cases. You can find more information in the ",["$","a",null,{"href":"https://nodejs.org/api/packages.html#package-entry-points","rel":"nofollow","target":"_blank","children":"official Node.js documentation for entry points"}],"."]}],"\n",["$","h3",null,{"id":"conditional-exports","children":["$","a",null,{"href":"#conditional-exports","children":"Conditional exports"}]}],"\n",["$","p",null,{"children":["The ",["$","code",null,{"children":"exports"}]," field specifies conditions for different environments. Think of it like an if-else statement - the module resolution goes through each of the conditions one by one and uses the first one that matches."]}],"\n",["$","p",null,{"children":["A basic example of ",["$","code",null,{"children":"exports"}]," field would be:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":"Here, the condition is as follows:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["When the package is imported, the ",["$","code",null,{"children":"import"}]," condition is used"]}],"\n",["$","li",null,{"children":["When the package is required, the ",["$","code",null,{"children":"require"}]," condition is used"]}],"\n"]}],"\n",["$","p",null,{"children":["In addition, the conditions can also specify a ",["$","code",null,{"children":"default"}]," for the fallback, which is used if none of the conditions match:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"browser"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./dist/browser.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"react-native"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./dist/react-native.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"default"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./dist/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":"In the above example, the condition is as follows:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["When the package is imported in a browser environment, the ",["$","code",null,{"children":"browser"}]," condition is used"]}],"\n",["$","li",null,{"children":["When the package is imported in a React Native environment, the ",["$","code",null,{"children":"react-native"}]," condition is used"]}],"\n",["$","li",null,{"children":["If neither of the conditions matches, the ",["$","code",null,{"children":"default"}]," condition is used"]}],"\n"]}],"\n",["$","p",null,{"children":"What conditions are available depends on the environment and the tooling used for module resolution."}],"\n",["$","p",null,{"children":[["$","strong",null,{"children":"The order of the conditions is important"}],". Multiple conditions may match, e.g. if we have the conditions ",["$","code",null,{"children":"node"}]," and ",["$","code",null,{"children":"require"}]," - both would match when the package is required in Node.js. In this case, the first condition that matches is used:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":"// This is not correct"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index-node.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"node"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index-node.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":["In the above example, the ",["$","code",null,{"children":"require"}]," condition would always match first, so the ",["$","code",null,{"children":"node"}]," condition would never be used. The correct order would be:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"node"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index-node.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index-node.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":"It is recommended to use the most specific conditions first, and the most general conditions last."}],"\n",["$","p",null,{"children":"The conditions can also be nested. For example:"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"node"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"        \""}],["$","span",null,{"style":{"color":"#F07178"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index-node.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"        \""}],["$","span",null,{"style":{"color":"#F07178"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index-node.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"      },"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"default"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":"This can be useful if you want to have more specific conditions for certain environments."}],"\n",["$","h3",null,{"id":"subpath-exports","children":["$","a",null,{"href":"#subpath-exports","children":"Subpath exports"}]}],"\n",["$","p",null,{"children":["When the ",["$","code",null,{"children":"exports"}]," field is defined, it's no longer possible import a subpath of the package directly. For example, if we have the following ",["$","code",null,{"children":"exports"}]," field:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":"We can't import or require a subpath of the package directly:"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":"// This would not work"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#82AAFF"},"children":"require"}],["$","span",null,{"style":{"color":"#BABED8"},"children":"("}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"my-package/foo.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#BABED8"},"children":")"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}]]}]}]}],"\n",["$","p",null,{"children":["Similar to how ",["$","code",null,{"children":"."}]," points to the main entry point, subpaths can also be specified in the ",["$","code",null,{"children":"exports"}]," field:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    },"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"./foo.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/foo.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/foo.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":["This will now allow importing or requiring ",["$","code",null,{"children":"my-package/foo.js"}],"."]}],"\n",["$","h2",null,{"id":"ambiguity-in-esm-and-commonjs","children":["$","a",null,{"href":"#ambiguity-in-esm-and-commonjs","children":"Ambiguity in ESM and CommonJS"}]}],"\n",["$","p",null,{"children":"CommonJS and ESM have different semantics, with different sets of features and limitations. This means that we need to be explicit about which module system we're using."}],"\n",["$","p",null,{"children":"There are a few ways to specify the module system:"}],"\n",["$","h3",null,{"id":"the-type-field-in-packagejson","children":["$","a",null,{"href":"#the-type-field-in-packagejson","children":["The ",["$","code",null,{"children":"type"}]," field in ",["$","code",null,{"children":"package.json"}]]}]}],"\n",["$","p",null,{"children":["The ",["$","code",null,{"children":"type"}]," field in ",["$","code",null,{"children":"package.json"}]," can be used to specify the module system used by the package in ",["$","code",null,{"children":"Node.js"}],". The value can be either ",["$","code",null,{"children":"module"}]," for ESM or ",["$","code",null,{"children":"commonjs"}]," for CommonJS:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"type"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"module"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":["When the ",["$","code",null,{"children":"type"}]," field is set to ",["$","code",null,{"children":"module"}],", all ",["$","code",null,{"children":".js"}]," files in the package are treated as ESM files. When the ",["$","code",null,{"children":"type"}]," field is set to ",["$","code",null,{"children":"commonjs"}],", all ",["$","code",null,{"children":".js"}]," files are treated as CommonJS files."]}],"\n",["$","p",null,{"children":["By default, the ",["$","code",null,{"children":"type"}]," field is assumed to be ",["$","code",null,{"children":"commonjs"}]," if not specified."]}],"\n",["$","h3",null,{"id":"file-extension","children":["$","a",null,{"href":"#file-extension","children":"File extension"}]}],"\n",["$","p",null,{"children":["The file extension can also be used to specify the module system in ",["$","code",null,{"children":"Node.js"}],":"]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":".mjs"}]," files are treated as ESM files."]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":".cjs"}]," files are treated as CommonJS files."]}],"\n"]}],"\n",["$","p",null,{"children":["Regardless of the ",["$","code",null,{"children":"type"}]," field, files with the ",["$","code",null,{"children":".mjs"}]," extension are always treated as ESM files, and files with the ",["$","code",null,{"children":".cjs"}]," extension are always treated as CommonJS files in Node.js."]}],"\n",["$","h3",null,{"id":"script-tag-type-attribute","children":["$","a",null,{"href":"#script-tag-type-attribute","children":["Script tag ",["$","code",null,{"children":"type"}]," attribute"]}]}],"\n",["$","p",null,{"children":["In the browser, the module system is determined by the ",["$","code",null,{"children":"type"}]," attribute in the ",["$","code",null,{"children":"script"}]," tag:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"html","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"html","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"<"}],["$","span",null,{"style":{"color":"#F07178"},"children":"script"}],["$","span",null,{"style":{"color":"#C792EA"},"children":" type"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"module"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#C792EA"},"children":" src"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"></"}],["$","span",null,{"style":{"color":"#F07178"},"children":"script"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":">"}]]}]}]}]}],"\n",["$","p",null,{"children":["When the ",["$","code",null,{"children":"type"}]," attribute is set to ",["$","code",null,{"children":"module"}],", the file is treated as an ESM file. When the ",["$","code",null,{"children":"type"}]," attribute is not specified or set to ",["$","code",null,{"children":"text/javascript"}],", the file is treated as a CommonJS file."]}],"\n",["$","p",null,{"children":["Unlike Node.js, the file extension does not determine the module system in the browser, and browsers don't read the ",["$","code",null,{"children":"package.json"}]," file."]}],"\n",["$","h2",null,{"id":"explicit-file-extensions","children":["$","a",null,{"href":"#explicit-file-extensions","children":"Explicit file extensions"}]}],"\n",["$","p",null,{"children":["Unlike CommonJS modules, ES modules in Node.js require explicit file extensions in ",["$","code",null,{"children":"import"}],"/",["$","code",null,{"children":"export"}]," statements:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" }"}],["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":" from"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" '"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}]}]}]}],"\n",["$","p",null,{"children":"While explicit file extensions are not required in browsers - as the import specifier is a URL and the server can be configured to serve the correct file, it can still be simpler to use file extensions to avoid additional logic on the server."}],"\n",["$","h2",null,{"id":"approaches","children":["$","a",null,{"href":"#approaches","children":"Approaches"}]}],"\n",["$","p",null,{"children":["There are ",["$","a",null,{"href":"https://nodejs.org/api/packages.html#dual-commonjses-module-packages","rel":"nofollow","target":"_blank","children":"2 main approaches"}]," to publishing dual module libraries:"]}],"\n",["$","h3",null,{"id":"es-module-wrapper-with-commonjs-code","children":["$","a",null,{"href":"#es-module-wrapper-with-commonjs-code","children":"ES module wrapper with CommonJS code"}]}],"\n",["$","p",null,{"children":"This is the simplest approach. You write your library in CommonJS and create an ESM wrapper around it. The ESM wrapper imports the CommonJS code and re-exports it:"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"js","data-theme":"material-theme-palenight","children":"esm-wrapper.mjs"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":"// Import the CommonJS module"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"import"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" myModule "}],["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"from"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" '"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./my-module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":"// Export the individual exports from the CommonJS module"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"export"}],["$","span",null,{"style":{"color":"#C792EA"},"children":" const"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo "}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#BABED8"},"children":" myModule"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"."}],["$","span",null,{"style":{"color":"#BABED8"},"children":"foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"export"}],["$","span",null,{"style":{"color":"#C792EA"},"children":" const"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" bar "}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#BABED8"},"children":" myModule"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"."}],["$","span",null,{"style":{"color":"#BABED8"},"children":"bar"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}]]}]}]]}],"\n",["$","p",null,{"children":["Then in your ",["$","code",null,{"children":"package.json"}],", you'd specify the ",["$","code",null,{"children":"exports"}]," field to point to the ESM wrapper for ESM environments and the CommonJS module for CommonJS environments, as well as fallbacks with ",["$","code",null,{"children":"main"}]," and ",["$","code",null,{"children":"module"}]," fields:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"type"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"commonjs"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"main"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./my-module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm-wrapper.mjs"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./my-module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":"This avoids the need to refactor your code to ESM."}],"\n",["$","p",null,{"children":"However, this approach has a few downsides:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"The ESM wrapper needs to be maintained manually, so it can be error-prone."}],"\n",["$","li",null,{"children":"Since our code is still written in CommonJS, we don't get the benefits of ESM like tree-shaking with bundlers."}],"\n"]}],"\n",["$","h3",null,{"id":"separate-esm-and-commonjs-builds","children":["$","a",null,{"href":"#separate-esm-and-commonjs-builds","children":"Separate ESM and CommonJS builds"}]}],"\n",["$","p",null,{"children":"This approach involves writing your library in ESM and CommonJS separately - or more commonly, authoring in ESM and using tooling to generate the CommonJS build."}],"\n",["$","p",null,{"children":["Then in your ",["$","code",null,{"children":"package.json"}],", you'd specify the ",["$","code",null,{"children":"exports"}]," field to point to the ES module for ESM environments and the CommonJS module for CommonJS environments, as well as fallbacks with ",["$","code",null,{"children":"main"}]," and ",["$","code",null,{"children":"module"}]," fields:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"main"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index.cjs"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"module"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.mjs"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.mjs"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index.cjs"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":"This approach has the benefit of allowing you to write your code in ESM and get the benefits of ESM like tree-shaking with bundlers. But it also increases complexity in the build process."}],"\n",["$","p",null,{"children":"When following this approach, you may encounter a few issues:"}],"\n",["$","h4",null,{"id":"dual-package-hazard","children":["$","a",null,{"href":"#dual-package-hazard","children":"Dual package hazard"}]}],"\n",["$","p",null,{"children":["With this approach, the ESM and CommonJS versions of the package are treated as separate modules by Node.js as they are different files, leading to ",["$","a",null,{"href":"https://nodejs.org/api/packages.html#dual-package-hazard","rel":"nofollow","target":"_blank","children":"potential issues"}]," if the package is both imported and required in the same runtime environment."]}],"\n",["$","p",null,{"children":"If the package relies on any state that can cause issues if 2 separate instances are loaded, it's necessary to isolate the state into a separate CommonJS module that can be shared between the ESM and CommonJS builds."}],"\n",["$","p",null,{"children":"This is not an issue if it's safe to have 2 separate instances of the package loaded in the same environment, which is often the case for most libraries."}],"\n",["$","h4",null,{"id":"mismatched-module-type","children":["$","a",null,{"href":"#mismatched-module-type","children":"Mismatched module type"}]}],"\n",["$","p",null,{"children":["The ",["$","code",null,{"children":"import"}]," and ",["$","code",null,{"children":"require"}]," conditions only tell Node.js which file to load when the package is imported or required, but they don't say which module system is used in the file. So it's possible to specify an ES module in the ",["$","code",null,{"children":"require"}]," condition and a CommonJS module in the ",["$","code",null,{"children":"import"}]," condition, which may not work as expected."]}],"\n",["$","p",null,{"children":"To avoid this footgun, you can do any of the following:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["Avoid using ",["$","code",null,{"children":".js"}]," files and use the ",["$","code",null,{"children":".cjs"}]," and ",["$","code",null,{"children":".mjs"}]," file extensions to specify the module system."]}],"\n",["$","li",null,{"children":["Specify ",["$","code",null,{"children":"type: 'commonjs'"}]," in ",["$","code",null,{"children":"package.json"}]," to treat all ",["$","code",null,{"children":".js"}]," files as CommonJS and use ",["$","code",null,{"children":".mjs"}]," files for the ESM build."]}],"\n",["$","li",null,{"children":["Specify ",["$","code",null,{"children":"type: 'module'"}]," in ",["$","code",null,{"children":"package.json"}]," to treat all ",["$","code",null,{"children":".js"}]," files as ESM and use ",["$","code",null,{"children":".cjs"}]," files for the CommonJS build."]}],"\n"]}],"\n",["$","h4",null,{"id":"lack-of-support-for-mjs-or-cjs","children":["$","a",null,{"href":"#lack-of-support-for-mjs-or-cjs","children":["Lack of support for ",["$","code",null,{"children":".mjs"}]," or ",["$","code",null,{"children":".cjs"}]]}]}],"\n",["$","p",null,{"children":["Since we aim to support older environments that don't support the new ES module system, they may not recognize the ",["$","code",null,{"children":".mjs"}]," or ",["$","code",null,{"children":".cjs"}]," file extensions. Most modern tools and bundlers support the ",["$","code",null,{"children":".mjs"}]," and ",["$","code",null,{"children":".cjs"}]," file extensions, but they might also differ in how they treat these files. For example, ",["$","a",null,{"href":"https://vitejs.dev","rel":"nofollow","target":"_blank","children":"Vite"}]," allows importing ",["$","code",null,{"children":".mjs"}]," files without explicit file extensions, but Metro doesn't."]}],"\n",["$","p",null,{"children":["One way to avoid this issue is to use the ",["$","code",null,{"children":".js"}]," file extension for both ESM and CommonJS files. But how do we specify the module system in this case? We can't use the ",["$","code",null,{"children":"type"}]," field in the project's ",["$","code",null,{"children":"package.json"}]," as it applies to all ",["$","code",null,{"children":".js"}]," files. But we can create ",["$","code",null,{"children":"package.json"}]," files with a ",["$","code",null,{"children":"type"}]," field in each of the build folders:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"sh","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"sh","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#FFCB6B"},"children":"my-library/"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#FFCB6B"},"children":"âââ"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":" esm/"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#FFCB6B"},"children":"âÂ Â "}],["$","span",null,{"style":{"color":"#C3E88D"},"children":" âââ"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":" index.js"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#FFCB6B"},"children":"âÂ Â "}],["$","span",null,{"style":{"color":"#C3E88D"},"children":" âââ"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":" package.json"}],["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":" # { \"type\": \"module\" }"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#FFCB6B"},"children":"âââ"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":" cjs/"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#C3E88D"},"children":"  Â Â  âââ"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":" index.js"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#C3E88D"},"children":"  Â Â  âââ"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":" package.json"}],["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":" # { \"type\": \"commonjs\" }"}]]}]]}]}]}],"\n",["$","p",null,{"children":["And then in the main ",["$","code",null,{"children":"package.json"}],", we point to the respective ",["$","code",null,{"children":".js"}]," files:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"package.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"main"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"module"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","h4",null,{"id":"lack-of-support-for-platform-specific-extension","children":["$","a",null,{"href":"#lack-of-support-for-platform-specific-extension","children":"Lack of support for Platform-specific extension"}]}],"\n",["$","p",null,{"children":["When writing cross-platform code, such as code that supports React Native, we often use platform-specific extensions such as ",["$","code",null,{"children":".android.js"}],", ",["$","code",null,{"children":".ios.js"}],", ",["$","code",null,{"children":".native.js"}],", etc. However, this doesn't work with the explicit file extension requirement in ESM."]}],"\n",["$","p",null,{"children":["For example, let's say we have 2 files: ",["$","code",null,{"children":"foo.android.js"}]," and ",["$","code",null,{"children":"foo.js"}],", and an import statement: ",["$","code",null,{"children":"import foo from './foo'"}],". Normally the bundler would resolve ",["$","code",null,{"children":"foo.android.js"}]," for Android and ",["$","code",null,{"children":"foo.js"}]," for other platforms. But in ESM, the file extension is required, so the import statement would need to be ",["$","code",null,{"children":"import foo from './foo.js'"}]," - which would break the platform-specific resolution as now the bundler would always resolve ",["$","code",null,{"children":"foo.js"}],"."]}],"\n",["$","p",null,{"children":"Alternative approaches to handle this would be to:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Use a separate CommonJS build that contains the platform-specific files, and can import them without specifying the file extension."}],"\n",["$","li",null,{"children":"Instead of separate files, use a single file with platform-specific logic conditionally executed based on the platform."}],"\n"]}],"\n",["$","h2",null,{"id":"typescript","children":["$","a",null,{"href":"#typescript","children":"TypeScript"}]}],"\n",["$","h3",null,{"id":"configuration","children":["$","a",null,{"href":"#configuration","children":"Configuration"}]}],"\n",["$","p",null,{"children":["When writing ES modules in TypeScript, it's necessary to configure the ",["$","code",null,{"children":"module"}]," and ",["$","code",null,{"children":"moduleResolution"}]," options in ",["$","code",null,{"children":"tsconfig.json"}],":"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":[["$","figcaption",null,{"data-rehype-pretty-code-title":"","data-language":"json","data-theme":"material-theme-palenight","children":"tsconfig.json"}],["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"compilerOptions"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"module"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"ESNext"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"moduleResolution"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"NodeNext"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]]}],"\n",["$","p",null,{"children":["When the ",["$","code",null,{"children":"module"}]," option is set to ",["$","code",null,{"children":"ESNext"}],", TypeScript generates ES module syntax in the output. It also requires file extensions in ",["$","code",null,{"children":"import"}]," statements."]}],"\n",["$","h3",null,{"id":"file-extensions-in-import-statements","children":["$","a",null,{"href":"#file-extensions-in-import-statements","children":["File extensions in ",["$","code",null,{"children":"import"}]," statements"]}]}],"\n",["$","p",null,{"children":["When using TypeScript with ES modules, it's necessary to specify the ",["$","code",null,{"children":".js"}]," file extensions in ",["$","code",null,{"children":"import"}]," statements:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"ts","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"ts","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" }"}],["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":" from"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" '"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}]}]}]}],"\n",["$","p",null,{"children":["In this case, the authored file ",["$","code",null,{"children":"module.ts"}]," would have the ",["$","code",null,{"children":".ts"}]," extension and not ",["$","code",null,{"children":".js"}],", however, we need to specify the ",["$","code",null,{"children":".js"}]," extension in the ",["$","code",null,{"children":"import"}]," statement to match the output file extension."]}],"\n",["$","p",null,{"children":["TypeScript has an option: ",["$","code",null,{"children":"allowImportingTsExtensions: true"}]," to write ",["$","code",null,{"children":"./module.ts"}]," instead of ",["$","code",null,{"children":"./module.js"}]," in the ",["$","code",null,{"children":"import"}]," statement. It's also possible to specify ",["$","code",null,{"children":"moduleResolution: 'Bundler'"}]," to allow omitting the file extension in the ",["$","code",null,{"children":"import"}]," statement. However, TypeScript compiler doesn't rewrite the imports to add the correct file extension, so unless they are added by another tool, the imports will fail at runtime."]}],"\n",["$","p",null,{"children":["TypeScript also supports ",["$","code",null,{"children":".mts"}]," and ",["$","code",null,{"children":".cts"}]," file extensions. However, they would still need another tool to rewrite the imports to add the correct file extension. So there's no real benefit to using these extensions when writing dual modules."]}],"\n",["$","h3",null,{"id":"default-exports","children":["$","a",null,{"href":"#default-exports","children":"Default exports"}]}],"\n",["$","p",null,{"children":"Default exports in TypeScript can be problematic. Let's consider the following code:"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#C792EA"},"children":"const"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo "}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#F78C6C"},"children":" 42"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"export"}],["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":" default"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}]]}]}]}],"\n",["$","p",null,{"children":"This code works in ESM with the following:"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"import"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo "}],["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"from"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" '"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#BABED8"},"children":"console"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"."}],["$","span",null,{"style":{"color":"#82AAFF"},"children":"log"}],["$","span",null,{"style":{"color":"#BABED8"},"children":"(foo)"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}],["$","span",null,{"style":{"color":"#676E95","fontStyle":"italic"},"children":" // 42"}]]}]]}]}]}],"\n",["$","p",null,{"children":["However, when the code is compiled to CommonJS, the default export is converted to an object with a ",["$","code",null,{"children":"default"}]," property:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#C792EA"},"children":"const"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo "}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#F78C6C"},"children":" 42"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"exports."}],["$","span",null,{"style":{"color":"#BABED8"},"children":"default "}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}]]}]}]}],"\n",["$","p",null,{"children":"So now the import statement would need to be:"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#C792EA"},"children":"const"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo "}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#82AAFF"},"children":" require"}],["$","span",null,{"style":{"color":"#BABED8"},"children":"("}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./module.js"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"'"}],["$","span",null,{"style":{"color":"#BABED8"},"children":")"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"."}],["$","span",null,{"style":{"color":"#BABED8"},"children":"default"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}]}]}]}],"\n",["$","p",null,{"children":"This can be problematic when writing dual modules, as what we import in ESM is different from what we import in CommonJS. Ideally, we want the following CommonJS output:"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#C792EA"},"children":"const"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo "}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#F78C6C"},"children":" 42"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"module.exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" ="}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}]]}]}]}],"\n",["$","p",null,{"children":"We can get this output if we change the source code to the following:"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"js","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"js","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#C792EA"},"children":"const"}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo "}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"="}],["$","span",null,{"style":{"color":"#F78C6C"},"children":" 42"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF","fontStyle":"italic"},"children":"export"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" ="}],["$","span",null,{"style":{"color":"#BABED8"},"children":" foo"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":";"}]]}]]}]}]}],"\n",["$","p",null,{"children":"However, this is not compatible with compiling to ESM."}],"\n",["$","p",null,{"children":"To workaround this issue, there are a 2 options:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Use named exports instead of default exports."}],"\n",["$","li",null,{"children":["Add a wrapper for the CommonJS build that re-exports the default export with ",["$","code",null,{"children":"export ="}],"."]}],"\n"]}],"\n",["$","h3",null,{"id":"types-in-the-exports-field","children":["$","a",null,{"href":"#types-in-the-exports-field","children":["Types in the ",["$","code",null,{"children":"exports"}]," field"]}]}],"\n",["$","p",null,{"children":["When publishing dual module libraries, it's necessary to provide declaration files for both ESM and CommonJS modules. Declaration files can be specified using the ",["$","code",null,{"children":"types"}]," condition in the ",["$","code",null,{"children":"exports"}]," field:"]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","$Lc",null,{"style":{"backgroundColor":"#292D3E","color":"#babed8"},"tabIndex":"0","data-language":"json","data-theme":"material-theme-palenight","children":["$","code",null,{"data-language":"json","data-theme":"material-theme-palenight","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"{"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"  \""}],["$","span",null,{"style":{"color":"#C792EA"},"children":"exports"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"    \""}],["$","span",null,{"style":{"color":"#FFCB6B"},"children":"."}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"import"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"        \""}],["$","span",null,{"style":{"color":"#F07178"},"children":"types"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.d.ts"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"        \""}],["$","span",null,{"style":{"color":"#F07178"},"children":"default"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./esm/index.mjs"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"      },"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"      \""}],["$","span",null,{"style":{"color":"#F78C6C"},"children":"require"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"        \""}],["$","span",null,{"style":{"color":"#F07178"},"children":"types"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index.d.ts"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":","}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#89DDFF"},"children":"        \""}],["$","span",null,{"style":{"color":"#F07178"},"children":"default"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}],["$","span",null,{"style":{"color":"#89DDFF"},"children":":"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":" \""}],["$","span",null,{"style":{"color":"#C3E88D"},"children":"./cjs/index.cjs"}],["$","span",null,{"style":{"color":"#89DDFF"},"children":"\""}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"      }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#89DDFF"},"children":"}"}]}]]}]}]}],"\n",["$","h2",null,{"id":"useful-tools","children":["$","a",null,{"href":"#useful-tools","children":"Useful tools"}]}],"\n",["$","p",null,{"children":"Writing dual module libraries can be complex, so here are some tools that can help:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","a",null,{"href":"https://arethetypeswrong.github.io","rel":"nofollow","target":"_blank","children":["$","code",null,{"children":"arethetypeswrong"}]}]," - A tool to check if the types in the ",["$","code",null,{"children":"exports"}]," field of a ",["$","code",null,{"children":"package.json"}]," are correct."]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"https://github.com/isaacs/tshy","rel":"nofollow","target":"_blank","children":["$","code",null,{"children":"tshy"}]}]," - A build tool that handles generating dual module builds and declaration files with minimal configuration."]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"https://callstack.github.io/react-native-builder-bob/build","rel":"nofollow","target":"_blank","children":["$","code",null,{"children":"react-native-builder-bob"}]}]," - A build tool for React Native libraries that can rewrite imports to add the correct file extension for ESM compatibility."]}],"\n"]}],"\n",["$","h2",null,{"id":"conclusion","children":["$","a",null,{"href":"#conclusion","children":"Conclusion"}]}],"\n",["$","p",null,{"children":["Writing dual module libraries has a lot of nuances and can be tricky. And some of the problems can take a lot of work to solve. I can only hope that soon Node.js will have ",["$","a",null,{"href":"https://nodejs.org/api/esm.html#interoperability-with-commonjs","rel":"nofollow","target":"_blank","children":"better interoperability between ESM and CommonJS"}]," modules with synchronous ",["$","code",null,{"children":"require"}]," for ES modules without a flag and all tools to support the new module system."]}],"\n",["$","p",null,{"children":"But when writing libraries and wanting to support many environments, it's unfortunately necessary to deal with these complexities. I hope this post has helped you understand some of the challenges."}]]]}],["$","$Ld",null,{}]]}]
a:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Publishing dual module ESM libraries Â· satya164's blog"}],["$","meta","3",{"name":"description","content":"Dual module libraries containing both ESM and CommonJS modules can be tricky. Here's what I learned."}],["$","meta","4",{"property":"og:title","content":"Publishing dual module ESM libraries"}],["$","meta","5",{"property":"og:description","content":"Dual module libraries containing both ESM and CommonJS modules can be tricky. Here's what I learned."}],["$","meta","6",{"property":"og:type","content":"article"}],["$","meta","7",{"property":"article:published_time","content":"2024-07-12T00:00:00.000Z"}],["$","meta","8",{"property":"article:author","content":"Satyajit Sahoo"}],["$","meta","9",{"name":"twitter:card","content":"summary"}],["$","meta","10",{"name":"twitter:creator","content":"@satya164"}],["$","meta","11",{"name":"twitter:title","content":"Publishing dual module ESM libraries"}],["$","meta","12",{"name":"twitter:description","content":"Dual module libraries containing both ESM and CommonJS modules can be tricky. Here's what I learned."}],["$","link","13",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","meta","14",{"name":"next-size-adjust"}]]
1:null
